# SVN 对 Git 的报道

> 原文：<https://dev.to/ivanovyordan/svn-to-git-write-up-1e12>

### 背景故事

[![SVN to Git write-up](img/cf196c6196aa7d3e8974deabcb3d6b5c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--2Gdq7QaC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://images.unsplash.com/photo-1531030874896-fdef6826f2f7%3Fixlib%3Drb-0.3.5%26q%3D80%26fm%3Djpg%26crop%3Dentropy%26cs%3Dtinysrgb%26w%3D1080%26fit%3Dmax%26ixid%3DeyJhcHBfaWQiOjExNzczfQ%26s%3D21c1a038fbb00c20e7bbe6c67016385c)

大约两年前，我辞去了上一份工作。作为一个在一个房间里的小团队，我们在沟通方面没有太大的问题。令人惊讶的是，工具的选择和我们使用它的方式给我们带来了最大的问题。

### 流程

作为一个产品公司，大部分时间我们在一个单一的整体项目上工作，多个较小的应用程序分散在 SVN 的存储库中。十几年前的产品没什么不寻常的。但这是我们如何使用 SVN。

没有分支、真正的暂存环境或自动化部署。如果我们想要部署一段代码，我们必须将它提交给 master。然后，由于一些 cron job magic，它被部署到*登台*服务器。当我们想要发布一个特性时，我们必须要求 *CTO* 在单个生产服务器上运行`svn up`。

### 出现了问题

让我举一个我们几乎每天都会遇到的情况的例子。

如果乔治想在*集成*上测试一些东西，他必须将他的代码提交给*主*分支。几分钟后，玛丽完成了她已经在*母版*中的特写。Peter 登录到服务器并更新服务器上的主分支。猜猜那一刻会发生什么？彼得只是部署了乔治的漏洞百出、未经修饰的代码。

我们的解决方法是什么？我们不得不在房间里大声问:

> 存储库中是否有不应该部署的内容？

如果答案是`Yes`,我们必须上传特定的特性文件，恢复更改，甚至等待对方完成我们的工作。

### 解

我们知道我们的工作流程存在重大问题。显而易见的解决方案是修复我们的工作流程，保留优秀的老 SVN。令人惊讶的是，我们没有这样做。我的建议是迁移到 Git。

我是开源项目 GitHub 的粉丝。我还用 [BitBucket](https://bitbucket.org/) 做过几个闭源的。使用这些工具帮助我更好地与同事合作，并自动化我的流程。不幸的是，这两个平台都不符合我老板的要求。他要求一个自托管的解决方案，因为他担心服务提供商会窃取我们的代码😃。

在我开始抱怨这个过程后不久，我们在我们的一台服务器上安装了 GitLab。这个过程是手动的，单调乏味，但是文档很好，我们没有遇到任何重大问题。

GitLab 对我们来说看起来很棒，但我们没有开始使用它。此刻总有更重要的事情。我花了差不多两年的时间进行谈判，开始着手从 SVN 到 Git 的迁移工作。

有一天，我组织了一场 CTO、CEO 和我之间的问答会。我们从*开始，简短介绍了*一些 Git 特性以及迁移将如何改进我们的过程。他们那边有很多问题。首席执行官担心我们迁移所需的时间。另一方面，首席技术官不知道我们是否能保存 SVN 的历史。在我看来，CTO 习惯了流程和工具，害怕改变。

我向管理层展示了 [git-svn](https://git-scm.com/docs/git-svn) ,并给了他们大约 3 周的迁移时间。此后不久，我们开始研究真正的迁移。

### 迁移

我们的第一步是建立一个新的 GitLab 实例。有一个[综合](https://docs.gitlab.com/omnibus/)包使得安装和设置变得更加容易。我们创建了一个新的虚拟机并安装了软件包。文档甚至更好。

测试项目的迁移进行得很顺利，但是当我开始探索我们所有的项目时，我很沮丧。正如我已经说过的，似乎没有人试图学习如何以正确的方式与 SVN *共事。只有少数应用程序使用标准的 SVN 结构。许多项目共享一个单一的存储库，并且仅仅通过它们的目录分开。*

主应用程序的存储库中有两个目录。我们检出的是项目的*当前*版本(*版本*此处指*重写*)。另一个目录包含以前版本中的*。我们也有几个不同的旧版本项目的其他存储库。我甚至发现了一个不为大家所知的知识库。所有这些版本都有自己的历史，尽管它们代表了同一项目发展的不同阶段。*

### 自动化

当然，我们没有手动迁移大约一百个存储库。我描述了我想要实现的存储库和分支的结构。每个项目和分支都有多个字段，比如存储库/分支名称、SVN 路径、GitLab 可见性等等。

剩下的很简单。主脚本执行了几个 shell 命令和 GitLab API 调用。每个 SVN 存储库都被克隆并转换为 Git 存储库，其中包含所有历史记录(提交、消息和作者)，忽略了文件和目录分支以及我们需要的所有内容，存储库被推送到使用 API 创建的项目中。

### 新建工作流

正如所料，学习新工具并不容易，我们花了大约一个月的时间来适应它和工作流程，但这是值得的。这个过程本身没什么特别的。我们使用 GitLab 来跟踪问题，讨论问题和特性，跟踪里程碑进展和其他一切。除了更好地了解我们的进展，我们还获得了两大好处:

*   代码审查。他们帮助我们提高了很多硬技能和软技能。
*   特色分支。我们能够测试每一项功能，而没有将其部署到生产环境的风险。

### 吸取教训

**了解你的工具**

它可能是你的编辑器，你的版本控制系统或者你的锤子。无论你选择什么样的工具，都要学会如何在基础之外使用它。如果负责我们 SVN 仓库的人读了一点 SVN 的功能，我们可能会有分支和代码审查很多年，迁移可能会更容易。毕竟，工具是让我们高效的东西。

**不要害怕变化**

变化有时可能是可怕的。人们害怕未知是很自然的，但这不应该阻止进步。我们应该客观地看待我们的问题，把它们写下来，寻找解决办法，并估计要付出的努力。毕竟人类应该是聪明的香料。

你有什么看法？