# 找到 404 页的链接

> 原文：<https://dev.to/bahe007/finding-links-to-404-pages-44ic>

很少有什么比网站上的链接导致 404 错误页面更烦人的了。因此，设计师花了很多时间精心制作这些页面，让它们看起来更赏心悦目。但是对于开发者来说，目标应该是通过找到这些错误的链接来取代设计师的工作。

# 让我们来自动化这个吧！

开发者将一切自动化。如果我们看到一个近乎迭代的任务，我们就为它写一个程序。当然，在有些情况下，这只是一种拖延的好方法，但是对于这个特定的问题，除了自动化，没有其他合理的选择。

这个问题实际上由两个迭代组成:在网站上寻找错误链接的迭代过程和一次又一次这样做的迭代过程。后者是必要的，因为网站通常链接到外部网站，这些网站可以在不让人知道的情况下改变路线。此外，如果网站不使用严格的层次结构，文本中的文章之间可能会有交叉链接，这可能会变得非常复杂。

当然，你可以创建一个 CMS 来自动观察到 404 页面的链接，但是这看起来很复杂，而且可能计算量很大。但是如果你知道这样一个集成系统，让我知道就太好了。

# 最初的想法

第一个天真的想法是浏览文章数据库，扫描其中的`<a>`标签。然后你会在你的数据库中搜索，看看是否有这个网址的文章。这种方法的局限性和问题是显而易见的:您需要访问您的数据库，这意味着可能要下载它并以允许您的代码访问它的方式设置它。
外部链接需要额外处理。

根据你的 CMS，一篇文章可能会有不同的 URL。因此，您需要几个正则表达式(或者您使用的任何技术)来处理这些不同的情况。这个问题的一个很好的例子是 Joomla:如果你通过菜单栏访问一篇文章，它的 url 是[https://Joomla-domain . com/index . PHP/menu-item-x/article-title](https://joomla-domain.com/index.php/menu-item-x/article-title)，否则就是【https://joomla-domain.com/index.php/article-title】T2。如果你想提取文章标题/id，有必要区分这些不同的 URL。
你需要为每个不同的 CMS 定制实现。因此，我决定走另一条路(双关语):构建一个网络爬虫。

# 爬行者

与直觉相反，这个概念比在数据库中爬行要简单一些。另外，这是图论的一个很好的例子。你选择一个起点/一个开始网址；然后爬虫访问这个页面，寻找那里的所有链接并且记住它们。然后，它访问所有这些链接的网站，并再次寻找所有的链接。然后重复这一过程，直到访问完所有页面。最后，你有一个整个网站的图表，如果一个被访问的网站返回一个 404 HTTP 代码，你可以在一个额外的列表中注明这个 url 以及链接所在的网站。不完全是，火箭科学，对吧？

与往常一样，当然有一些潜在的陷阱，您应该在创建这样的算法时考虑:

*   `<a>`-标签中的链接通常是格式为/主类别/另一层/登陆页的绝对 URL，为了让你的爬虫访问这个站点，你需要添加域名来创建这种格式:[https://tld.com/main-category/another-layer/landing-page](https://tld.com/main-category/another-layer/landing-page)。
*   该网站可能有外部网站的链接。你不想抓取这些，因此你需要区分你感兴趣的网站和外部链接，但是当然，检查外部网站是否存在是有意义的！也许，忽略一些 url 路径是有用的，例如，一些日历模块使用 php 脚本解析 URL 来返回事件(还是 Joomla:)。如果你不忽略它们的话，这可以生成成千上万个你要解析的 URL。
*   最有可能的是，您会遇到循环。登录页面 A 链接到登录页面 B，反之亦然。如果你的算法不记得它已经访问了哪个页面，那么恭喜你:你构建了一个无限循环。
*   菜单栏是魔鬼。如果你在每一页上都看到它们，你会有更多的操作。边栏和页脚也是如此。因此，按类或 id 忽略某些 HTML 元素可能会有所帮助。
*   一些服务器对每分钟允许的访问次数有限制。即使没有，保持礼貌也是一个好习惯，也就是说在请求之间等待多长时间。

你可能已经注意到了，但是很多这些问题已经在图论中解决了，因此这可能是一个很好的时间来更新你关于这个主题的知识。

# 一个现成的实现

如果你不想自己构建这样的程序，你很幸运:有几个免费的在线工具可以找到不存在的页面的链接。更好的是:几周前，我公开了自己的实现。它有所有提到的问题的解决方案，并且已经帮助我找到了几十个客户网站上不存在的页面的链接。此外，它将结果导出为 CSV 文件，因此您可以在 Excel 或任何您喜欢的应用程序中打开它并查看数据。它很容易通过命令行访问，并且是用 Python 编写的。
你可以在这里找到:【https://github.com/bahe007/tt404】T2

# 从哪里开始自己的实现

很多时候，如果我开始一个全新的项目，我发现很难迈出第一步，因此这里有两个很棒的 Python 实现库，可以让你迈出第一步更容易一些:

*   美丽的汤:一个惊人的 HTML 解析器。不可思议的工作，没有它这个项目会花更长的时间。
*   请求:这是 HTTP 请求的基本 Python 库。我强烈推荐它，因为我在几个项目中成功地使用了它，尽管有些人更喜欢 urllib。

请随意留下反馈或链接到您自己的项目，我会感谢两者。感谢阅读！