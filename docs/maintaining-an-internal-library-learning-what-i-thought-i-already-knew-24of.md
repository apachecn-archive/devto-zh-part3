# 维护一个内部图书馆:学习我认为我已经知道的东西

> 原文：<https://dev.to/hdennen/maintaining-an-internal-library-learning-what-i-thought-i-already-knew-24of>

[![](img/880122160412cac1a67f27cea0225c9b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--cj9z9twu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/576/1%2ABE7_w7J42VQaQ82CzoljlQ.gif)

<figcaption>[http://www.smbc-comics.com/?id=2475](http://www.smbc-comics.com/?id=2475)</figcaption>

我工作的产品需要支持一些公司特定标准的窗口消息传递，所以我认为将传输与主系统完全分离会很好。这样，我们可以将它提供给我们的客户，以简化集成，并在我们的其他产品中使用它来强制实现单一标准。

此外，这也是我可以在没有其他十个开发人员催促提交的情况下进行的实验。😅

随着它从单个文件发展成为一个完整的库，包括构建/发布/部署管道，我遇到了开发最佳实践背后的一些不太明显的原因。他们来了。

### 分支策略(gitflow)

如果忽略所有不写代码的时间成本，在 master 上粉碎提交只会更快。

我们知道这些是真的:你会改变你的想法。你会犯错误。你会忘记事情。你会做出糟糕的决定。

这些事情的成本不仅仅是回溯和修改过程，它同样多，如果不是更多的话，是回溯和修改所必需的心理环境的建立。

下次你花一周时间远离一些代码时，设置一个计时器，看看需要多长时间才能回到那个空间。

在 gitflow 的许多许多好处中，我发现这是最大的时间节省:保持良好的分支可以保持心理环境的隔离和凝聚力。如果分支中有太多的概念变化，好处就会消失。**一个想法，一个分支。**

### 更新一个库很容易，更新依赖链却不容易。

我们有一个小助手库，我们船依赖于我的库，它还包括一个演示网站，需要有最新版本。我们的主客户端也依赖于我的库，有一个合作伙伴 repo 存储了 helper 库，用于实时取件。简单。😐

每一个面向外部的代码库都要经过一个发布过程。

没多久我们就发现，如果协调是关键，那么自动化就是基石。也许这只是我的问题，但是有很多活动部件需要协调，这意味着我几乎总是会忘记一些小部件。

同样，一个好的项目经理是物有所值的。

### [标准版](https://github.com/conventional-changelog/standard-version)太棒了！

老实说，吐出一个自动生成的变更日志，加上版本碰撞和一个很好的任务提交是很棒的。在我的主要项目中，我们已经遵循了 Angular commit 指南，所以这是一个简单的过渡。由于提交量太大，这在我们的主项目中不太实际，但它为这个小东西带来了快乐。

### 单元测试

我从来没有能够维持 TDD 很长时间。老实说，我不完全确定这是现代 JS 应用程序的实用方法。也就是说，考虑周全的单元测试是 100%绝对必要的。

深思熟虑是这里的关键词。我们都见过单元测试的高覆盖率，但实际上什么也没测试。我所说的是确保一个给定的公共方法在任何状态条件下都能按预期执行的测试。最简单的方法是:使用[一元](https://en.wikipedia.org/wiki/Unary_function) [纯函数](https://en.wikipedia.org/wiki/Pure_function)。把一些状态放入一个对象，传递给函数，得到一个返回值。考验扯皮；测试回报。

还有许多其他方法来汇编和测试代码。根据我的经验，这是最简单和最容易维护的。至少它会鼓励你遵守德米特定律。