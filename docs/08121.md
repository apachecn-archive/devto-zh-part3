# 如何测试无服务器应用程序

> 原文:[https://dev . to/johndemian/how-to-test-server less-applications-59g 2](https://dev.to/johndemian/how-to-test-serverless-applications-59g2)

像任何其他正在进行或正在制造的产品一样，无服务器应用程序也需要测试和监控。否则你怎么知道你创造的东西是否提供了你想要的结果？在把你的“新生儿”带到这个世界之前，你必须确保它已经为这个世界做好了准备。任何种类的软件甚至硬件在投入大规模生产之前都会首先经过测试，对于无服务器应用程序也是如此。

因为你不能在没有确保它们被设计成应有的样子的情况下就把它们扔掉，所以我们将介绍无服务器应用程序测试过程，并且我们将让你深入了解这样做的方式和原因。

当谈到无服务器应用程序时，它们非常复杂，并且这种复杂性不断地从代码中转移出来。复杂性在于函数配置——IAM 权限、内存、超时、事件源配置等等。我知道有很多与无服务器指标相关的术语和缩写，所以看看[这篇](https://dashbird.io/blog/metric-based-alerting-for-aws-lambda/)帖子，了解它们的含义。函数是无状态的，它们完全依赖管理其应用程序状态的外部服务。这让我们对集成点的数量有了一个概念。

## [](#testing-stages)测试阶段

当你带着实现一个新特性或者甚至修复一个现有的 bug 的想法开始编写代码时，你可以在不同的阶段测试你的代码。每个测试阶段涵盖了应用程序的不同角度，而所有这些放在一起会让您意识到您的无服务器应用程序是按照它应该的方式构建的，并且它会按照它应该的方式工作。

### [](#local-tests)本地测试

我们将讨论一些工具，这些工具对于快速评估你的代码是否有效非常有用。但是要知道，他们也限制了你能从他们那里获得多少信心。他们不会模拟 API 认证，也不会模拟 IAM 权限，但他们将不断面临跟上平台最新变化的挑战。

您可以选择几种不同的方法来执行代码的本地测试，下面是一些方法:

*   利用[本地栈](https://aws.amazon.com/about-aws/whats-new/2017/08/introducing-aws-sam-local-a-cli-tool-to-test-aws-lambda-functions-locally/)将在本地模拟 AWS 服务；
*   使用[无服务器框架](https://serverless.com/blog/event-driven-serverless-app-local-dev-exp/)或 AWS SAM 本地工具将允许您在本地调用功能；
*   在自定义包装中运行 Node.js 函数；
*   通过 [docker-lambda](https://www.npmjs.com/package/docker-lambda) 在本地模拟 AWS Lambda 环境。

### [](#unit-tests)单元测试

由于代码中不再需要担心复杂性，单元测试的价值就被抛到了九霄云外。对单元测试的需求越来越少，因为大多数复杂性通常是围绕着函数如何与外部服务交互而发现的。如果您拥有一个复杂的业务逻辑，您应该做的是将该逻辑放入它自己的模块中，这样您就能够将它作为一个单元进行测试。你可以利用你已经知道的相同的测试框架，比如 Jest、 [Jasmine](https://jasmine.github.io/) 和 [Mocha](https://mochajs.org/) ，因为它们都工作得很好。

### [](#integration-tests)集成测试

当根据你所依赖的外部服务测试你的代码时，比如 S3 或者 DynamoDB，这就是所谓的集成测试。集成测试将允许您捕捉错误，因为它考虑了您的代码如何与外部服务交互。

如果您对响应格式的预期不正确，或者如果您的 DynamoDB 查询表达式中有错误，集成测试将帮助您解决所有这些问题。在执行集成测试时，您将通过传入存根事件和上下文对象来本地调用该函数。如果函数需要与外部服务集成，那么函数本身应该设置为与“真实事物”对话

### [](#acceptance-tests)验收测试

上面提到的所有测试都可以帮助您识别代码中的潜在问题。还有其他可能发生的事情吗？嗯，有。您的函数可能没有设置正确的 IAM 权限，甚至不允许与 DynamoDB 表通信。你是否遇到过函数超时设置太短的问题？即使没有分配足够的内存，这也是您需要解决的另一个问题。

考虑到有很多可能导致错误配置的机会。您需要在部署之后测试您的功能，这样您就可以确定是否一切都完美地运行，并且像预期的那样端到端地运行。如果您使用 API Gateway 和 Lambda，针对部署的 API 发出一个 HTTP 请求，并确保根据响应进行验证，这样您将完成一个端到端的测试。这是您能够找到单元和集成测试几乎肯定会遗漏的权限和其他配置错误的方法。

### [](#ui-testing)UI 测试

如果一个 UI 客户机直接使用你的无服务器应用程序，你应该确定这些改变是否与客户机兼容。您可以运行自动化的可视化测试，也可以对使用 AWS Device Farm 等服务的不同设备和平台进行自动化测试。此外，这些测试可以由问答团队手动完成，甚至可以通过类似 Selenium 的框架进行自动化测试。

### [](#production-testing)生产测试

我们已经完成了所有的测试步骤，但是在投入生产时总会有一些地方出错。AWS 可能会经历中断，这肯定会对您的无服务器应用程序产生重大影响。由于您的无服务器应用程序依赖于许多外部服务，这些服务也可能遭受中断。

只有当系统处于负载状态时，与规模相关的错误才会显示出来，这是另一件需要担心的事情。混沌工程是一门学科，其主要重点是测试应用程序在生产中承受动荡条件的能力。一系列受控实验将向系统注入少量故障，这将进一步有助于发现未知的故障模式，因此，给你一个机会在你的系统内部建立一个弹性。

这是 Dashbird 特别出彩的地方。你可以测试，重新测试所有你想要的应用程序，但是一旦那个婴儿上线，s*#@就会发生。事情就是这样。您将能够使用 [Dashbird](https://dashbird.io) 的功能视图来查看您的应用程序的运行情况，当应用程序出现问题时，您将能够使用事件管理平台来查看问题的确切原因和位置。

[![](../Images/a1f71a1081cf7ed9f6b83a95dc74dcd6.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--YvRrdCgT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dashbird.io/images/docs/errorview-2019.02.13.png)

## [](#conclusion)结论

在我们提到所有这些之后，我们开始意识到，您需要的最重要的东西是一个适用于您的无服务器应用程序的出色的监控和错误报告工具，而 Dashbird 正是您一直在寻找的工具。开始免费(永远)使用它，或者通过我们为期两周的免费试用来了解它所提供的一切。另外，欢迎在下面的评论框中分享你的想法。