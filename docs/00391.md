# 在 React 中构建高性能无限列表

> 原文:[https://dev . to/akshaykumar 6/building-high-performance-infinite-lists-in-react-31k 7](https://dev.to/akshaykumar6/building-high-performance-infinite-lists-in-react-31k7)

互联网上充斥着使用无限滚动的产品。无限卷轴让信息的消费变得非常容易，并且极易上瘾。带有时间线或订阅源的产品，如 Twitter、Instagram 等。最适合无限卷轴。

在 JavaScript 中实现无限滚动可能很有挑战性。特别是，当您的提要有数千个条目时，问题会变得更加复杂。让我们来看看其中的一些问题。

### [](#problems)问题

*   渲染速度慢，因为在调整大小时，浏览器必须重新绘制所有元素
*   滞后滚动
*   最后，页面上成千上万的 DOM 元素会使浏览器崩溃

大多数设备每秒刷新屏幕 60 次。这些帧中的每一帧的预算都刚刚超过 16 毫秒(1 秒/60 = 16.66 毫秒)。当你不能满足这个预算时，帧速率会下降，屏幕上的内容会抖动。您可以使用 Chrome 中的 FPS 米来检查网页的刷新率。当你在有这么多 DOM 元素的页面上滚动时，FPS 肯定会低于 60。

### [](#what-can-we%C2%A0do)我们能做什么？

我们必须减少元素并处理滚动问题。以下是解决这些问题的一些基本思路:

*   **DOM Recycling** :想法是只渲染可见的元素。我们可以重用它们来呈现新的项目，而不是创建新的项目。
*   滚动锚定(Scroll Anchoring):由于 DOM 中只有 10 个元素，我们需要伪造滚动来给人无限滚动的错觉。

这些需要大量的计算和拐角条件来有效地实现它。在阅读这些问题时，我遇到了 [react-virtualized](https://github.com/bvaughn/react-virtualized) 软件包，它为所有这些问题构建了解决方案，并由[丹·阿布拉莫夫](https://twitter.com/dan_abramov/status/716369503291105283)推荐。

### react-虚拟化是如何工作的？

React virtualized 通过一组组件实现虚拟渲染，这些组件完成相同的任务:

*   它们计算在列表显示区域内哪些项目是可见的。
*   他们使用一个具有相对位置和绝对位置的容器，通过改变容器的宽度、高度、顶部和左侧属性来确定内部子元素的位置。

我们将使用以下组件来呈现具有动态宽度的列表以及动态宽度和高度的项目:

*   **List** :这个组件呈现一个元素列表。它负责虚拟化列表并只呈现可见的项目。
*   **CellMeasurer** :它通过以用户不可见的方式临时渲染来自动测量单元格的内容。指定一个固定宽度来测量动态高度(反之亦然)。
*   **CellMeasurerCache** :存储`CellMeasurer`个测量值，并与父节点(`List`)共享。
*   **AutoSizer** :是自动调整单个子的宽度和高度的高阶组件。
*   **InfiniteLoader** :当用户在列表中上下滚动时，它管理数据的即时获取。它还缓存列表数据，以避免在用户滚动时再次获取它。

让我们用它们来建立一个真正的列表。