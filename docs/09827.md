# 作为 10 多年经验丰富的开发人员，关于重写代码的经验教训

> 原文:[https://dev . to/h _ polatyuruk/lessons-learned-about-rewriting-code-as-10-earlied-developer-200j](https://dev.to/h_polatyuruk/lessons-learned-about-rewriting-code-as-10-years-experienced-developer-2o0j)

12 个月。

这就是我们在从头开始重写软件时浪费的时间。软件市场漫长的 12 个月。
没有创新。
不前进。
真的，我忍不住问自己这个问题。

在这个快速发展的世界里，我们在 12 个月内能实现什么？T3】

*“2015 年 1 月 20 日，星期二，下午 5:10，反恶意软件产品终于要进行第一次公测了。”*

几个小时没有睡觉后，第一个发布说明在网站上发布了，这将是我们新旅程的开始。我在一家小型网络安全公司工作，该公司为终端用户和企业公司提供安全软件。我们的软件保护用户免受恶意软件的侵害。如果他们被感染，它会清理他们的电脑。我们的反恶意软件就是其中之一。
第一个测试版的反馈和印象非常好。我们是四个开发人员，在那个产品上工作，不断地修正错误，通过改进产品来迭代新版本。

### [](#first-stable%C2%A0version)第一个稳定版本

经过两个月的 bug 修复、改进和编码工作，我们发布了第一个稳定版本的反恶意软件。

用户在说什么？

我们大多数用户的反馈都很好，他们喜欢这个产品。这让我们的团队充满动力。我们积极致力于产品，以改善我们的核心功能。

### [](#the-airplane-is-taking%C2%A0off)飞机正在起飞。

2016–2017.

大风暴前我们的黄金岁月。

反恶意软件正处于它的全盛时期。它成了我们的旗舰产品。用户把它推荐给他们的朋友。每个与安全相关的博客和论坛都在推荐我们的软件。这是拯救受感染用户的第一选择。

下载、安装、销售。

每个指标都在上升，用户群在几个月内快速增长。创始人很高兴，团队也是。这是该公司一直在寻求的巨大成功。大家都在想:*“我们做到了！像其他大公司一样，我们认为我们创造了自己的成功故事。”*

### [](#new-opportunities-at-least-we-thought-like-that-entering-the-enterprise-market)新机遇(至少我们是这样认为的):进入企业市场

该公司决定进入企业领域。我们正在为公司产品组建一个新团队。反恶意软件的产品负责人即将离开团队。我们的首席技术官开始承担责任，成为新的所有者。(大错特错。我会解释原因)。

一些开发人员离开了公司，但这没什么。我们处理得很好，反恶意软件仍然是市场上的最佳选择。

### 好日子已经过去了。让我们面对现实。

正如我告诉你的，我们的首席技术官正在处理反恶意软件的一切。他是主要开发人员，不断发布新的更新和改进产品的功能。然而，由于他的职位，他还必须处理公司的其他事务。

当然，一开始，一切都很顺利。正如在每个开发过程中一样，在我们的案例中，我们也必须不断维护和改进我们的软件。

正如我们应该预料的那样(显然我们没有)，不知何故，开发过程开始变慢了。

我们发布新更新的日子已经过去了。在那一刻，我们生活在更新很晚，很快就没有更新的现实中。这让我很困扰，有一天我问我们的首席技术官:

***“这个产品怎么了？
为什么更新花费太多时间，开发变慢了？”***

他深吸一口气，开始说话:

_“代码库真的很复杂。它的结构不是很好，也不是松散耦合的。这个建筑的设计方式完全错误。UI 和核心逻辑相互干扰。每当我修复一个 bug 或者改变一些东西，都会影响到软件的其他部分。即使是很小的改变也很难做到。每次更新，都会有新的东西出现。

有些方法有 20 个参数，它们有两页长！你能想象吗？有许多事情本不应该实施，但它们还是实施了。

这就是为什么每次更新花费太长时间，我不能实现一个新的功能。如果我们发布一个新的更新，我担心我们可能会引入新的错误，破坏程序的核心功能，而这些功能现在运行良好。这就是为什么发布新的更新对我们来说风险太大。我们可能会失去用户。我们也会失去我们的产品。"_

一阵现实从他那端冒出来，我们都知道。事实上，我们期待着他的回答。

但是还有一件事要问。他在领导前一个主开发人员，这个主开发人员领导了这个产品一年，所以代码怎么会那么乱？

“我不想打破他的动机。我们必须尽快进入反恶意软件市场，而他在这方面很擅长。这就是我不想阻止他的原因。”

基本上，我们牺牲了代码库来以最快的方式进入市场，但这摧毁了我们产品的未来。

吸取的教训:如果事情真的是 sh*t，不要犹豫地说“这是 sh*t”。你产品的未来比你的意大利面条代码更重要。专注于生产可持续产品。

### [](#how-can-we-fix-this-terrible%C2%A0code)如何修复这个可怕的代码？

***“我们是程序员。在他们心中，程序员是建筑师，当他们到达一个地点时，他们想做的第一件事就是把这个地方推平，建造一些宏伟的东西。我们对渐进式改造不感兴趣:修补、改善、种植花坛。”
——T4 stack overflow**公司首席执行官乔尔·斯波尔斯基*

开发人员总是倾向于扔掉代码，重新开始。这是有原因的。原因是他们觉得旧代码没用，一塌糊涂。但是我们还是认为！然而，当我们试图找出这背后的真正原因时，我们可以面对这样一个事实:

*我们很可能错了！*

旧代码在我们看来可能很乱，必须从头开始重写，这实际上并不是因为代码，而是因为一个基本的编程法则:

阅读代码比编写代码更难。

这就是重用代码如此困难的原因。这就是为什么我们会认为“*这是一场大乱发*”。这就是为什么当我们阅读另一个开发者的代码时，我们的潜意识会对我们的耳朵低语“*扔掉它，重新开始*”。

像每一个开发者一样，我们陷入了这个陷阱。仅仅检查一次我们混乱的代码就足以考虑从头开始重写它。

经过一系列的会议，即使我们的 CTO 对代码重写(正确的行为)有抵触情绪，但他最终还是被说服了，我们开始了重写。

** *然而，这个决定并没有持续太久……*

那是一个周末。星期天。我正喝着早晨的咖啡，读着一些文章。就像我的 feed 知道该向我展示什么一样，我看到了最著名的关于重写代码的文章。这是乔尔·斯波尔斯基写的网景公司的重写故事。

与反恶意软件团队的其他人分享这篇文章，包括我们的 CTO，是我读完这篇文章后立即采取的行动。

又一场讨论开始了。

说服我们的 CTO 重写代码已经很难了，但是在读了那篇文章之后，他又改变了主意。他不想执行这个决定。其他队员对我大喊大叫:

*“为什么发这篇文章？我们已经说服他了。这个产品必须从头重写。这是唯一的办法。”*

因此，我们的第一次尝试结束了，我们关闭了重写主题。我们的 CTO 相信他可以管理这些垃圾代码，并且可以发布新的更新。这个话题被关闭了，直到严酷的现实击倒了我们。

**一年没有任何更新…**

**真的，这不是开玩笑。发生了这种事！**

*“为什么没有更新？”*

距离上次更新已经过去几个月了

这些来自用户的负面评论变成了我们的现实。作为一家小公司，我们有太多的产品需要管理，除此之外，我们进入了企业市场，这实际上使我们走到了那一步。

综合所有这些，你会得到一点:我们忘记了我们的用户。

想象一下。我们不想发布新的更新，因为我们不想失去我们的用户。

事实上，它应该是相反的:如果我们不发布新的更新，我们肯定会失去我们的用户，因为嘿，我们没有给他们一年半以上的更新。

现实打了我们一巴掌后，我们决定回头，对我们来说，重写软件是唯一的选择，所以我们这么做了。

**今天。**

*“2018 年 12 月 17 日星期一，21:40。这封邮件是准备发给我们的私人测试组的。”*

经过令人精疲力尽的 12 个月，我们完成了重写过程。我们准备了第一个测试版发行说明，就像我们产品面市的第一天一样。

我们又来了…

该产品的重写版本仍处于测试阶段。已经快一个月了。我们正在修复错误，倾听用户意见，审查反馈…就像我们 4 年前做的那样…

在这漫长的 12 个月里，我们错过了什么？除了重写，谁知道我们还能做什么？！

在这一点上可以提出许多问题。我只知道重写是我们唯一的选择，否则我们看不到任何其他解决方案。

如果你也陷入了这个陷阱，并开始思考“我应该从头开始重写软件”，那么考虑一下在迈出代码重写的第一步之前，问这些我相信每个开发人员都应该问的问题。

## [](#1-are-you-ready-to-throw-away-all-that-knowledge)1。你准备好抛弃那些知识了吗？

我是认真的在问！请对自己诚实，回答这个问题:你真的准备好扔掉所有的知识，所有收集的错误修复，多年的编程吗？这是你扔掉代码从头开始时所期望的。当你从这个角度看代码重写的时候，很痛苦，不是吗？所有那些试图修复 bug 的不眠之夜都在你眼前闪过。相信我，我知道。

你必须与许多用户交谈，才能找到导致你的软件不能正常工作的问题。然后你必须在你的软件中找到这个错误。然后，您必须重现问题，然后找到解决方法，然后…等等，等等。

## [](#2-can-you-guarantee-that-you-are-going-to-do-a-better-job-than-you-did-the-first%C2%A0time)2。你能保证你会比第一次做得更好吗？

重要的是要记住，当你从零开始时，没有人能保证你会比第一次做得更好。

因为你选择了抛弃所有的知识，收集的错误修正，很有可能同样的错误会再次出现。

很可能，重写团队会与第一个版本的团队有所不同。所以你实际上并没有“更多的经验”。你只会再次犯下大部分老错误，并引入一些原来版本中没有的新问题。

如果您没有很好地计划重写过程，新版本在解决客户问题方面可能比原始版本更差，这是一个很大的风险。有了这个重写决定，你就要承担可能导致你失去客户的风险。

## [](#3-are-you-ready-to-give-a-gift-of-months-years-to-your-competitors)3。你准备好给你的竞争对手几个月/几年的礼物了吗？

你知道重写你的软件需要多少时间吗？

这需要很多努力、计划和准备。你会计划每一项任务，一个接一个地冲刺，你会确切地知道你完成这个痛苦过程的最后期限。否则你会错过最后期限。谁知道呢？很有可能你不会按时完成这个过程。

您将处于一个极其危险的境地，您将不得不在几个月或几年内发布一个旧版本的代码，完全无法做出任何战略改变或对市场需求的新功能做出反应，因为您没有可发布的代码。

你的客户可能会抛弃你，因为你没有提供任何新的东西，而且你继续运送你的旧产品，没有任何改变。

你想过这个吗？！

## [](#lessons-learned-in-rewriting-software)重写软件的经验教训

从头重写一个系统本质上是承认作为一个设计师的失败。它在陈述，“我们没能设计出一个可维护的系统，所以必须重新开始。”——马克斯·卡纳特——亚历山大，代码简洁 T3】

所以和其他设计师一样，我们承认我们没能设计出我们的软件，我们从那个令人疲惫的过程中学到了很多。在这里，我分享一些令我难忘的经验。

### [](#rewriting-code-is-a-developer-illusion-not-the-solution-in-most%C2%A0cases)重写代码是开发者的错觉，不是大多数情况下的解决方案。

当您的代码遇到问题时，准确诊断出问题所在是非常重要的。正如每个开发人员都会做的那样，您最初的想法不应该是重写。这只是一种错觉。这是错觉，因为你正在努力阅读别人的代码，你认为如果你从头开始重写，你会做得更好。在这种情况下，永远记住编程的基本法则。

### 在进行代码重写之前，先考虑重构

有针对性的重写对于处理代码库中最糟糕的错误很有用。如果可以限制范围并解决大部分问题，就不要完全重写。例如，你的软件加载很慢。但这只影响到项目的一小部分。这些问题可以解决，一次一个，通过小心地移动代码，重构，改变接口。你没必要重写整本书。

### [](#beware-this-is-a-longer-harder-more-failureprone-path-than-you%C2%A0expect)当心。这是一条比你想象的更长、更难、更容易失败的道路。

有一个事实，开发者通常在错过截止日期后才意识到:每件事花费的时间都比你想象的要长。对重写成本的估计要非常悲观。它几乎总是比你想象的花费更多，时间更长。总会有很多的复杂性，这将使重写过程更加困难和痛苦。最终，失败的可能性是很难被忽略的。

### [](#make-sure-the-new-product-is-better-at-solving-users-problem-or-at-least-the-same-worse-cannot-be-acceptable)确保新产品更好地解决用户的问题(或者至少一样)。更糟的情况是不能接受的。

重写对客户没有直接影响/好处。你的用户不关心你的代码。他们只想解决自己的问题。仅此而已。在他们看来，如果你的产品适合解决他们的问题，你就是成功的。否则，他们不会使用该产品。他们不在乎你的重写决定，所以重写的版本至少要和旧版本一样高效。

### [](#keep-maintaining-and-supporting-the-existing%C2%A0product)保持对现有产品的维护和支持。

在我们的例子中，我们一年没有给用户任何更新。在我们今天生活的世界里，这太漫长了。我们的产品仍然足够好，但是用户抱怨没有更新。永远不要停止维护一个正在使用的系统，这样程序员就可以重写它。在重写过程中，仍然需要维护旧代码。当你重写旧代码的时候，应该给用户一些小的更新和错误修正。否则，你将面临失去你的客户。

### [](#involve-users-in-the-design-process-as-soon-as-possible)让用户尽快参与设计过程..

总是定期向您的最终用户展示您当前的进展，以便他们可以帮助您抓住最严重的问题。尽快与你的用户见面是很重要的。他们的反馈将帮助你根据他们的需求设计新产品。不要实现任何不必要的功能。这将使您免于拥有复杂的代码库。

### 保持团队在产品上的工作同步。

产品不仅仅是关于编程团队的。营销、支持、编程、设计……许多团队都在从事这项工作。通过定期更新重写过程来保持同步。

就我们而言，我们已经处理了许多问题。例如，营销团队正在准备我们的产品测试活动，他们必须确切地知道产品方面发生了什么，以便他们可以让客户为即将到来的产品变化做好准备。有时我们在没有通知他们的情况下做了一些改变。这导致他们从头开始准备竞选活动。不要无效率地浪费任何人的时间。

### [](#dont-make-dramatic-changes-to-the%C2%A0product)不要对产品做剧烈的改动。

了解你的产品的优缺点是很重要的。不要改变强势的一面，用户喜爱的一面。如果用户对你的 UI 很满意，就不要改了。做最小的改变和小的 UX 改进。当你用新的软件替换现有的软件时，你的用户不应该对新的巨大变化感到困惑。有很多情况下，用户放弃了新产品，因为他们没有找到与前一个产品提供的相同的功能。不要让同样的事情发生在你身上。

### [](#dont-make-your-product-depend-on-only-one-developer)不要让你的产品只依赖一个开发者。

在我们的案例中，我们的 CTO 是我们软件的负责开发人员。由于他的职位，我们的产品开发进展缓慢。即使是很小的变化也需要几个星期，有时甚至几个月。关键是要一直保持前进。永不停止。

### [](#migrations-should-be-slow-and%C2%A0steady)迁徙应该缓慢而平稳。

当你确定新的软件已经准备好的时候，用新的替换你原来的软件。一步一步来。

首先，从一个小型的私人测试团队开始，将你的产品加入到这个团队中。不断收集反馈和崩溃报告，修复错误，迭代新版本，等等。遵循这个循环，直到你确保你的产品准备好公开测试。

当你进行公开测试时，反馈将再次成为你最好的朋友。你的首要目标应该是确保你的产品能够解决用户的问题。当您确信您提供的功能与旧软件相同或更好时，就可以进行替换了。为新用户发布新软件，并将现有用户迁移到新用户。

这些是我从重写过程中学到的关键经验。重写几乎从来都不是答案。通常，重构是更好的选择。我强烈建议使用重构这种缓慢的方法。风险更小，而且你能让你的顾客满意。

## [](#when-to-rewrite-the%C2%A0code)何时重写代码

有些时候重写是合适的。如果我可以列出何时重写代码的清单，这将是我的清单:

**切换到另一种语言或平台(如我们的情况):**这种语言太古老了。很难找到开发商，或者你必须花很多钱去找一个。在这两种情况下都太费力了。

现有的代码库不再可维护(就像我们的例子):你如何决定你的代码不可维护？这很难确定，但是如果即使是很小的改变都很难完成，如果新的更新花费的时间比平时长，如果任何新的改变影响了软件的其他部分并引入了新的错误，那么你的软件就是不可维护的。

你有足够的资源来同时维护现有系统和设计新系统:永远不要停止维护一个正在使用的系统，这样程序员就可以重写它。如果系统在使用中，必须经常维护。请记住，您的个人注意力也是这里必须考虑的一个资源——如果您要同时为新系统和旧系统工作，那么您每天是否有足够的时间同时为这两个系统工作？

**团队中的开发人员是软件的瓶颈(就像我们的情况一样):**这不应该成为从头重写代码的理由。你可以随时在团队中更换开发人员，或者雇佣新的开发人员来消除瓶颈。

然而，有时，就像在我们的例子中，有时您必须选择重写选项。我们的软件是用旧技术编写的，我们的 CTO 是开发它的唯一负责人。我们试图找到一个新的开发者，但这很难，因为这个编码平台的年龄。即使我们能找到一个新的，对我们来说也是非常昂贵的。因此，连同其他条件，这是在我们的列表中，以决定重写代码。

**软件是长寿的(我说的是 10-20 年或更久):**随着时间的推移，维护变得越来越昂贵。这是因为代码变得越来越杂乱，因为为了快速维护补丁而牺牲了原来的架构。此外，开发旧技术的人越来越少，也越来越贵。最后，硬件开始老化，越来越难找到新的硬件、操作系统、框架等。在其上运行旧的应用程序。此外，业务不断发展，旧系统很可能无法满足组织的业务需求。

因此，你必须权衡所有持续的维护成本，以及新系统的潜在好处，与从头重写系统的成本。

如果你的案例符合以上一个或多个要点，你可能处于可以重写的情况。否则，正确的做法是通过一系列简单的步骤改进系统的设计来处理现有系统的复杂性，而不需要重写。

从头重写代码可能是你犯的最大的错误，但是同样的，不重写代码也会导致同样的结果。这里有一条建议。重构应该是第一选择。

一些开发人员会坚持认为所有的系统最终都必须重写。永远记住这不是真的。有可能设计出一个永远不需要扔掉的系统。你身边总会有一个软件设计师说“反正我们总有一天要把整个东西扔掉”。但是，如果软件一开始就构建正确，然后维护得当，为什么会被扔掉呢？