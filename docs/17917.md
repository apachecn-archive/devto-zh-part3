# 利用 TDD 和持续交付创建流程

> 原文：<https://dev.to/markoa/creating-flow-with-tdd-and-continuous-delivery-jf5>

编程是一项认知工作，作为程序员，我们在高度集中的状态下表现最好。虽然有一些外部因素会影响这一点，比如有一个安静的办公室，可控的沟通方式等。，也有一些内部因素需要考虑。事实上，我们的工作方式对结果的质量影响最大。

当纯粹的魔法从键盘中释放出来时，我们 100%专注的状态通常被称为*区域*，或者*流动*。

心流不容易进入。一次中断就足以毁掉它，而且，一旦失去，通常很难重新获得。我通常需要半个小时才能回到同样强度的状态。

心流也是完成有意义的创造性工作的重要因素。在《创造力:心流和发现与发明的心理学》一书中，心理学家米哈里·契克森米哈指出了能让任何人进入心流状态的九个要素:

1.  每一步都有明确的目标。
2.  对一个人的行动有直接的反馈。
3.  挑战和技能之间有一个平衡。
4.  行动和意识是融合在一起的。
5.  杂念被排除在意识之外。
6.  没有失败的担心。
7.  自我意识消失。
8.  时间感变得扭曲。
9.  活动变成自动的。

测试或行为驱动的开发(TDD/BDD)、持续集成和持续交付(CI/CD)可以帮助程序员放大这些元素中的几个。在这篇文章中，我将尝试解释这是如何做到的。

## 每一步都有明确的目标

在我开始实践 TDD 和 BDD 之前，当我面对一个要开发的大的新特性时，我经常感到不知所措。这并不是说我做不到，只是我的工作方式往往效率低下:我会在试图决定从哪里开始时拖延，一旦我到达中间，我往往会在不完整系统的不同部分之间徘徊。在特性发布后，我经常会意识到我过度设计了这个东西，同时也错过了实现它的至少一个关键部分。

在 BDD 中，您总是从编写尚不存在的特性的高级用户场景开始。这个特性是什么通常不是很明显，所以在你写任何代码之前，花点时间仔细考虑并和你的团队、产品经理或客户讨论是值得的。一旦你面前有了概述的特性(例如，用诸如 Gherkin 之类的 DSL 编写的)，你就会有一个明确的工作目标。您的下一个唯一目标应该是实现那个测试场景。一旦测试场景开始通过，您就会知道您已经成功地实现了这个目标。

当我们深入到实现的较低层次时——对于 web 和移动应用程序，这通常是视图，然后是控制器、模型，可能是更深的业务逻辑层——我们应该通过编写测试用例来定义我们的下一个目标。每个目标都源自我们刚刚完成的实现，同时记住初始场景所代表的高级目标。每当我们需要关于如何进行的提示时，我们可以重新运行高级场景(有时也称为验收测试)。

关于如何在实践中做到这一点，请查看我以前的帖子:

[![markoa image](img/fded043eaf4dbceeb727380e471e4424.png)](/markoa) [## 如何用 BDD 构建坚如磐石的 Ruby on Rails 应用程序

### 马尔科·阿纳斯塔索夫 9 月 6 日 187 分钟阅读

#webdev #rails #testing #programming](/markoa/how-to-build-rock-solid-ruby-on-rails-apps-with-bdd-4jg9)

## 对你的行动有即时的反馈

如果我们想做好每件事，快速反馈循环是必不可少的。反馈告诉我们做得如何，以及我们离目标还有多远。当调试一个涉及网络往返和多个文件的问题，并且可能跨越很大范围的代码时，您的主要目标应该是尽可能地缩短重现它的循环。这将有助于您在尝试重现问题的过程中尽可能少地花费时间打字和/或点击，以便查看您是否已经解决了问题。

BDD 和持续集成都是关于反馈的。当编程时，你编写的测试为你正在进行的工作提供反馈。您编写一个测试，编写一点程序，运行测试并观察结果，如果它是绿色的，则返回进行一点重构，如果它是红色的，则再做一些工作使它通过。

使这个过程快速是至关重要的，因为如果你需要等待一个测试结果超过几秒钟，你就会失去注意力。练习在测试和代码之间切换，以及几乎下意识地运行肌肉记忆中的相关测试部分也是有帮助的。例如，在[信号量](https://semaphoreci.com)中，我们都在 Vim 中编程，并使用[一个小插件](https://github.com/renderedtext/vim-bdd)在光标下用一个方便的快捷方式运行测试或测试文件。

持续部署(CD)的最大好处之一是，它能够为整个公司提供快速反馈。每日发布确保开发人员可以微调实现，产品经理可以验证解决方案并从用户那里获得反馈，业务作为一个整体可以快速地创新、学习和修正过程。

有关什么是足够快的 CI 的讨论，请参见:

[![markoa image](img/fded043eaf4dbceeb727380e471e4424.png)](/markoa) [## 什么是适当的持续集成？

### 马尔科·阿纳斯塔索夫 10 月 4 日 183 分钟阅读

#ci #cicd #devops #productivity](/markoa/what-is-proper-continuous-integration-585c)

## 挑战和技能之间有一个平衡

如果手头的任务和我们的技能之间存在根本性的不匹配，没有任何过程可以帮助解决这个问题。然而，在将一个大任务分解成许多更小的、可管理的任务的一般过程中，TDD 起到了重要的辅助作用。它帮助我们以小增量工作。假设我们在一个熟悉的领域中工作，可能有一个远未完成的高级场景，但是总有至少一些测试我们可以在大约一个小时的编程中通过。

在某种程度上，CI 和 CD 也有助于克服大的挑战。虽然我们的最终目标可能是一个重要的功能，需要几周的团队合作，但连续交付——通过数据和反馈完成功能标志、逐步推出和增量产品开发——有助于我们确保我们的工作单元始终处于可管理的规模。这也意味着，万一我们构建的东西没有用，我们可以很快丢弃它，而不用做无意义的工作。

## 没有失败的烦恼

对失败的担心往往源于社会环境。然而，拥有一个全面的测试套件作为整个团队的安全网有着巨大的好处。在持续集成的过程中，我们通过自动化运行测试的过程，以及执行编码风格、安全性和其他检查，将致命错误被忽视并部署到生产中的风险降至最低。这有助于开发人员在没有不必要压力的情况下工作。当然，这是假设每个贡献者都遵循没有足够的测试覆盖率就不提交拉请求的基本规则。

如果您的团队正在实践同行代码评审(我强烈推荐！)，然后在拉请求中有一个构建状态指示器，例如由[信号量](https://semaphoreci.com)提供的，帮助评审者知道她可以关注比代码是否工作更有用的事情。

在一天结束的时候，让我们记住，在心流状态下工作的主要好处是我们个人的成就感和随之而来的自我价值感。这是任何过程或工具价值的最终衡量标准。

* * *

这篇文章的最初版本发表在[信号量博客](https://semaphoreci.com/blog)上。很高兴在 dev.to 上分享—请在评论中发送您的反馈。✌️