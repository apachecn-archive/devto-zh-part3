# 永恒——值得努力的东西

> 原文:[https://dev.to/rwoodnz/immutability-值得为之奋斗的东西 3ppp](https://dev.to/rwoodnz/immutability---something-worth-striving-for-3ppp)

当我在 PartsTrader 用 C#工作时，我开始看到领域驱动设计所寻求的东西和函数式编程所做的东西之间的相似之处。或者更确切地说，FP 必须做些什么才能在现实世界中有用。

我目前为一个客户开发 Javascript，为另一个客户开发函数式语言 Elm。我之前为两家公司工作过。网络公司。其中一个——parts trader——非常热衷于 DDD。

所以我说的是把纯功能从副作用中分离出来。在 DDD，想法是圈定业务逻辑，将所有的 IO 和外部接口排除在圈外。

当你看到一个像 Elm 这样的函数式环境时，你会发现所有的纯函数都与混乱的 IO 和外部 javascript 函数分离开来。

不同之处在于，在 Elm 中，这种分割是强制性的。在 DDD 和面向对象语言中，这是一个自愿的设计决定，有一些严肃的书籍可以让你相信你在做正确的事情。

然而，它仍然回到不变性。函数式编程可以让你马上做到这一点。在非函数式语言中，这仍然是一个很好的想法，但是你必须选择这样做。好处是你的代码更容易调试，因为在每一层进出的东西保持不变。

在 Elm 中，整个代码是不可变的——可以把它想象成一个大函数，在需要的时候调用。任何副作用都将由运行时完成，然后再次调用函数。

这有一些有趣的好处。如果你想知道你的程序在做什么，只要看看这个大的“更新”功能就可以了，这个功能在这个树的底部，它把它委托给任何东西。除此之外，通过严格的输入，如果你做了任何破坏编译的更改，你会很快发现，错误消息只是“知道”你在做什么。

这不是贬低。Net 的 Visual Studio 时使用 C#。多亏了一些非常聪明的人多年来对它所做的工作，在你开始编译之前，它就“知道”了很多。

在非函数式语言中，传入任何可能随机变化的值也是一种很好的做法，这样您仍然有单元可测试的函数依赖注入。在 Elm 中，调用副作用的函数不会将内容返回到代码中，因此不会影响返回值。它们进入运行时，然后运行时通过消息更新通道返回值，就好像是某个神奇的仙女生成了它们一样。

无论如何，用 Javascript 开发是这次讨论的难点。一方面，它是一种函数式语言，因为函数是第一类，对它们的引用可以传递。另一方面，它太松散了，你可以在任何你喜欢的地方产生副作用。你真的不知道有些函数的另一端会输出什么。收紧这一点需要相当大的开销。

我正在开发一个旧的 JS 代码库，我已经把它大部分转换成了 ES6。虽然我引入了 Webpack，但我避免引入任何新的框架，如 React 和 Angular——这两个框架我以前都用过。我使用了一点 JSX 本地语言作为模板化表单和菜单的捷径，但那是另一回事了。

对于普通的 JS，你仍然可以采取尽可能使事情不可变的策略。这再次意味着分离出任何副作用，直到你的功能变得纯粹。

在我的例子中，我想开始重新组织代码库，这样，它看起来更像一个 Elm 结构，有一个更新模型的更新逻辑树和一组简单地反映模型中的变化的视图函数——所有这些都尽可能地纯粹。我仍在研究如何结合应用程序中大量使用的地图框和传单来最好地做到这一点。

事实上，Javascript 中的命令式代码有时更容易理解，也更容易实现，而且务实无疑是一种好品质。也许最好在这样的函数中留下一个注释，说明它们不应该被扩展到合并副作用，并确保不要传入任何外部的东西。

我相信副作用的不变性和隔离是软件设计中值得努力的核心目标之一。如果不能马上实现，至少应该把它当作首选方向。

我相信，通过采用这种方法，会产生更容易阅读、维护和添加的东西。