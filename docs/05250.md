# 列表和反勾号解析(MDL 日志#5)

> 原文:[https://dev . to/mortoray/lists-and-back tick-parsing-MDL-log-5-3 MFA](https://dev.to/mortoray/lists-and-backtick-parsing-mdl-log-5-3mfa)

自从我上次更新以来已经有一段时间了，因为我没有太多时间在解析器上工作。副业的生命也是如此。:/

这一次，我对支持列表进行了修改。本着这一特色的精神，这些变化是:

*   列表解析语法，这些是以`-`开头的行
*   为`parse_to_doc.py`添加一个`_NodeIterator`来处理嵌套迭代
*   添加反勾号支持，因为我需要在上面写``_NodeIterator``
*   独立锚点解析

这个解析器对我来说已经接近一个有用的阶段，现在我将尝试在我的常规文档中使用它。设计也变得足够稳定，我很快就可以开始添加单元测试了。

我在这里保持技术描述简短，因为我不确定什么是最相关的或最感兴趣的。询问你是否想要更多的细节。

## [](#lists)列表

与在 [markdown](https://en.wikipedia.org/wiki/Markdown) 中不同，MDL 列表可以在多行上分开。这使得在那些要点中使用更长的句子和标记变得更加容易。

*   你看不到这个。
*   但是这两点之间有额外的空间。

Markdown 支持缩进列表，这在源代码中可能更容易阅读。这不是我现在关心的问题，我将不再支持他们。我还会忽略嵌入列表，直到我有一个合适的用例。

## [](#splitting-anchor-parsing)拆分锚点解析

我对解析处理锚点的方式做了一个改动。我有点偏离 HTML 所说的锚是 T2。在 MDL 中，锚只是一段可以与之相关联的文本——这几乎是在版本 5 之前的 HTML 中`<a>`的意思，版本 5 使其专用于链接。

解析的变化是`[anchor blocks]`现在独立于任何尾部位进行解析，比如完整的链接`[anchor](link)`。这种新的解析更加容易和灵活。到链接的转换是通过树转换完成的。它有更好的检测流量的能力。

没有尾随链接的`[anchor bit]`现在会引发错误。最终，对于 markdown 兼容模式，可能需要恢复为纯文本。

这一改变，加上反勾号支持，允许我切换到 URL 的未解析段。

## [](#backtick-support)反斜杠支持

鉴于我在本文档中使用了这么多的[反勾](https://en.wikipedia.org/wiki/Grave_accent#Use_in_programming) ```，令人惊讶的是我没有早点添加对它的支持。

与 markdown 不同，MDL 中的转义是用反斜杠`\`字符完成的。它是即使在转义部分也能识别的字符之一，比如反勾号。

在反斜线中转义反斜线有点问题。考虑一下 GitHub flavoured markdown 中需要看起来像

``` `_NodeIterator` ```

的``_NodeIterator``位。我必须计算折叠文本中的刻度数，加上封闭刻度数，以及可选空格(如果以刻度开始/结束的话)!

## _ 节点迭代器

doc_tree 转换器不再是递归树转换器。相反，每个函数都采用新的`_NodeIterator`，并且能够在树中移动。这允许特征依赖于它们周围的项目。

对于列表来说，这是必不可少的，因为列表项是主文档中独立的块。解析器看不到列表项和段落之间的区别。doc_tree 转换器必须将这些片段重组到一个列表块中。在块解析期间，后续列表项被追加到同一列表中。

这也使得锚分裂变得更加容易。锚现在看向下面的节点，并期望它是一个链接样式的节点。然后，它将两者合并在一起，生成一个输出元素。

* * *

*这是 [MDL 文档处理器项目](https://github.com/mortoray/mdl/)的开发日志条目。*