# 软件架构:Therac-25 杀手辐射机

> 原文：<https://dev.to/carlillo/software-architecture-therac-25-the-killer-radiation-machine-19ih>

[![Therac-25](img/0c75af6449b7d27bf2ee12aa06519d77.png)](https://cdn-images-1.medium.com/max/2000/1*ukXKrvRV4KJ1UbVe7OJEpQ.png)

# 简介

每天在课堂上，我都坚持告诉我的学生，软件必须经过测试，他们在拿人们的生命开玩笑。当我做这个评论时，他们认为我是在开玩笑，因为我们正在开发使用简单的 Restful API 执行小计算的 Web 服务。因此，测试对他们来说只是额外的工作，他们并不认为测试是软件开发的基本要素。

历史可以揭示，当开发用于医疗目的的软件时，这个小建议是最基本的。

17 年前，当我还是一名计算机科学的学生时:-(，
教授向我们解释说，软件工程与传统工程(例如，建筑)具有相同的民事责任，因为如果一座桥倒塌，我们
与建筑师具有相同的责任...在一次软件质量课上，我们谈到了著名的 Therac-25 案例，这是我在和学生打交道后想到的。

# Therac-25:杀手辐射机

1982 年，加拿大原子能有限公司(AECL)发明的一种叫做 Therac-25 的机器出现在医学领域，用于癌症治疗，使用辐射和 x 射线。这台机器是 Therac-20 的改进型，造价约 100 万美元。这台机器在大多数使用它的
场合都运转良好，但它与几个人的死亡和其他人严重疾病的发展
有关。在调查过程中，确定了多达 6 起与这些人的死亡或副作用有关的机器案例。

> 该机器提供两种放射治疗模式:
> 
> 1.  直接电子束疗法，其中通过磁体在治疗区域上扫描窄的低电流高能(5 兆电子伏至 25 兆电子伏)电子束；
> 2.  兆伏 X 射线(或光子)疗法，提供固定宽度的 X 射线束，通过将 25 兆电子伏的电流高 100 倍的窄电子束与目标碰撞产生，然后使发射的 X 射线通过扁平过滤器和准直器。—维基百科

它还包括一个“场光”模式，通过用可见光照亮治疗区域，使患者能够被正确地
定位。

[![Therac-25: Use](img/e8b9e3b9d63fcdf18558a21d022f21f8.png)](https://cdn-images-1.medium.com/max/2000/1*oyylp-dm7CbDtEUKtuGH_w.gif)

该软件主要负责:

1.  监控机器
2.  接受治疗的输入
3.  设置机器来实施这种治疗
4.  最后在机器进行处理的同时控制机器

# 软件漏洞

软件中出现的错误很难识别。出现 bug 的
过程如下:

1.  操作员在开始治疗时(使用用户界面)在机器配置中出错。
2.  使用机器的软件进行校正。
3.  用户界面显示一切都很顺利，或者没有停止这个过程，但它允许继续进行辐射操作。
4.  这些患者接受的辐射量比配置的辐射量高 125 倍。

开发该软件的主要问题如下:

1.  程序员没有假设操作员会在配置中出错，必须重新配置机器。他们认为操作员总是会选择正确的配置路径。这个事实是为什么建议由不同于软件开发人员的人来进行测试的主要原因之一，因为开发人员非常了解软件的使用，他们很少犯任何错误，而是使用是近乎完美的。
2.  没有开发任何类型的测试，也就是说，他们只在开发成功的情况下测试软件。

[![](img/9c7873280c727ef1c6c7a75bc307aa00.png)](https://cdn-images-1.medium.com/max/2000/1*2NOwr7qptOpSh0Ldh3K7Ww.png)

一个委员会得出结论，这场灾难的主要原因是由于不正确的软件架构和糟糕的软件开发实践。委员会没有将这些错误归咎于具体的程序设计错误，如果采用软件质量最低标准，这些错误是可以避免的。

新手开发的大多数软件都很难测试，因为软件功能和元素之间有很强的耦合性。真正令人惊讶的是，由一家致力于医疗机械的公司开发的价值约 100 万美元的软件，与新手的代码存在完全相同的问题。也就是说，由于开发质量低，委员会无法开发任何测试。

委员会的结论如下:

1.  AECL 没有对软件代码进行独立审查(只针对开发人员)。
2.  在评估机器如何产生预期结果以及存在何种故障模式时，AECL 没有考虑软件的设计。

这些构成了被称为可靠性建模和
风险管理的一般技术的一部分。

1.  系统发现有问题，停止了 X 射线光束，但仅仅显示了单词**“故障”**，后面是从 **1 到 64** 的数字。用户手册没有解释甚至没有说明错误代码，因此操作员按下 **P 键来忽略警告并继续操作**。

2.  AECL 的工作人员以及机器操作员起初并不相信这些抱怨。这可能是由于过度自信。

3.  AECL 从未测试过 Therac-25 的软硬件组合，直到它在医院组装完成。

研究人员还发现了几个工程问题:

1.  只有当在控制 PDP-11 计算机的 VT-100 终端上输入一个特定的非标准击键序列时，故障才会发生:一个“X”来(错误地)选择 25 兆电子伏光子模式，接着是“光标向上”，“E”来(正确地)选择 25 兆电子伏电子模式，然后是“回车”，所有这一切都发生在 8 秒钟内。

2.  该设计没有任何硬件联锁来防止电子束在靶不在的情况下以高能模式工作。

3.  这位工程师重复使用了旧型号的软件。这种方法在所谓的货物邪教编程中显而易见，其中盲目依赖先前创建的代码，这些代码很少被理解并且可能适用也可能不适用。这些型号的硬件联锁掩盖了它们的软件缺陷。那些硬件安全没有办法报告它们已经被触发，所以没有错误软件命令存在的迹象。

4.  硬件无法让软件验证传感器
    是否正常工作(参见开环控制器)。工作台定位系统是 Therac-25 失败的第一个原因；制造商用
    冗余开关对其进行了修改，以交叉检查其操作。

5.  设备控制任务没有与操作员
    界面任务正确同步，因此，如果操作员过快改变
    设置，就会出现竞态条件。这在测试中被忽略了，因为在操作员能够足够快地触发这种故障模式之前需要一些练习
    。

6.  软件通过递增标志变量来设置标志变量，而不是将其
    设置为固定的非零值。偶尔会发生算术溢出，导致标志归零，软件绕过安全检查。

# 结论

它展示了医学和软件工程历史上的一个著名案例，让人们聚焦于软件工程中的不良实践是如何结束了人们的生命。

这个故事让我们认真思考在软件开发和其他工程领域一样需要一个最低质量的规则。虽然开发的大多数软件应用程序是不太重要的应用程序，但是也正在开发关键软件，例如安装在机场、飞机、汽车、卫生机械、电梯等中的软件...没有最低限度的软件质量，最终的结果可能是戏剧性的。

因此，软件不能简单地复制和粘贴代码。那些自以为是超级黑客或者神神叨叨，不需要用自己生产的代码开发软件测试的人，应该像一个建筑师或者海军工程师不符合质量要求一样受到惩罚。

然而，事故总是会发生，其原因不一定是由于无知或不良做法。软件开发是一门开始
有相当成熟度的科学。然而，每天都有新的专业人员
加入进来，他们需要在软件工程的良好实践中得到足够的培训和培养

# 越来越多，越来越多...

1.  [http://sunnyday.mit.edu/papers/therac.pdf](http://sunnyday.mit.edu/papers/therac.pdf)
2.  [死亡和否认，Therac-25 的失败](http://%5Bhttp://cobra.csc.calpoly.edu/~dbutler/papers/THERAC25.html)
3.  Therac-25 的垮台
4.  Therac-25 事件
5.  [医学中的人为失误](http://www.smi.stanford.edu/people/felciano/research/humanerror/humanerrortalk.html)