# 评论还是不评论？

> 原文：<https://dev.to/codemouse92/to-comment-or-not-to-comment-3f7h>

**正在评论。这是代码风格中比较有争议的一点。关于这个话题并不缺乏观点，但是这些观点的有效性几乎没有什么*不确定性*。**

在我职业生涯的大部分时间里，我一直是正式评论实践的倡导者，甚至创作了[评论展示意图标准](https://standards.mousepawmedia.com/csi.html)。我已经听到了无数的争论*支持*和*反对*的评论，以及来自两个阵营的无数灾难性的评论政策。我自己甚至经历过一些不幸，带来了一些来之不易的教训。

无论你相信评论一切或什么都不是，稀疏地或密集地，只是文档评论或整个 enchilada，我想你会在这里找到一些有趣的观点。

# 注释的目的

在我们采取下一步之前，我想让每个人都同意*为什么*我们评论:**评论应该反映意图**。

人为的例子很难展示这一点，因为真正的软件比我们能编造的任何代码片段都要复杂得多。(相信我，多年来我一直试图拿出例子。所以，你必须和我一起想象一下:

**要点:**任何注释都应该描述你*的意图*一段代码的目标或结果。这是真的，不管你评论的频率或密度。注释不应该*重述*代码的功能。

这里有很多微妙之处。我认为“读取文件中的所有行”是一个相当有用的意图注释，至少在大多数语言中是这样。但是“把所有的行都写到文件里”怎么样？在许多语言中，比如 Python，这实际上是功能性的重述，然而这也是*和*的意图。

更糟糕的是，“打印计算结果”怎么样？在任何语言中，即使是像 C 或 FORTRAN 这样人类可读的语言，这对于一行程序来说也是显而易见的。然而，给定一个 46 行的字符串格式和打印语句块，这可能是有用的。

我相信这就是为什么表明意图的评论和采纳者报告的一样有用...

> [目标是允许]用任何语言完全重写程序*，只给出注释。(强调我的)*

**关键点:**我认为一个很好的试金石是想象去掉所有东西*但*评论。你有足够的信息完全重写程序吗？此外，这些注释是否与语言无关，如果您从 Python 切换到 Java，它们同样有用？

如果评论太模糊而不能重新创建程序，说明你的评论不够。如果注释过于特定于语言，你只是重述了代码，而不是意图。

换句话说，**注释应该是你的规范的一种活的形式！**我们都知道我们应该有一个规范，但是很少有人真的费心去写一个。在编码时，你可以将意图注释视为编写规范*的一种方式。*

# 有利于意图评论

实际上，意图注释有几个优点。这些绝不是假设；我个人观察到了这些，并且许多都得到了评论表明意图的采纳者的响应。

1.  阅读和理解代码的时间成倍减少。因为你知道*假设*会发生什么，这为你解释那段代码提供了基础。(当你在一次不合时宜的中断后试图回到正轨时，这会派上用场。)

2.  找到特定的功能代码变得更加容易。曾经试图在一个大型的、不熟悉的项目中找到特性 X 的代码吗？你不仅要费力地阅读成百上千的文件，还需要花相当多的时间阅读它们(见第一条)；只有当你能猜出函数名时，搜索工具才有帮助。意图评论给你立足点。

3.  您可以重构开发人员的思维模式。我们可能会浪费大量时间去问“她/他/我到底想做什么？”一个恰当的意图注释回答了这个问题。

4.  注释意图和实际代码结果之间的不匹配凸显了潜在的错误。我们在纯粹的代码审查*中发现了许多错误，因为意图注释与*真正做的*代码不匹配。*

5.  意图注释不熟悉的代码会加快搜索速度。在实践中，如果我正在学习、重构或清理一个代码库，我会从对整个事情进行意图注释开始。从这里开始，我确保完全理解代码，并经常发现许多低效之处。在这个过程中我也学到了很多！

6.  非程序员也可以参与进来。你的主管、客户、设计师、开源用户，无论是谁，都将能够浏览你的评论，并实际了解更多正在发生的事情。因为意图注释是语言不可知的，所以它们为实际有用的反馈提供了基础！(结果可能因人而异。)

7.  代码自动成为一个训练工具。我经常指导实习生阅读代码中特定的意图注释部分。这使得他们能够在野外研究甚至更先进和高度复杂的模式和算法*。我经常被告知这是一次多么宝贵的学习经历。*

 *我知道有很多关于评论的担忧，尤其是像意图评论这样看起来极端的事情！现在就来看看几个吧。

# 完全自我评论代码的神话

“麦克唐纳先生，你的 C++有进步，”你说。“评论在这种笨拙、深奥的语言中可能很好，但`[language]`是自我评论！评论只是行噪。”

我在 Python 开发人员中听到过几乎完全相同的说法。别忘了，我花了相当多的时间在 Python 上，我喜欢代码的清晰和明显。

然而，无论语法多么像英语，**代码实际上永远不能完全自我注释，因为它永远不能捕捉到*你的*意图。**

在阅读 Python 时，我总能看出你在遍历文件中的行并提取特定的子串。我不一定能搞清楚的是*为什么*。

“但这太明显了！我正在从通讯录 CSV 中提取电子邮件地址。”

当然，这对 *you* 来说是显而易见的，但这造成了几个错误的假设:

*   你以为我知道你需要这些信息。

*   您假设我是按照堆栈执行顺序读取代码的。

*   你假设我在你的代码库中，而不是在一个随机的位置；因此，我不是在陌生的领域寻找东西。

*   你认为我拥有和你一样的技术知识。

几乎不可能避免做出这些假设，因为它们来自人类心理学的典型格式塔:我们假设其他人分享我们的经验。

事实是，六个月后，你很可能是自己代码中困惑的那个*。除非你拥有近乎超凡的记忆力，否则你不会记得自己思维过程的每一个细节。就此而言，你可能不记得六分钟*后*，你的同事打断你的工作流程，问他是否可以借你的订书机。*

如果你怀疑我说的是真的，试试这个:

1.  去 GitHub 上用你最喜欢的自我评论语言找一个随机的、活跃的、高质量的项目。确保你不熟悉它。

2.  打开结构深处的随机代码文件。

3.  给自己计时，看你需要多长时间*完全*了解前三个函数发生了什么。你能写一个干净的实现来通过原始函数能通过的任何测试吗？

你可以想重复多少次就重复多少次。不管你对任何一种语言有多有经验，仅仅从语法上完全重现意图是很困难的，甚至是不可能的。

同样，注释应该声明*意图*，而不仅仅是重述代码本身。这是关键的区别。

我很快会回到这个话题，因为**自注释代码是一个重要的概念，它不同于意图注释！**

# 无可奉告？

有一些开发人员强烈主张尽量少注释。这些年来我和很多人谈过，他们都提出了同样的观点。相信我，他们的担心一点也没有根据；相反，我认为他们搞错了真正的问题。

## 关注 1:过时的评论

“评论与代码不同步，”大多数批评者说。

我认为只有当你让评论失去同步时，它们才会失去同步。同样的抱怨也可以针对文档，但是我们没有；预计*会更新文档*。

我的软件公司多年来一直在执行评论标准，我们从来没有遇到过这个问题，原因只有一个:**编码人员应该更新评论以反映代码的变化**。否则它不会通过代码审查。

我不想对任何人无礼，但是如果注释与代码不同步，那只能表明**开发人员的懒惰**。这和我们一开始不写评论是一个道理。我们认为，既然我们现在理解它*，这就是最重要的。*

 *如果你的团队有这个问题，你需要解决他们工作的质量标准。如果你独自工作并有这个问题，你需要建立自律。这与遵循风格、负责任的 UI 设计或者编写好的提交消息没有什么不同:这需要努力，但是纪律是有回报的。

## 关注 2:线路噪声

“注释增加了代码文件的长度，”一些人抱怨道。“我宁愿要 100 行不带注释的 Ruby，也不要 200 行带注释的。

从*本身*来看，长度永远不应该成为编码实践中的一个因素。痴迷于保持低行数是导致过度复杂的列表理解、大脑三元表达式和分号滥用的原因。

然而，正如我所说的，这里潜藏着一个合理的担忧:**评论应该增加价值**。正如我之前所说的，每个注释都应该描述意图，而不仅仅是重述代码。这是一种平衡行为，每个人迟早都会毫无疑问地错过目标，但请记住...**注释可以像代码一样被重构！**

当第一次注释你的代码时，你的首要任务应该是克服你的“明显的”完形。我强烈建议对第一遍进行过度评论，因为你根本没有资格在第一遍就区分“明显”和“不明显”。

在这种情况下，我们实际上可以应用一个古老的行业格言...

> "过早优化是万恶之源."唐纳德·克努特

一旦代码被编写、注释、测试和运行，就让它“老化”吧。转移到其他事情上。给你的大脑时间让它远离你最初的意图，或者找另一个还没有读过你的代码的开发者，然后...

**收拾干净！为了重构注释，重读代码。倾向于*重申*评论，而不是删除它们；让他们专注于意图和语言不可知。如果评论是不可救药的明显，删除它。**

请记住，您的目标始终是一组注释，允许您用另一种语言完全重新创建代码。这是一个活生生的规范。

## 关注 3:时间

“写所有这些评论浪费了大量的时间，”许多人认为。“我更愿意专注于为项目增加价值。”

再说一次，这是人类心理中的一个常见故障:**即时满足**。我们太担心“失去”时间，宁愿感觉自己在进步，以至于忽略了重要的事情。我们现代的“现在就买”文化只会让情况变得更糟。这是最糟糕的短期思维。

生产力专家都同意，从长远来看，在积极的习惯上花费额外的时间实际上节省了时间，比如制定优先待办事项清单，坐下来吃一顿真正的早餐，锻炼身体，或者整理我们的工作空间。如果我们没有这个习惯，把我们宝贵的、稀缺的时间花在“不工作”的事情上会感觉很奇怪，甚至适得其反。

评论真的没有什么不同。通过在编码时花额外的时间写下我的意图，与不写相比，我实际上看到了几个生产率的提高:

*   通过将我的工作记忆转移到评论中，我很少会忘记我在做什么。

*   在编码时，我更经常地*捕捉潜在的错误和低效。*

*   我可以几天、几周或几个月不写代码，只花几分钟回顾我的注释，然后跳回到我离开的地方。没有那些评论，我可能要花一个小时甚至更久；有时候，我甚至不得不放弃一切，重新开始！

*   代码审查从其他人身上花费的时间更少，他们关注更多的错误和潜在的改进。

*   我浪费更少的时间向他人解释我的代码；同事、学生和非编码人员都可以知道发生了什么，而无需我直接参与其中的每一步。

实际上，意图注释节省了我大量的时间。这是对未来的真正投资:现在多花 10-20 分钟*就能为我节省几个小时。*

 *# 信息过载

要做到这一点，我们需要刻意降低*实际*线路噪声！

## 不重述代码

首先，让我再次强调:**评论*仅用于陈述意图*。**这一点我不会重复太多遍！**你应该*永远不要*在注释中重复实际代码！我从来不想看到这一幕...** 

```
# Print out 'hello, <user>'
print(f"Hello, {user}!") 
```

Enter fullscreen mode Exit fullscreen mode

然而，根据周围代码的性质，这可能是有帮助的:

```
# Greet the user.
print(f"Hello, {user}!") 
```

Enter fullscreen mode Exit fullscreen mode

我现在可以用这些信息做一些事情，即使只是搜索问候。(再一次，人为的例子很难证明这一点。顺其自然。)

## 不要“注释掉”

第二，**永远不要提交“被注释掉”的代码**。这是真的*行噪声*，这使得从视觉上解析出意图评论变得更加困难。事实上，您应该使用诸如 Git 这样的 VCS，这已经为您提供了一种查看代码早期版本的方法。

注释显示意图标准的确为“注释掉的”代码定义了一个正式的语法，这有助于区分注释和真正的注释。然而，这应该只是暂时的(预提交)。在提交之前，删除所有“注释掉的”代码。

## 尊重文档注释

**文档注释应该是意图注释的*部分*，而不是一个单独的标准。大多数现代语言都有正式的文档注释语法，你应该将这些作为你意图注释实践的一部分。**

一个好的文档注释应该陈述意图！太多的 API 文档需要读者真正理解实现，这破坏了整个概念。

通过将意图注释应用到我的文档注释中，我甚至让自己的 IDE 体验变得更好了！

顺便提一下，请记住 API 文档不能代替最终用户文档。大多数 API 文档就像通过解释加热元件的电气规格来教某人如何使用烤面包机。请为您的用户编写真实的文档。

## 编写可读代码

你的代码仍然应该清楚地呈现它自己的“什么”。意图注释不是编写深奥、过于复杂的代码的借口。换句话说，**你仍然应该写自我评论的代码！**

正如我之前所说，自注释代码和意图注释是不同的概念，它们都很重要。彼此配对，结果令人难以置信！

即使您打算注释代码，以下规则仍然适用:

*   **变量和函数应该有反映其用途的清晰名称。**相关的文件意图——注释应仅在此基础上展开。`foo`和`t`都是很可怕的名字，不管你怎么评论。

*   不要把复杂和优雅混淆了。你能写出令人敬畏的列表理解或三元语句，并不意味着你应该这样做。再多的评论也无法挽回意大利面代码。

*   不要让你的线长跑了。水平滚动条是不可原谅的暴行。

*   **用一贯的好风格。**我真的不在乎是什么；选择一种编码风格，并坚持下去。

*   以一种提高而不是降低代码可读性的方式来使用像 DRY 和 SOLID 这样的原则。 [有一种叫干意大利面的东西](https://dev.to/codemouse92/clean-dry-solid-spaghetti-1lgm)。

# 最后的想法

我希望我已经清楚地说明了意图评论的情况。[注释显示意图标准](https://standards.mousepawmedia.com/csi.html)是一个很好的起点，但它肯定不是唯一有效的方法。

让我们回顾一下关键概念:

*   注释应该以与语言无关的方式描述代码的预期结果。它应该*而不是*重述代码本身。

*   人们应该能够用任何语言完全重新实现代码，只给*注释。换句话说，您的意图注释是一个活的规范！*

*   自注释代码和意图注释是不同的概念，应该一起使用*。一个不能取代另一个。*

**   只有在你允许的情况下，注释才会与代码“不同步”。代码审查策略可以用来防止这一点！

    *   第一次评论时，倾向于“过度评论”，稍后再重构评论。除非你有一段有意义的时间远离代码，否则你无法辨别“明显”和“不明显”。(“过早优化是万恶之源。”)

    *   不要提交“注释掉的”代码；它增加了行噪声，并且使得从视觉上解析出真正的注释变得更加困难。

    *   在你的文档注释中使用意图注释。

    *   意图注释是一项时间投资，它可以提高生产率和代码质量，并减少开发人员适应代码所需的时间。* 

 *正如我所说的，我实际上已经对自己和我的员工进行了意图评论。我个人可以担保这种回报，我也从其他采纳评论显示意图标准的人那里听到了回应我的观察的声音。

注释您的代码。你以后会感谢自己的。****