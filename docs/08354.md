# 如何在 2019 年让你的团队和你的 JavaScript 项目变得更好

> 原文：<https://dev.to/manuelbieh/how-to-make-your-team-and-your-javascript-project-better-in-2019-827>

这篇文章几周前发表在 Medium 上。因为我说再见，我在这里转贴它。

当我加入一个新项目时(由于我是一名独立的自由开发人员，这种情况经常发生)，我通常会先看看当前的项目设置。这是一个快速了解项目是如何组织的，他们使用什么工具，或者大多数时候，不幸的是，他们没有使用工具的好方法。

我非常喜欢干净、周到和设计良好的设置和过程，我欣赏健康和可持续的代码库，因为它使处理您公司的代码更加容易，更加不痛苦，并且从长远来看，它使您的开发人员更快，因为它导致更易于维护的代码库。

例如，当我看到你的`package.json`时，我想看到一些东西，我真的会建议并鼓励你以某种方式将它们整合到你的工作流程中。一开始可能会很难，有时你的开发人员会咒骂一会儿，但是相信我，一旦你这样做了，你就习惯了，就没有回头路了。

# 工具

让我们从一个在开发社区中备受争议的工具开始。看起来你要么喜欢它，要么讨厌它。起初我属于第二组，稍后我会解释原因。我说的是更漂亮。

## 漂亮些

这是一个以完全统一的方式格式化你的代码的工具。您可以使用 IDE 中的“保存时格式化”选项，手动格式化它，或者甚至创建一个 Git 挂钩来格式化所有自动提交的文件。

> ![Rik Nieu profile image](img/479cb9f3849bd63c2a1b632fdda0ce89.png)Rik Nieu@ Rik Nieu![twitter logo](img/65e26e35707d96169ec8af6b3cbf2003.png)[@ PrettierCode](https://twitter.com/PrettierCode)的 3 个阶段；
> 
> 1。呃，为什么要这样格式化？看起来很奇怪。
> 2。嗯，好吧，我想我已经习惯了。我需要调整我自己的方法...
> 3。天哪，这真是太自由了！2018 年 6 月 15 日上午 06:53[![Twitter reply action](img/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1007516466139234304)[![Twitter retweet action](img/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1007516466139234304)28[![Twitter like action](img/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1007516466139234304)146

我采访过的许多不喜欢 prettle 的开发人员说，他们希望能够控制自己的代码格式，他们经常不同意 prettle 的代码格式。如开头所说，那也是我当初。直到我发现了这个工具的真正价值。

> 大多数时候不是关于你，而是关于你的同事。

有没有想过你的同事在格式化代码时使用的那种超级奇怪的编码风格？当你阅读那个同事的代码时，你的同事在阅读你的代码时，很可能会有同样的想法，你想过吗？更漂亮的不会发生。

Prettier 只有很少的选项，并且根据一些非常复杂的规则来格式化你的代码。他们也欢迎新的公关。虽然你不会总是同意 Prettier 认为你的代码应该如何格式化，但相信我，这释放了这么多的精神能量。

> ![Ivan Čurić profile image](img/946aee62a82cb61194819e6156846a4d.png)伊万尤里奇@ _ baxuz![twitter logo](img/65e26e35707d96169ec8af6b3cbf2003.png)“如果你不喜欢 [@PrettierCode](https://twitter.com/PrettierCode) 如何格式化你的代码，那是因为你太在意代码的格式🤷‍♂️"
> 
> —[@ kentcdodds](https://twitter.com/kentcdodds)
> 
> 👏👏👏2018 年 10 月 16 日上午 11:07[![Twitter reply action](img/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1052154040765898755)[![Twitter retweet action](img/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1052154040765898755)51[![Twitter like action](img/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1052154040765898755)218

把精力花在想写什么而不是怎么写上！想怎么写就怎么写，按下 CTRL+S，然后看着 beautiful 完成它的工作。它真的释放了如此多的精神能量。我想说，自从 2010 年改用 Git 以来，它可能已经成为我的开发人员工具链中最有价值的工具。

> ![CRON MATTINGLY profile image](img/c777034f1b16c065ba01c77de583c50d.png)CRON matting ly[@ ken _ wheeler](https://dev.to/ken_wheeler)![twitter logo](img/65e26e35707d96169ec8af6b3cbf2003.png)耶性是很酷，但是你有没有在文件上点击保存并启用了更漂亮的功能？03:18AM-05 Sep 2018[![Twitter reply action](img/269095962147c28351274afdd5486a48.png)](https://twitter.com/intent/tweet?in_reply_to=1037178073966362625)[![Twitter retweet action](img/771160ecf06ae3d4d7a7815c29c819c2.png)](https://twitter.com/intent/retweet?tweet_id=1037178073966362625)28[![Twitter like action](img/c077611ab2a5e0b4cd0c826ee7ae1e48.png)](https://twitter.com/intent/like?tweet_id=1037178073966362625)355

另一个明显的好处是:我们可以结束是否使用分号以及 2 或 4 个空格是否是缩进的正确级别的争论。你可以将这一决定大部分委托给一个计算机程序，并准确地写出你认为适合你的代码。

所以我的建议是，如果还没有发生的话:**给你的项目添加漂亮的元素！**更重要的是:让你的文件更漂亮地自动运行，以确保即使是那些仍然拒绝在 IDE 中使用它的同事也能以每个人都能阅读的方式推送他们的代码。我记得有一个同事拒绝使用它，后来用 25 个对象的数组提交了模拟数据进行测试。全部。英寸一个。线。不。不要那样，求你了。

这让我们直接找到了下一个候选人。

## Husky，lint-staged 和 install-deps-postmerge

哈斯基在自述文件中简单描述了自己:

> Git 挂钩变得简单

是的。事情就是这样。这使得编写 Git 钩子成为一种幸福！不再需要只在您的机器上运行的 shell 脚本，不再需要安装 ruby 或 python 来运行某个 Git 钩子。安装**哈士奇**，创建一个`.huskyrc`文件，在里面放几个简单的命令。

**Husky** 与 **lint-staged** 和 **install-deps-postmerge** 结合使用效果尤为出色。lint-stage 对所有暂存文件运行 linters，允许您在文件最终被推送到 GitHub 之前对其进行修改。另一边的 install-deps-postmerge 在您从远程(例如通过`git merge`)合并文件后运行*，然后检查您的`package.json`和您的 lockfiles ( `yarn.lock`、`package-lock.json`)的更改，并自动更新您的依赖项。*

在我的典型设置中，我用它来自动让我所有的暂存文件在放到 GitHub 之前运行得更漂亮。这是我添加的一个典型的预提交钩子。另一个是 ESLint 检查，它让您的提交失败，以避免在您的代码库中有潜在的有害代码。这就引出了我们下一个非常有用的工具。

## ESLint

很难想象还有其他团队**不**在他们的 JavaScript 项目中使用 **ESLint** ，但是相信我，确实有。我甚至不太关心你到底使用了什么规则以及你是如何配置它们的，但是你至少应该涵盖那些可能导致你的代码出现严重错误的最常见的错误(比如`no-redeclare`、`no-undef`或者许多其他的错误)。

如果您可以在开发时而不是运行时捕获 bug，为什么不这样做呢？我创建了自己的个人 eslint-config，并将其作为一个包发布在 npm 上。一个客户让我花一天时间来找出哪些规则在他们 2016 年的 React 项目中最有意义，所以我根据这些新获得的知识创建了自己的包，其中包含了我认为有用的所有规则。你可以在这里找到它:[https://www.npmjs.com/package/eslint-config-wiremore](https://www.npmjs.com/package/eslint-config-wiremore)

虽然我真的很努力地定期更新它，但可能会有比我的配置更好、维护更频繁的 ESLint 配置。就这一点而言，我真的可以推荐看看 eslint-airbnb-config。

顺便说一下，ESLint 和 Prettier 整合得非常好。所以他们在一起是一个伟大的组合。

## 跨 env 和 dotenv

当我开发软件时，我遵循 12 因素方法。这是我向我所有的客户推荐的东西，因为它使你的软件可预测、可维护和可理解。该方法的一部分是为了。在环境中存储配置。当然，环境变量指的是环境。

这就是**跨环境**和**溺爱**发挥作用的地方。这两个工具都是为了让开发人员更容易处理 env 变量。 **cross-env** 顾名思义，让你可以在所有不同的平台(Windows、Unix、Mac)上使用 env 变量，而不必考虑特殊的语法，尝试检测用户正在使用的操作系统或终端等。只需在您想要运行的命令前面加上 **cross-env** ，然后加上您想要设置的 env 变量，就万事俱备了。

```
$ cross-env HELLO=world node -e 'console.log(process.env.HELLO)'
> world 
```

另一个工具， **dotenv** ，用于在运行时(节点)或构建时(webpack、rollup 等)将所有 env 变量拉入您的应用程序。).它允许你将所有的环境变量保存在一个单独的`.env`文件中，一旦你将 **dotenv** 导入到你的应用程序中，这个文件就会自动加载。

dotenv 也尊重你的命令行环境变量，它们优先于你的。默认情况下为 env 文件。它与 **cross-env** 配合得很好，所以我推荐一起使用它们来给你的设置增加一些可维护性。

# 流程

一方面有工具，另一方面也有流程。工具可以帮助你获得正确的过程，支持你保持代码库干净整洁，但是对于某些事情，你需要在工具有限或不适合的地方建立某些过程。

## 记录你正在做什么，如何做，以及为什么要这样做

大多数开发人员不喜欢做的事情是编写文档。我知道有时候写东西比写代码更难，但是有一个好的文档是非常重要的，特别是如果你有很高的波动性，并且你经常有新的团队成员加入。好的文档不一定要有一整本书那么大。您可以从存储库中的一个简单的`README.md`开始。

设置一个项目，就像你是自己团队的新人一样，克隆 repo，安装所有依赖项，收集所有必要的环境变量，并将其放入你的`.env`文件中。写下每一步。不要忘记你很久以前做过的 obivous 事情:安装 Node/nvm。安装有用的编辑器插件，如漂亮或 ESLint。提供所有这些内容的链接，并试着把它想象成你是团队中的一名初级开发人员。

然后记下开发、试运行和生产环境的所有链接。给出 pull 请求部署到哪里(如果有)以及在哪里可以找到到您的 CI 的链接的提示。我向你保证，它可能甚至不会花费一个小时，但作为回报*会为你**节省***几个小时的工作时间，无论你是加入新人还是从头开始建立项目。如果东西过时了，鼓励你的同事修理它们。

这样，他们甚至可以创建他们的第一个拉动式请求，这种感觉总是很好。在一个新项目的第一天创建一个拉式请求总是令人满意的，即使你实际上只修复了一个打字错误或一个断开的链接，但它给你强烈的感觉，现在，在你的第一次公关之后，你已经是团队的一员了。

如果你正在构建可安装的软件包(例如通过 npm ),写一个变更日志通常也是一个好主意。有时“决策”文档也是有用的。用它来记下为什么你用你的方式做了某些事情。它可以给未来的团队成员有价值的提示。

## 开发工作流程

理想情况下，你的主分支(通常是`master`和/或`develop`，有时还有`stage` / `staging`)是受保护的，并且**团队中没有人**有直接将代码推送到这些分支之一的访问权限。所有工作都应该在树枝上进行！在我看来，无论你是在特性分支还是开发者分支工作，或者你是否严格遵循 Gitflow，都没有多大关系，但更重要的是，你真的应该**永远不要**让你的任何开发者直接进入一个主要分支！

目标是确保*每一个变更*都经过了至少一个开发团队成员的同行评审和批准。所有大型 Git 服务(GitHub、Gitlab、Bitbucket)都有这样一个特性。这是一个简单的方法来确保至少最明显的 bug 可以在部署之前被*捕获。它还将责任从一个人分割到至少两个人——PR 的原始创建者和审阅者。*

这样做还能确保代码能被其他人理解。如果你的团队中审查你的分支的其他成员不容易理解代码的某些部分，你应该考虑简化它，因为这并不总是容易做到的，至少在那里添加一些注释，以便有一些关于那里正在发生什么的内联文档。

保持较小的拉取请求。它们更容易复习。它们更容易恢复。如果在评审中发现了错误，它们也更容易修复。

也许最重要的是:**鼓励**你的团队成员有一个良好的回顾文化！认真对待它，不要低估彻底的代码审查的价值。我有一个项目，平均每个工作日我花一个小时甚至更长时间在代码评审上，我从来没有见过这么高质量的代码库。

高质量代码库的价值是什么？开发人员的满意度、忠诚度和长远发展:你通过理解几个月前已经完成的工作来提高速度，同时不必每天浪费几个小时来修复 bug，仅仅是因为你 3 个月前的粗心大意，只是为了节省 20 分钟的时间。当然，代码评审本身并不能让你的代码没有 bug 或者更好的维护，但是根据我的经验，我可以说评审过程在团队中的优先级越高，随着时间的推移积累的技术债务就越少。

这反过来通常会让您的开发人员感到高兴，因为没有人喜欢难闻的代码，这自然会让您的开发人员想要编写干净的代码来保持高标准。

## 保持您的依赖关系最新

最糟糕的事情莫过于在新版本的浏览器或设备中发现了一个 bug，却无法修复它，因为您的一些旧依赖关系与依赖关系树中的其他依赖关系不兼容，而这些依赖关系是修复这个 bug 所必需的。去过那里。做完了。花了将近一周的时间来更新一个项目中的依赖项，这个项目已经有将近一年半的时间没有得到任何人的喜爱了。

在那段时间里，新的 iPhone 和新的 iOS 发布了，由于一些奇怪的原因，我客户的网站无法正常工作了。这个 bug 的根源在依赖关系树的深处，需要更新项目的一个核心依赖关系，这本身就需要一个新的 jQuery 版本等等。等等。等等。长话短说:那是一种痛苦。

因此，即使你的产品只处于“维护模式”，你也应该至少花*一些*努力来定期更新你的依赖项。至少，比方说，每两个月。如果你仍然在积极开发你的产品，你应该花更多的时间来更新你的依赖关系。如果你经常这样做，至少每月一次，通常在半小时内就能完成。当然，假设您已经对应用程序的最重要部分进行了测试。在 npm 中，您可以运行`npm outdated`来查看哪些依赖项已经过时，在 yarn 中，您甚至可以通过在终端中运行`yarn upgrade-interactive`来轻松更新它们。

# 结论

有很多方法可以提高代码库的质量、开发人员的幸福感以及公司的整体表现。其中一些要求相关人员的心态稍作改变，一些可以在几分钟内实现，并对你的团队、你的产品和你的公司的成功产生巨大影响。

在这篇文章中，我试图说明一些你通常可以很快实现的事情，而不会遇到太多的阻力。我鼓励你尝试一下。不是所有在一个团队中很有效的东西在另一个团队中也同样有效。我所描述的东西大多被认为是“最佳实践”,所以它们至少应该对大多数团队有效。

试试看！告诉我你是否做到了，这对你和你的团队是否有效！