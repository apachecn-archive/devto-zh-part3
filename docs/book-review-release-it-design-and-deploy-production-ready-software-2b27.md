# 书评:发布吧！设计和部署生产就绪软件

> 原文：<https://dev.to/raoulmeyer/book-review-release-it-design-and-deploy-production-ready-software-2b27>

这本书[发行吧！](https://amzn.to/36j7IfM)讨论将功能完整的应用与生产就绪的应用区分开来的所有方面。这是一个实用和具体模式的集合，将帮助您改进系统的架构。我真的很喜欢读它，并且已经找到了一些应用书中知识的方法。

让我们来看一下精选的外卖食品。

## 积分点

这本书广泛讨论了集成点。集成点形成了相互通信的组件之间的边界。因为在几乎所有的情况下，组件之间的通信都涉及到网络，所以是否所有的东西都按照预期发送和接收只是一个概率问题。此外，每个组件随时都有可能不可用。您设置集成点的方式定义了平台稳定性的很大一部分。

当一个组件不可用时会发生什么？在很多情况下，这将导致其他组件也不可用。想象一下，一家网店使用第三方服务在结账时验证您的信用卡信息。根据业务需求，信用卡验证中断可能会导致客户无法完成订单。根据实现情况，服务关闭可能会导致整个网站崩溃，因为大量请求在等待无响应的服务。

假设一个系统由几个组件组成，每个组件之间都有几个集成点，这种类型的级联故障风险很大。我们如何防止故障在我们的系统中蔓延？

## 处理失败

为了减少其他组件故障的影响，您可以用多种方式保护您的集成点。最重要的方法是在调用远程组件时使用超时。通过超时，您可以确保您的组件不会在调用上浪费太多资源。当一个组件失败时，一个常规模式是调用组件中使用的线程数量增加。在大多数情况下，同时运行的线程数量是有限制的。使用超时，可以减少这些空闲线程对组件的影响。

当您知道某个组件在过去几分钟内没有按预期响应时，继续尝试是没有意义的。有可能你的组件无论如何都在让情况变得更糟。相反，通过应用[断路器](https://martinfowler.com/bliki/CircuitBreaker.html)模式，对故障组件的调用甚至会在开始之前就被取消。每隔一段时间，就会接通一个电话，检查故障组件是否已经恢复。这减轻了已经发生故障的组件的压力，并使调用组件使用更少的资源。

[![Chaos engineering](img/f2086acbc2e44b5f58bbb047494a083e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--7d8z4s4M--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/kq6z87yruhsy27ygssw4.png)

为了验证您的组件对其他组件的故障具有弹性，您可以(并且应该！)测试一下。由网飞推广的[混沌工程](http://principlesofchaos.org/)是一种定期移除或禁用系统的某些部分，以验证系统在没有该部分的情况下仍能正常运行的原理。这可能是关闭(虚拟)机器，更改防火墙规则以阻止特定流量，甚至可能是拔掉整个数据中心的插头。通过使这成为一个常规的事情，你将不得不确保你的组件很好地处理它，并且当它真正发生时你不会措手不及。

## SLO 的和 SLA 的

在可用性和性能方面，将您希望系统实现的目标变得非常具体是很常见的。这通常是通过就服务水平目标达成一致来实现的(SLO)。比如你可以同意`99% of search requests by customers should be handled in less than 1 second`。如果未达到此目标会产生后果(如退款或罚款)，这些后果将与相关的 SLO 一起记录在服务水平协议(SLA)中。

SLO 是一个有用的工具，可以使围绕可用性、性能和成本的权衡讨论变得更加容易。申请信用卡来提高可用性或性能始终是一种选择，相关的 SLO 将有助于确定这是否是正确的事情。

这类目标的难点在于它们受其他因素影响的方式。如果您要求另一个具有特定 SLO 的组件可用，那么您的组件永远无法提供更好的 SLO。如果有多个依赖项，这种影响会成倍增加，这是经常发生的情况。在书中，这被称为 SLO 反演。

现在，您可以通过查看组件的所有集成点，以及基于硬件和连接性的预期可用性，来确定实际的 SLO。然而，采取相反的方法更有意义，首先确定一个 SLO，然后对您的基础设施进行更改(如果需要)以符合该 SLO。这也是谷歌关于网站可靠性工程的书中描述的方法，该书强调不要“根据当前表现选择目标”。

## 结论

如果您的应用程序不可用，那么您可能会赔钱或失去满意的客户。本书中的建议可以减少停机的机会，如果停机仍然发生的话，可以减少停机的持续时间。它包含了令人难以置信的大量好建议，并且以这样一种方式呈现，使得根据给出的建议开始改进事情变得容易。

这是我读过的最有用的书之一，我肯定会推荐你[去看看](https://amzn.to/36j7IfM)！