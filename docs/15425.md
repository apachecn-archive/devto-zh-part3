# 创建您自己的 Vim 命令

> 原文：<https://dev.to/dlains/create-your-own-vim-commands-415b>

如果您使用 Vim 已经有一段时间了，那么您会遇到 Ex 命令。见鬼，您使用 Ex 命令退出 Vim`:quit`，或者只是`:q`。有 Ex 命令可以完成 Vim 中可以完成的几乎所有事情。

您也可以创建自己的 Ex 命令。许多 Vim 插件都添加了自己的 Ex 命令作为插件的一部分。您可能认为创建一个新的 Vim 命令很难，但事实并非如此。我将在这里向您展示基础知识，以及在哪里可以找到更多信息。

## 打开一个参考文件

我发现如果有我想要构建的东西，学习起来会容易得多，所以这是将要构建的命令。

我经常会遇到一种特殊的代码编辑情况。我正在处理一些代码，比如说一个 HTML 页面，我需要添加一个在项目的一个 CSS 文件中定义的类名。但是我不记得班级的名字了。我想在一个拆分窗口中打开 CSS 文件，这样我就可以看到它，但我不需要编辑它。

这在 Vim 中很容易做到，只需简单地`:vsplit [path_to_css_file]`CSS 文件就可以在一个分割窗口中获得。

啊，但是有一个问题。使用`:vsplit`在一个新的 Vim 窗口中打开 CSS 文件，使其成为活动窗口，并将我正在编辑的 HTML 文件移到右边。我真正想要的是在右边的窗口中打开 CSS 文件，并继续编辑 HTML 文件。

我只需要 CSS 文件作为参考。

在这篇文章中，我将创建两个命令。一个是在右侧的垂直窗口中打开参考文件，并保持当前窗口处于活动状态，另一个是在底部窗口中打开参考文件的同一命令的水平版本。

在这个过程中，我将描述 Vim `:command`命令及其选项，这样如果需要的话，您可以创建自己的 Vim 命令。

## `:command`命令

没错，创建用户自定义命令的 Vim 命令是`:command`。您可以在 Vim 中单独使用`:command`来获取用户定义的命令列表。如果您忘记了自己创建的命令名或从插件加载的命令名，这将非常方便。创建用户命令时，`:command`采用以下形式:

```
:command [args] Name actions 
```

当然，您创建的新命令必须有一个名称，否则您如何调用它。名称必须以大写字母开头。这是 Vim 的要求，用于将用户定义的命令与内部 Vim 命令分开。不过有一个例外，它不能被命名为`:Next`。显然 Vim 打破了自己的规则。

一旦命令开始工作，您可以通过输入`:Name`在 Vim 中使用它，但是，您知道，用实际的命令名替换 Name。

我将这些命令命名为`:Ref`和`:Vref`，以遵守 Vim 惯例，对于水平窗口为`:split`，对于垂直窗口为`:vsplit`。所以到目前为止的命令是:

```
:command Ref
:command Vref 
```

### Optional Args

`:command`命令接受零个或多个可选参数。其中最重要的是`-nargs=`参数。这让 Vim 知道命令是否接受任何参数。可以设置的可能值为:

*   0:该命令不接受任何参数。这是默认值，因此可以完全省略。
*   [1-9]:该命令采用指定数量的参数。
*   *:该命令接受零个或多个参数。
*   +:该命令接受一个或多个参数。
*   ？:该命令接受零个或一个参数。

我想要构建的命令将接受一个参数，即要打开的引用文件的路径，所以我将使用`-nargs=1`。

您可以通过多种方式访问参数。首先，在命令的`actions`部分的某处使用`<args>`。第二，如果你需要确保参数在表达式中被正确转义，你可以使用`<q-args`。最后，如果要将参数传递给 Vim 函数，可以使用`<f-args>`。

这些命令中使用的另一个参数是`-complete=`。这个参数让 Vim 知道命令可以使用哪种制表符结束。有三十多个不同的值可以设置。这里涉及的太多了，但是有些值是`buffer`完整的缓冲区名、`dir`完整的目录名、`help`完整的帮助主题名和`file`完整的文件和目录名。

需要的最后一个参数是`-bar`参数。这告诉`:command``actions`可以包含一个竖线`|`后跟额外的 Ex 命令，或者一个双引号`"`后跟注释。在这些新命令中，我需要两个不同的 Ex 命令，所以它们需要用竖线隔开。

您可以向`:command`提供的其他一些参数有:

*   `-range`允许该命令可以对当前缓冲区中接受的一系列行进行操作。
*   `-count`允许您为命令提供重复计数。
*   `-register`允许您指定未命名寄存器以外的寄存器。

有关可用的`:command`参数的更多信息，请查看`:h user-commands`。

有了为新命令定义的参数，我们最后得到:

```
:command -nargs=1 -complete=file -bar Ref
:command -nargs=1 -complete-file -bar Vref 
```

剩下的工作就是创建执行命令时要采取的动作。

### 命令动作

Vim 文档实际上称之为替换，因为它用您在这里指定的一个或多个命令替换了您的命令名。我发现行动更直观一些。在任何情况下，这都是您希望在 Vim 中输入命令时发生情况。

用户命令文档没有说任何关于动作的其他内容，我想是因为所有其他文档都是适用的。这里可以使用任何 Ex 命令来达到预期的效果。

对于我的例子，我想用命令中指定的文件在右边或底部打开一个新窗口，但保持当前窗口活动。内置的`:split`和`:vsplit` Ex 命令没有我想要的行为。

我查看了关于`:split`的 Vim 文档，心想也许有一个参数可以给出我想要的行为。它确实需要几个参数，但是它们与文件格式和文件打开时光标的位置有关。不是我真正想要的。

在`:split`的文档中，我找到了`splitbelow`和`splitright`的设置。如果你选择`:set splitbelow`，那么用`:split`创建的新窗口将会在当前窗口的下方而不是上方创建。`:set splitright`也是如此；将在右侧创建新窗口。

这看起来正是我想要的。在定义命令之前，我可以在我的`.vimrc`中设置这些值，一切都会如我所愿。

虽然这可行，但我并不喜欢这个解决方案。这将改变每个拆分窗口的默认值。如果没有必要，我不喜欢更改默认设置。稍微深入研究一下`:split`文档附近的 Vim 文档，我发现了完全正确的东西。

分割窗口命令有命令修饰符，称为`:rightbelow`、`:leftabove`、`:topleft`和`:botright`。这些是 Ex 命令，但被称为修饰符，因为它们只接受另一个 Ex 命令作为参数，并覆盖`splitbelow`和`splitright`设置。

`:rightbelow`修饰符只是执行你作为参数提供的任何命令。如果提供的参数打开一个拆分窗口，它将根据参数将其打开到右边或下面。所以，现在的命令是:

```
:command -nargs=1 -complete=file -bar Ref :rightbelow :split <args>
:command -nargs=1 -complete=file -bar Vref :rightbelow :vsplit <args> 
```

命令差不多完成了。剩下要处理的唯一问题是创建的新窗口仍然是活动的。这很容易修复，我只需添加一个窗口移动命令，使前一个窗口再次活跃。

我最初的想法是使用 Vim 窗口移动命令；`<C-w>k`移动到上方窗口，`<C-w>h`移动到左侧窗口。但是 Vim 没有正确解析它。显然所有的命令都必须是 Ex 命令。

我不得不翻遍 Vim 帮助主题，但是我找到了我需要的。所有 Vim 窗口命令都可以通过`:wincmd` Ex 命令激活。因此，无论何时你输入`<C-w>x`，你也可以使用`:wincmd x`。

最后的命令如下。

```
:command -nargs=1 -complete=file -bar Ref :rightbelow :split <args> | :wincmd k
:command -nargs=1 -complete=file -bar Vref :rightbelow :vsplit <args> | :wincmd l 
```

你有它；两个全新的 Vim 命令。它们接受一个参数，即文件的路径，这个参数可以通过`<Tab>`完成。他们在一个新的分割窗口中打开文件，或者在当前活动窗口的右侧或者下方，然后移动到先前的活动窗口。

我希望您喜欢这次通过 Vim 命令的小旅行。Vim 提供了如此多的灵活性。只需一点点努力，深入研究帮助文件，您就可以构建自己的 Vim 命令来完成几乎所有您需要的事情。