# 受重力影响趴下

> 原文:[https://dev.to/cheetah100/get-down-with-gravity-epm](https://dev.to/cheetah100/get-down-with-gravity-epm)

## 重力视觉

Gravity Vision 汇集了各种灵感来源，为业务工作流自动化系统提供了一幅完整的图像。它吸取了从使用其他无法满足业务需求的业务工作流工具中学到的经验教训。

工作流自动化系统的基本目的是管理现实世界中的业务流程，这些流程可能需要几天或几周才能完成，并且可能涉及复杂的人工交互以及现实世界中的制造、包装和交付。

传统上，计算机系统擅长处理清晰的问题，这些问题可以被分解成清晰的、可遵循的顺序程序，但却不擅长处理包含高度不确定性、复杂性和长时间发生故障的过程。批量处理 10，000 个电话呼叫很容易，将单个客户连接到电话系统可能很复杂，涉及物理安装和实物供应。

重力已经被开发来处理这类复杂的真实世界过程。它不是作为一个只能解决特定种类的专业问题的解决方案而编写的。例如，尽管它已经被用于电话服务的提供，但是没有什么特别的重要性将它与电话提供相结合。这是一个真正的通用业务流程工作流自动化系统。

## 重力作为看板

重力的灵感之一是看板方法。最初，看板是一个卡片系统，当每个流程完成时，它会在物理板上移动。它有助于实现准时生产。看板方法的成功导致它被引入软件开发领域。从那时起，看板方法被合并到软件项目管理软件中。

一个这样的系统是 AgileZen，它最初用于管理供应系统。AgileZen 系统成为后来用于 Gravity 的自动化方法的初步概念证明。

这个 AgileZen 系统的卡片上有一些标准字段，如所有者、预计时间和工作描述，但没有项目领域的特定字段。看板系统中的卡片本质上是一个自由格式的文本条目。Gravity 从看板方法中借用了电路板和卡片的概念。随着业务流程的进展，卡片在不同阶段之间转换。一张牌只能处于一个阶段，这使得棋盘的可视化对用户来说很容易理解。

然而，Gravity 并没有遵循看板方法来处理卡片的细节。大多数业务流程需要具有特定字段和值的格式良好的数据。在 Gravity 中，卡片基于包含字段定义的模板。因此，卡片将包含明确的字段和值，而不是一个大的自由形式的文本字段。

Gravity 不仅存储字段，还将数据存储在一个强大的数据存储中，允许用户搜索他们需要的卡片。这项技术允许我们生产过滤器，从那些显示的卡片中排除卡片。

## 重力自动化

重力自动化系统的灵感来自于 2004 年在 Net (NBN)对依赖树的研究。2004 年，一家投资公司使用 NBN 工作流系统实现了房产销售流程的自动化。房产销售流程包括多个阶段，如创建买卖协议、签署协议、准备抵押申请和考虑 LIM 报告。

依存关系树自动化系统检查哪些自动化动作满足了它们的依存关系，如果满足，那么它们将执行该动作。依赖性可以是另一个动作的成功完成、卡的当前阶段或者是否设置了某个值。依赖关系树自动化是基于事件的，因为事件启动了检查依赖关系是否满足的过程。

依赖树方法用于自动化由 AgileZen 管理的供应流程。敏捷和自动化的新结合是对 JBoss JBPM 系统不灵活问题的回应。现有的流行流程引擎(如 JBPM)的性质意味着它们不能以可适应的方式处理复杂的流程。

自动化敏捷在一定程度上被证明是有效的，但是很明显，这个解决方案有很多问题需要我们去解决。

## 表演

敏捷不是为处理数千张卡片而设计的。随着卡片数量的增加，性能开始下降，因为一次显示的卡片数量太大。

我们需要一个能够处理大量活动卡而不降低用户体验的系统。Gravity 通过两种方式解决了性能问题。首先是用于存储数据的技术，这使得搜索和过滤更加灵活和强大。第二种方法是通过保持只返回客户机真正需要的数据来减少返回的数据量。当有一大组卡片要显示时，它们会随着用户向下滚动屏幕而成批加载。

## 格式良好的数据、搜索和过滤

AgileZen 将大多数卡片数据存储在一个文本字段中。虽然我们找到了在这个文本字段中存储字段的方法，但这意味着无法基于这些字段进行搜索或过滤。我们需要一个系统，允许我们根据存储的任何字段进行搜索和过滤。

但是我们不想要一组静态的硬编码字段。我们需要一个模板，但是它可以被用户创建和修改。正如在“性能”一节中所描述的，Gravity 从一开始就被设计为使用一个高级数据存储，它允许我们基于字段搜索和过滤卡片。这个数据存储不需要我们定义表或数据模式，也不需要定义索引。使用这种技术的实际意义是能够提供我们需要的搜索和过滤功能，而无需将我们自己束缚在特定的数据结构或领域中。

## (英)可视化(= visualization)

董事会的敏捷视图可能包含大量令人困惑的数据。除了要花很长时间来加载之外，它还令人困惑，难以导航。我们需要一个显示器，让用户能够专注于他们真正关心的卡片子集，无论是处于特定阶段的卡片，还是符合某种过滤标准的卡片。我们希望用户能够轻松地在视图之间切换，以便快速找到他们需要的卡片。

此外，我们不想显示一张卡片的所有数据，而是允许用户选择一个视图，提供对他们有用的字段子集。同样，这个想法是将数据量减少到对用户完成工作有用的程度。

为了提供这些特性，我们已经为 Gravity 开发了一个基于 REST 的用户界面，该界面只拉回所需的最少量的数据。结合先进的数据存储，我们提供了丰富的用户体验，表现良好。

因为用户界面使用 REST，所以所有获取数据的 web 服务都是公开的，这意味着很有可能可以在这些 web 服务的基础上构建其他可视化来为其他用例优化用户界面。

## 定义业务规则

对于所有以前的工作流自动化引擎解决方案，需要进行大规模部署来更改业务规则或工作流。对于 JBPM 及其相关产品，您需要部署一个新的流程，此时只有流程的新实例将开始遵循新流程，而旧实例将继续遵循旧工作流。

然而，即使在 NBN 工作流程解决方案和 AgileZen 自动化系统中，业务规则和操作也是用 XML 定义的，不进行软件部署就无法更改。对于系统管理员来说，部署意味着停机和痛苦。

我们需要的是一种无需重新部署就能改变业务流程和行动的方法。我们需要一种方法让这些变化在已经在处理的卡上立即生效。

Gravity 通过将所有业务规则和操作存储在数据存储中，打开了适应性和运行时修改的大门。当管理员更改业务规则时，更改会立即生效，卡将开始遵循新的业务规则。

这极大地改变了解决生产问题的周转时间，管理员能够在发现问题后几小时内进行修改，而不是几天甚至几周。

目前，我们有一个对业务规则进行修改的 API，没有用户界面。目的是为管理员和经理构建一个易于使用的用户界面，允许他们创建和修改业务流程。时间限制意味着我们无法建立这个新的用户界面。我们已经建立了一个过程可视化系统，它允许我们生成如上的过程图。

## 运行自动化

AgileZen 的自动化方法包括定期下载所有卡片，以评估业务规则并触发操作。即使卡片没有被修改，也可以被下载和检查。这有两个影响。首先是自动化很少运行，可能每小时一次。如果进行了更改，自动化需要一段时间来拾取和评估它。第二个问题是这种方法给 AgileZen web 服务带来的巨大负担。我们需要一种更加高效的方法，只在已经改变的卡上运行业务规则。

Gravity 被设计为接收来自数据存储的通知。当卡被修改时，数据存储器触发通知给 Gravity，让它知道已经有修改。这样 Gravity 就知道哪些卡被修改了，然后可以对修改后的卡运行业务规则。这样，对卡的任何更改都将触发业务规则运行。这种方法极大地减少了数据存储服务器上的负载。

## 重力建筑

“企业级”这个词经常被提起，但在 Gravity 的情况下，该架构被设计为高性能、可伸缩、灵活和高度可用。它被愤怒地用来处理 ISP 的核心任务关键系统。

### 表演

现有系统的核心限制之一是用户体验非常慢。一个关键的业务系统不仅需要在技术上可用，还必须对用户有合理的响应时间。在每个阶段，我们都检查并优化了性能，以确保 Gravity 的性能符合用户的期望。

### 可量测性

性能与可伸缩性密切相关。随着处理负载和用户数量的增加，能够保持性能的真正关键是实现一种向外扩展的方式。Gravity 中有三个不同的集群，每个集群都可以根据需要扩大或缩小。第一个集群是 Gravity 的工作节点，处理用户界面 web 应用程序和自动化工作负载。还有一个消息传递集群来处理所有工作节点之间的消息传递。最后是实际存储所有数据的数据存储集群。

### 灵活的

Gravity 应用程序支持插件服务，允许您将特定于业务的服务添加到 Gravity 安装中。Gravity 已经可以连接各种外部服务，比如 SOAP 和 REST。

### 高度可用

由于 Gravity 的集群特性，您可以获得开箱即用的高可用性。即使您确实需要重启 Gravity 实例，也不需要关闭整个集群。Gravity 需要的所有服务也是集群化的，让您高度确信您的业务关键流程不会出现停机。

[更多信息](http://devcentre.org)