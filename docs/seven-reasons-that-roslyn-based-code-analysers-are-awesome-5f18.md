# 基于 Roslyn 的代码分析器令人敬畏的七个原因

> 原文：<https://dev.to/tdwright/seven-reasons-that-roslyn-based-code-analysers-are-awesome-5f18>

静态分析是确保代码健壮和干净的好方法。不幸的是，许多静态分析工具非常昂贵和/或极其复杂。在今天的帖子中，我想谈一谈基于 Roslyn 的代码分析器，它不需要任何成本，并且易于设置。事实上，坚持读下去，因为有七个理由证明他们是高手。

### 罗斯林？代码分析器？

让我们了解一些背景知识。我说的罗斯林代码分析器到底是什么意思？

嗯， **Roslyn** 是转变的“编译器即服务”。NET 编译从一个神奇的黑盒到一个可询问的，可扩展的框架。作为编译器，Roslyn 规范地知道与代码的语法和语义相关的一切。通过以这种方式打开编译器。NET 团队使其他代码有可能访问对代码的这种明确理解。

我所指的**代码分析器**是基于 Roslyn 的库，它可以标记出你的代码在哪里违反了他们的准则。每个分析器都有自己的一套规则。每当构建代码时，您安装的“规则集”就会运行。可以调整规则的严格程度，甚至可以忽略它们。(显然)通过接入诊断 API，[创建自己的分析器](https://github.com/dotnet/roslyn/wiki/How-To-Write-a-C%23-Analyzer-and-Code-Fix)也是相当容易的。

### 他们为什么伟大

1.  它们不花一分钱。正如普通读者所知，[我是用于静态分析的 NDepend](http://blog.tdwright.co.uk/2017/12/20/static-analysis-with-ndepend-a-first-look/) 的粉丝，但我不得不承认其成本令人不快。基于 Roslyn 的代码分析器无法与 NDepend(或 ReSharper)的能力相抗衡，但它们是完全免费的。
2.  它们**设置**很简单。字面上只是添加 NuGet 包。你可以在睡觉的时候做。(不信我？继续读。)
3.  他们真的很挑剔。他们发现即使是最迂腐的人也会在代码审查中遗漏的东西。无论是[超细微的设计点](https://docs.microsoft.com/en-gb/visualstudio/code-quality/ca2104-do-not-declare-read-only-mutable-reference-types?view=vs-2015)还是简单的[不正确的间距](http://stylecop.soyuz5.com/SA1019.html)，代码分析器都会发现它。
4.  他们**不忘**。你会记得使用`ToLowerInvariant()`的危险或者为什么你应该使用`ToUpperInvariant()`来代替吗？没有吗？我也是，但幸运的是我们 [CA1308 做](https://docs.microsoft.com/en-us/visualstudio/code-quality/ca1308-normalize-strings-to-uppercase?view=vs-2017)。
5.  他们不礼貌。为了办公室政治，你有没有想过放弃一些小烦恼？我们都有。这只是人之常情。好消息是代码分析师*不是人类，不在乎受伤的感觉。不是针对个人的！*
6.  他们擅长于开始一场对话。不喜欢一个规则？嗯，也许我们可以在我们的规则集中将其设置为忽略。但首先，你得说服我。让我们进行讨论，并确保我们都理解为什么规则在那里，以及忽略它可能意味着什么。让我们做出一个积极的集体决定。
7.  他们在你构建代码的任何地方工作。一旦配置完成，您的分析器将在您的代码生成时运行。无论构建发生在您的笔记本电脑上还是您的 CI 系统中，您都可以放心，因为没有人会签入违反您已经同意的规则的代码。

看到了吗？代码分析器棒极了！他们可以认真地帮助*让*你的代码库更整洁、更健壮，然后他们可以帮助*保持*那样。

### 好的，我被说服了——我该如何开始？

正如软件开发世界中的许多事情一样，代码分析器最难的事情是其他人。你需要让他们相信自己的价值，并确保整个团队都认同。一旦你做到了这一点，安装技术就变得轻而易举了…

1.  选择您想要的分析仪
2.  通过 NuGet 安装它们
3.  恢复包
4.  构建您的代码
5.  查看输出
6.  (可选)创建自定义规则集文件来调整消息严重性

真的就这么简单。我推荐的两个优秀的通用代码分析器是受人尊敬的组合 [FxCop](https://www.nuget.org/packages/Microsoft.CodeAnalysis.FxCopAnalyzers) 和 [StyleCop](https://www.nuget.org/packages/stylecop.analyzers/) 。

如果你正在做一个新项目，你现在可以开始了。如果您正在对现有项目进行代码分析器改造，请关注即将发布的帖子！

### 包装完毕

希望我已经介绍了使用 Roslyn 代码分析器自动对代码应用规则的好处。

对我来说，吸引力的一部分在于主要的规则集是从一些非常聪明的人那里有效提取的智慧。它们绝不是福音，但它们是开始讨论的好地方，而且通常看起来来自一个明智的地方。

我喜欢认为代码分析器和单元测试在同一个领域。两者都是自动检查，我们可以添加到我们的代码库。从本质上说，机器人希望帮助我们尽可能保持代码的整洁和健壮。当然，与单元测试相比，自动化代码分析可以更快地起步。

正如我上面提到的，最难的往往是“软技能”方面——获得同事的认同。对此没有快速的解决办法，但是我建议从谦逊的角度出发；没有人愿意认为代码分析器的引入是对他们自己的糟糕代码的判断性回应。对整个事情保持积极的态度，专注于使你的(复数)代码更加健壮。

另一个棘手的问题是，如果你决定在现有的代码库中添加代码分析器。剧透:你会淹没在信息中。我使用了一个基于 Excel 的系统来帮助解决这个问题，我将在我的下一篇博文中分享它！

我很快会回来发布更多关于 Roslyn 代码分析器的帖子，但现在就这些了。感谢阅读！希望你觉得有用。如果你以前使用过代码分析器，也许可以在下面的评论中让我知道你的进展。事实上，为什么不让我知道你最喜欢的规则？