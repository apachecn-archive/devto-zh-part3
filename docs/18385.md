# 您的支付卡有多少个密码？

> 原文:[https://dev . to/aivarsk/how-number-pins-your-payment-card-has-3kni](https://dev.to/aivarsk/how-many-pins-your-payment-card-has-3kni)

首先，我们必须谈论支付卡 PIN(个人识别号码)是如何验证的。如果你有一张芯片卡，并且使用支持芯片的终端支付，并且设置正确，芯片上运行的软件可以“离线”验证 PIN。PIN 也可以由发行卡的金融机构或代表金融机构处理卡交易的组织以“在线”模式进行验证。

我不知道在“离线”模式下使用哪种算法来验证 PIN，因为实现可能不同，我也不知道芯片软件的标准。

## [](#online-pin-verification)【在线】PIN 验证

PIN pad 设备对您输入的 PIN 进行加密，并将其与金融信息一起发送给发行方进行验证。发卡方不存储明文 PIN，通常使用 [HSM](https://www.thalesesecurity.com/products/payment-hsms/payshield-9000) (硬件安全模块)来生成和验证 PIN，而不会以明文形式显示它。事实上，发行者根本不能存储任何东西，除非他们想用旧的 PIN 码更新支付卡。在基于 [ISO-8583 的](https://en.wikipedia.org/wiki/ISO_8583)消息中接收验证 PIN 所需的一切:

*   密码块(加密的密码)
*   要比较的“散列”值，通常来自磁条的磁道 2 或来自芯片卡的等效数据
*   pinblock 在传输过程中被加密或重新加密的密钥
*   生成或分配 PIN 时由颁发者使用的密钥

大多数 HSM 使用并支持两种算法来生成“散列”值并在以后进行验证:

*   IBM 3624 偏移方法
*   签证方法也称为 PVV (PIN 验证值)

我见过一些使用 IBM 方法的发行商，但在大多数情况下，VISA 方法不仅被 VISA 使用，还被 MasterCard 和其他卡组织使用。

## [](#pvv)PVV

PVV 的计算方法如下:

(pan+pvki+pin)<sub>pvkey</sub>->pvv

它需要 11 位的 PAN(主要账号-您的卡号)，一位的 PVKI (PIN 验证密钥索引)通常只是一个常数“1”，4 位的 PIN。产生的 16 位数字被视为 8 字节的十六进制表示，并使用三重 DES PIN 验证密钥进行加密。然后使用某种奇怪的算法从 8 个加密字节中选出 4 个数字。

但从中得出的主要结论是，16 位输入变成了 4 位输出。我喜欢称之为使用密码术的散列函数。像所有的散列函数一样，这个也有冲突。

## [](#how-many-pins-have-the-same-pvv)有多少个图钉有相同的 PVV？

所以我写了一个脚本并用随机 PAN 和 PIN 验证键值做了一些测试。使用真实的 HSM、真实的卡号和真实的 PIN 验证密钥也复制了类似的结果。对于 10，000 个输入 PIN 值(全是 4 位数的值)，仅计算出大约 6，400 个唯一的 PVV 值。

几乎每张卡都有一组 6 个 PIN 值，它们都产生相同的 PVV 值。有些卡甚至有一组 9 个 PVV 相同的 PIN 值。

从不同的角度来看这些结果:

*   只有 36%的 PIN 值具有唯一的 PVV
*   大约 36%的 PIN 值有另一个具有相同 PVV 的 PIN
*   大约 9%的引脚值有两个具有相同 PVV 的其他引脚
*   等等。

## [](#conclusion)结论

您的卡有 60/40 的机会有不止一个正确的 PIN。就像一些人赢得彩票一样，一些人设法用“不正确的”PIN 执行交易，并因为 PVV 碰撞而获得批准。