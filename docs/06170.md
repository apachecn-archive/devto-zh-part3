# 从 GitLab 到 Heroku 的火箭应用部署

> 原文:# t0]https://dev . to/matdark/deploy-de-application-rocket-from-gitlab-a-heroku-4p jg

本文将介绍部署使用拉斯特开发的应用程序的步骤，从[【gitlab】](https://gitlab.com)到**[【heroku】](https://heroku.com)**的存储库。

## [](#gitignore)。吉蒂尔

从本地开发环境执行测试时，会在编译期间生成一些临时文件，因此为了防止它们与存储库同步，应创建文件“`.gitignore`”。档案应包含下列内容:

```
# Generated by Cargo
# will have compiled files and executables
/target/

# Remove Cargo.lock from gitignore if creating an executable, leave it for libraries
# More information here https://doc.rust-lang.org/cargo/guide/cargo-toml-vs-cargo-lock.html
Cargo.lock

# These are backup files generated by rustfmt
**/*.rs.bk 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

也可以在 **[gitignore.io](https://gitignore.io/)** 中创建此文件。搜索栏键入程序设计语言(Rust)的名称，单击“**create**”将生成相应的“`.gitignore`”并将其下载到存储库中。

[![gitignore.io](../Images/16226daecf943de5ee3475d3182e0f9c.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--AHGqECZh--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/ar6n3tv92ib3p4t6r5a5.png)

## [](#heroku)Heroku

**[【heroku】](https://heroku.com/)**支持 Node.js、Ruby、Java、PHP、Python 和 Go 等语言和技术，以及通过社区开发的建设包(build packs)进行拉斯特等语言。

在 Heroku 中创建应用程序后，将进行相应的配置。

`Settings`分段进行以下设置:

*   将添加相应的构造包的 URL，对于拉斯特为“`https://github.com/emk/heroku-buildpack-rust.git`”。![Buildpacks](../Images/56e24534532dce9fab5fc18c240a7941.png)

从中访问应用程序的 URL 的格式为“`https://nombre-aplicacion.herokuapp.com`”。

*   从[帐户设置](https://dashboard.heroku.com/account)复制密钥 API。![Heroku API Key](../Images/a9034b542d3b778c5d802ef00c406406.png)

## [](#gitlab)GitLab

### [](#gitlab-ci)GitLab CI

**GitLab** 有自己的持续整合系统。它支持多种语言，如 Java、PHP、Ruby、c 和 Rust。它是开源的，根据在[网站](https://about.gitlab.com/product/continuous-integration/)上提供的信息，可用于 **GitLab Community Edition** 和**gitlab enterprise edition**。

要执行此操作，必须将 key API 值添加到存储库配置中:

*   Ir a `Settings` > `CI/CD` .
*   在`Expand`节中点击`Expand`。
*   添加变量`HEROKU_API_KEY`，并分配先前复制的 key API 值。
*   将变量标记为“`Protected`”。![API Key](../Images/a76de437622547e79d7f3b94d59575f7.png)

### [](#repositorio)存储库

在存储库中创建文件`Rocket.toml`、`RustConfig`和`Procfile`。

`Procfile`文件指定 Heroku 用于部署的拉斯特版本，因为默认情况下它下载稳定版本，火箭需要 Nightly。

```
VERSION = nightly 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Rocket.toml 文件设置了应用地址，如《官方文件》所示。

```
[global]
limits = { forms = 32768, json = 32768 }

[development]
address = "localhost"
port = 8000
log = "normal"

[staging]
address = "0.0.0.0"
port = 8000
log = "normal"

[production]
base_url = "https://nombre-aplicacion.herokuapp.com"
log = "critical" 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

最后，`Procfile`档案会写入启动应用程式的指示。

```
ROCKET_PORT=$PORT ROCKET_ENV=prod ./target/release/nombre-binario 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

Heroku 动态分配端口，因此在文件“`Rocket.toml`”中未指定该端口，因为该端口是使用“`ROCKET_PORT=$PORT`”获取的，此外还指示应用程序在生产环境中使用“`ROCKET_ENV=prod`”和相应的二进制路径“`./target/release/nombre-binario`”运行，如“`./target/release/nombre-binario`”中所示

然后创建文件`.gitlab-ci.yml`，对应于 **GitLab** 的持续集成系统配置，该文件应包含以下内容:

```
stages:
  - build
  - production

variables:
  CARGO_HOME: $CI_PROJECT_DIR/cargo

rust-nightly:
  stage: build
  image: rustlang/rust:nightly
  script:
    - cargo build --verbose
    - cargo test --verbose
  cache:
    paths:
      - target/
      - cargo/
  allow_failure: false

production:
  image: ruby:2.2
  stage: production
  script:
    - gem install dpl
    - dpl --provider=heroku --app=nombre-aplicacion --api-key=$HEROKU_API_KEY --strategy=git
  only:
    - master 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

规定了要执行的任务阶段，即“T0”和“T1”，分别对应于施工测试和部署到 Heroku，指出了正在使用的拉斯特版本，Rocket 占据了 nightmare。最后，放置在 Heroku 中创建的应用程序名称和 key API 变量。此外，还会生成项目缓存，以避免在不存在更新时下载和编译所有依赖项。

添加此文件后，将对项目进行第一次测试。每次发送到存储库时，都会执行新的测试。测试可以从`https://gitlab.com/usuario/nombre-repositorio/-/jobs`实时查看。
[![GitLab CI Jobs](../Images/acb8f0da5b59fcc487793eedc4508403.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--wZmQKhov--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/a9sts4s1mk8mfwceb05c.png)

配置完成后，会将一个小更改发送到存储库进行测试，然后部署到 Heroku。

此 URL 中可以看到一个示例:[https://slide-gallery . herokupp . com/](https://slides-gallery.herokuapp.com/)和 GitLab 存储库[在此](https://gitlab.com/mattdark/reveal.js-gallery)。

希望本教程对您有所帮助。