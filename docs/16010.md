# 模板引擎的真相

> 原文：<https://dev.to/cocoroutine/truth-about-template-engines-3a7>

### [T1】简介](#intro)

我今天写的是内容模板引擎，比如 Shopify 的 liquid，
Python 的 Jinja，Mustache 等等。我来这里是为了最终回答这些
我相信你们都有过的紧迫问题。

*   无逻辑和全逻辑哪个更好？
*   为什么这么多？
*   如何选择一个？

我有什么资格评判模板引擎？我为一些最大的财富 500 强公司写过网页和电子邮件模板。其中一些是大而复杂的订单确认和机票预订，充满了令人眼花缭乱、难以理解的商业逻辑。

这是 2 部分系列的第 1 部分。

### 我们来定义一下逻辑

随着 Mustache 的出现，无逻辑模板开始流行。除了小胡子不是真的没有逻辑。有控制流、循环，甚至还有通过 lambdas 定制的
代码。如果你在没有 lambdas 的情况下使用 Mustache，我会认为这是你能得到的最接近逻辑的东西，但仍然有用。

在我看来，完整的逻辑就是你可以自由地将内容和任意代码混合到你的模板中。这样的例子有 ERB、XSLT 和
下划线。

一些介于两者之间的是半逻辑模板。可以通过预定义过滤器和/或自定义过滤器引入逻辑。半逻辑模板如果被滥用，会导致全逻辑模板。这一类包括液体，Jinja2，车把，Nunjucks 和许多其他产品。

作为一个像 React 和 Vue 这样的应用程序框架，我会考虑全逻辑模板引擎加上包括厨房水槽在内的一切。

### 无逻辑 vs 全逻辑

在一个完美的世界里，你的数据在你的表示层中按照你想要的样子排列。您永远不需要在模板中编写任何业务逻辑。这就是无逻辑模板完美匹配的地方，也是每个人都应该努力的地方。

这些样式模板非常容易阅读。这些谁都看得懂，写得出来。与难以阅读和书写的完整逻辑形成对比。

那么为什么要用全逻辑呢？全逻辑模板有很多优点。它们非常灵活，当你不想写复杂的控制器逻辑时，你可以快速修改。我在模板中写了一些疯狂的业务逻辑，因为总有一些客户的需求是不正常的。

在我与许多客户打交道的经验中，数据几乎从不符合演示需求。

### 了解你的受众

不是每个人都是程序员。从我的经验来看，任何试图向一大群非程序员教授简单控制结构之外的东西的人，都不会有好日子过。让您的模板引擎变得更简单可以让它获得更广泛的技术专业知识。

想象一下，如果 Shopify 使用了 ERB。培训所有客户并使用随机脚本来解决业务逻辑是一件令人头疼的事情。模板编写者不是后端编码员。鉴于任何人都可以通过模板自由执行 ruby 代码，这也是一个很大的风险。

即使对于有经验的程序员组成的大型团队，我仍然认为使用全逻辑模板引擎是一种反模式。全逻辑只是导致 HTML 内容夹杂着难看的代码。嵌入在代码中的逻辑将很难测试，并且会引入错误。

我在一个由经验丰富的技术专家组成的大型团队中编写 XSLT。XSLT 本身就是一种冗长而复杂的模板语言。简单的修改很好，但是更大的修改需要几个小时来编写和测试。然而，我们仍然这样做了，主要是为了解决我们产品中的缺口。

### 完全符合逻辑可以吗？

是的，我会说在某些情况下，使用全逻辑模板是没问题的。如果你的团队很小并且是有经验的开发者，你会很好。然而，如果你发现自己过于依赖它，这可能意味着你的设计有一些问题。当你的团队变得越来越大，经验越来越少的时候，你就会开始积累技术债务。

### 为什么有这么多？

它们写起来相当简单。似乎每种语言都有自己的全逻辑和半逻辑版本。Python 和 JavaScript 似乎领先一步，还有更多的被创造出来。

另一个原因是“这里没有发明综合症”。Shopify 的 Liquid 和 Mozilla 的 Nunjucks 可能犯了这种错误。虽然可能更多的是法律原因。

模板引擎不断发展。例如，Twitter 喜欢 Mustache，但增加了模板继承并编写了 Hogan。Ember 的手柄也是在 Mustache 的基础上构建的，通过添加 AST 来确保生成的模板是正确的 html。这在开源世界中并不新鲜。

总的来说，我认为模板引擎的数量是不错的。模板引擎可以非常个性化。重复我上面提到的，一个人在模板引擎中需要的，另一个人可能不需要。也许程序员只是想挠痒痒。

### 如何选择一个？

你总是想尽可能地远离逻辑思维。如果你可以只留胡子而不用兰姆达斯；你应该去做。否则，一些无逻辑的过滤器/助手，如液体和手柄，可能是最佳选择。

但请永远不要走完全的逻辑。

我最喜欢哪一个？没有。当前的模板引擎已经足够了，但还不够完美。当然还有空间容纳另一个模板引擎。