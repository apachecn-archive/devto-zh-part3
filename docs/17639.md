# 开放式问题:我如何从 Node.js 上传文件到 S3，同时有一个进度条和调整图像大小的能力？

> 原文:[https://dev . to/pan phora/open-question-how-I-can-upload-files-to-S3-from-nodejs-while have-a-progress-bar-the-capability-resize-the-image-4c kn](https://dev.to/panphora/open-question-how-can-i-upload-files-to-s3-from-nodejs-while-having-a-progress-bar-and-the-ability-to-resize-the-image-4ckn)

你好，戴夫·托，

这是一个公开的求助/建议请求。我是这个社区的新成员，但我是它的长期粉丝。

我有一个问题，希望你能帮忙解决。我想把这个贴在 Stack Overflow 上，但是我希望这里的对话比那里的更开放。

我目前正在开发一个 web 应用程序，其中图片上传是一个核心组件。我上传工作和实施，与进度条显示用户的上传状态。我还可以在图片上传后对其进行裁剪/调整大小。我目前正在用`multer` npm 包做这些事情。

然而，每当我部署我的服务器时，我使用的 PaaS 清除所有上传的文件，因为新的部署替换了旧的。因此，我需要切换到上传到第三方服务，如 S3(或开始在数字海洋托管我的网络应用程序)。

最近，我用配套的包`multer-s3`上传到了和`multer`一起工作的 S3。然而，使用`multer-s3`，我失去了跟踪上传进度的能力。如果你查看 AWS SDK 触发的`httpUploadProgress`事件，你会很快发现[事件只在上传结束时触发——而不是像你期望的 AJAX `progress`事件那样一秒钟触发多次。](https://github.com/aws/aws-sdk-js/issues/1323)

因此，如果我想保持支持文件上传，并仍然有一个进度条，这里是我的选择:

1.  使用第三方服务，如 Cloudinary 或 Transloadit 或 Uploadcare 或 Imgix 等。等。
2.  使用[预先指定的 Url](https://docs.aws.amazon.com/AmazonS3/latest/dev/PresignedUrlUploadObject.html) 将图片直接上传到 S3

或者....3.彻底摆脱进度条。

对我来说，我不明白为什么这是一个如此困难的问题。我觉得*一定有*一个我不知道的简单解决方案。

快速浏览我不喜欢当前选项的原因:

1.  第三方服务将我锁定在他们的 API 中。其中一些服务需要 jQuery 和/或其他大型前端库，以便直接上传到它们(我更喜欢端点)。而且，如果我选择直接从我的服务器发送文件以避免这些额外的客户端依赖，从他们的文档中不清楚这些服务是否会返回一个进度事件...然而，最终，这些服务的主要问题是成本。如果我自己花 1-2 美元就能做到的话，我永远也不想每月花 20-50 美元来处理文件上传(尽管，在这一点上，这可能是值得的)。

2.  第二个选择，使用预先设计好的 URL 从客户端直接上传到 S3，在近期内会很好，因为我现在还不想修改图片。然而，在不久的将来，我肯定会看到将一些图像转换成 WebP 格式，供支持该图像格式的浏览器使用——或者从较大的 2-20MB 的图像中去掉一些脂肪。

至于删除进度条的选项...我认为这是一个巨大的可用性增强！作为一个用户，知道你的工作什么时候保存，需要多长时间真的很好。我想我可以显示一个无限负载指示器，但是我担心那些慢速连接的人，他们可能坐在那里，不知道这个愚蠢的指示器什么时候会停止旋转...只是等待，等待...

所以，我真的被困在这里了。一方面，我觉得用进度条上传图片(以及之后在后端修改图片的能力)应该是一个已经解决的简单问题。然而，另一方面，我强烈考虑咬紧牙关，使用 Cloudinary 之类的东西，即使它可能会使我的客户端 JavaScript 包的大小翻倍(这是我非常想避免的)。

因此...你知道我遗漏了什么服务或套餐吗？你知道有什么东西可以让我把 Node.js 中的文件上传到第三方存储服务，比如 S3，*同时*向用户显示一个进度条，*同时*不会给我的客户端 js 增加很多依赖，*同时*让我能够在上传后优化/裁剪/转换图像？

现在我想起来...也许这个*是*很多要求...呵。想想看，10 年前，当后端开发人员*告诉我这是一个难题时，我是难以置信的...🙈*

任何开源解决方案都是一个巨大的优势，但每月 10 美元的上传服务也很棒。

这是一个公开的讨论，欢迎所有的建议！😬😁☃️节日快乐！