# 区块链和一致协议:活性和正确性是不可分的

> 原文：<https://dev.to/blockstack/blockchains-and-consensus-protocols-liveness-and-correctness-are-inseparable-65p>

在区块链的世界里，*共识协议*被广泛讨论。然而，通常很难区分竞争协议并对其进行评估，尤其是因为并不总是清楚特定协议如何解决共识问题，或者特定问题如何与区块链的实际问题相关联(例如，我的交易何时得到确认？我在哪个岔道上？).在这篇文章中，我将概述共识协议试图解决的问题，详细说明一个有效的共识协议应该实现什么，希望这将有助于传达解决这个问题的方法可能会取得成果。

粗略地说，共识协议旨在实现互不信任方之间的协议。在像比特币网络这样的网络中，节点试图就下一个块中包含什么达成一致。在这个网络中，块告诉我们已经广播了哪些事务，以及这些事务的顺序。其他共识协议通常是相似的——它们告诉客户端操作应该应用的顺序。

作为一个共识协议的用户，你最初可能会想“嗯，我不太关心操作的顺序和时间，只要我能保证那些操作是正确的。”的确，正确性是一个重要的属性。但是，这个属性完全与操作的顺序和时间有关。要了解原因，让我们看一些示例事务。

**T1:** 公钥 A 将硬币“Z”转移到公钥 B

**T2:** 公钥 A 将硬币“Z”转移到公钥 C

**T3:** 公钥 B 将硬币“Z”转移到公钥 D

现在，当单独检查时，确认这些交易是正确的是微不足道的。对于交易 1 和交易 2，验证者只需要*确认交易是由对应于 a 的私钥签名的。这可以用相当枯燥的密码术来实现，并且已经解决了几十年的问题。但是单独检查这些事务并不有趣，也不能提供有用的正确性度量。我想知道我是否“拥有”硬币 Z，在这个意义上，没有人可以在没有我的允许下令人信服地试图转移硬币。共识协议对此有什么规定？*

嗯，重要的是，在共识协议中，网络中的客户端和节点达成一致的对世界的*看法，*，并且该对世界的看法包括交易的排序。一旦我们可以对事务进行排序，我们就可以开始评估它们在特定时间点是否有效。例如，如果共识协议确定在时间 0，硬币“Z”由公钥 A 拥有，并且交易被排序为 T1、T3、T2——那么显然 T1 和 T3 是*有效的，*但是 T2 是*而不是*(因为在 T1 广播之后，Z 由公钥 B 拥有，而不再是公钥 A)。然而，如果协议确定交易是有序的 T2、T1、T3，那么只有*T2 是有效的。显然，*顺序*和*时序保证*关系重大。幸运的是，这正是共识协议试图提供的。*

共识协议在顺序和定时方面提供了两种保证:

1.  安全:只要协议中的错误参与者不超过某个阈值，其他参与者就不能说服客户接受不正确或无效的消息。
2.  **活性:**只要协议没有超过某个阈值的错误参与者，其他参与者就不能无限期地延迟接受正确的消息。

在区块链的背景下，这些保证通常意味着什么？正如我们之前看到的，在区块链上验证不正确的消息几乎是微不足道的。这是否意味着安全是一个微不足道的属性？当涉及到事务的时间安排和事务的顺序时，为什么活跃度很重要？这些和福克斯有什么关系？

为了将这一点映射到区块链的背景中，我们必须首先理解，*确切地说，*区块链正试图就达成共识*。事实证明，答案不是消息，甚至不是交易:而是历史。一位区块链客户一直试图找出哪个交易历史是“真实的”历史。根据前面的交易示例，客户需要判断这两个可能的历史记录中哪一个是正确的:*

**历史 1:** 交易 1，交易 3。

**历史二:**交易二。

*Nakamoto* consensus 使用工作证明挖掘和“最长链获胜”指标来决定哪个历史是正确的历史。如果网络中的所有节点都是诚实的，那么这个历史*应该与预期的*历史相匹配。

有了这种理解，我们现在可以提出与区块链有关的两项共识保证:

1.  **安全性:**只要协议没有超过某个阈值的错误参与者，其他参与者就不能说服客户接受错误的历史，
2.  **活性:**只要协议没有超过某个阈值的错误参与者，其他参与者就不能阻止客户端接受某个历史作为正确的历史。

有趣的是，当谈到区块链时(尽管这是大多数一致协议的真实情况)，我们通常对正确性、有效性、排序和时间性等属性的理解要求同时保证 T2 的安全性和 T4 的活性。这正是区块链的本性。如果我想确信我不会被“双重花费”攻击，我需要知道，首先，事务将被及时接受，其次，一旦被接受，事务很可能不在孤立块中。

这就是为什么安全性和活性是容错协议不可分割的属性。容错协议使用技术来保证影响安全性的活性，反之亦然。例如，在实际的拜占庭容错(最有影响力的容错共识协议之一——我推荐阅读麻省理工学院的[99 论文](http://pmg.csail.mit.edu/papers/osdi99.pdf))中，副本使用的两阶段提交机制确保副本取得进展，但它也是新消息被接受到协议历史中的方式。如果这个机制有问题，它将影响*的安全性和活性。这些性质在缺少另一个的情况下不能被有效地处理或证明——一个假设活性的协议可以是平凡安全的。消除安全顾虑的协议总能取得进展。*

如果区块链要彻底改变人们在互联网上互动的方式，我相信他们会的，那么这些区块链的正常运作是非常重要的。当评估各种平台的技术和计划时，记住区块链试图解决的基本问题是至关重要的。从根本上说，这个问题是一个老问题:达成共识，同时容忍一些有缺陷或恶意的行为者。在理论和实践中，这意味着提供活性和安全性保证。然而，这些保证是不可分割的，因为提供一个保证的机制总是会影响另一个保证。

现在，当评估那些试图在达成支持开放区块链的共识的新机制方面取得进展的项目时，充分解决这两个问题的项目最有可能取得成果。像 [Stellar](https://www.stellar.org/) 这样的项目在一个联邦模型(非开放的)中使用一致协议，但是提供良好的容错保证。[algrand](https://www.algorand.com/)在构建容错协议方面也取得了重大进展，尽管处理开放成员集的问题仍然悬而未决。我们自己的区块链设计工作提供了容错保证，同时还通过燃烧证据挖掘实现了开放成员资格。这项工作的进展可以在我们的[block stack-core Github repository](https://github.com/blockstack/blockstack-core/pull/888)上的 pull 请求中跟踪。

帖子[区块链和共识协议:活性和正确性不可分](https://blog.blockstack.org/blockchains-and-consensus-protocols-liveness-and-correctness-are-inseparable/)最早出现在 [Blockstack 博客- Blockstack](https://blog.blockstack.org) 上。