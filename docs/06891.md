# 用破碎的窗口构建软件

> 原文:[https://dev . to/jackmarchant/building-software-with-broken-windows-CLI](https://dev.to/jackmarchant/building-software-with-broken-windows-cli)

有没有感觉到添加这“一点小技巧”，几行代码，不会对代码库的其余部分产生太大影响？你想都没想就添加了它，说服你的团队成员让这个新特性上线是正确的决定。理论上，一般来说，我会同意这样做，但每个黑客都是不同的，所以很难用同一把刷子刷它们。如果你已经从事软件开发足够长的时间，你可以在一英里之外看到这种代码。如果你不小心，这种代码会困扰你的梦。

回到正题，你添加的有点不合标准的代码引入了第二次添加的可能性，而没有你之前可能遇到的来自团队成员的同样的保留或质疑。上次也做了类似的决定，所以这次我们就不追究了。你甚至可以添加一个评论，详细说明这种攻击和推理，在合并之前拍拍自己的背。

这种态度会很快累积起来，甚至你都不会意识到。我将这归类为技术债务的例子——债务是你预期由于这样或那样的原因需要重写的代码块。随着时间的推移，您会引入像这样的代码，这些代码不具备应有的性能，或者没有以可扩展的方式编写。科技债务应该像绷带一样使用，作为止血的临时措施，但时间太长，就会开始流血。

在某个时候，你将不得不偿还这笔债务，并找出一种方法来删除你或你的团队为获得“快速胜利”而添加的代码。有些比其他的更容易和更直接。当您添加代码时，一个好的经验法则可能是:“删除它有多容易？”。移除代码是理所当然的。我们假设我们编写的代码将存在很长时间，但实际上事情经常变化，所以我们需要能够移动代码，删除代码，或者完全重写代码。代码的轻松删除应该是某个东西创建得很好的标志，而不是与许多其他文件或函数纠缠在一起。

对代码库不利的是，随着时间的推移，黑客越来越多，你发现自己欠下了大量技术债务，这可能会改变人们对代码库的态度。这种效应在软件开发中被称为“破窗”,当看到已经破损或形式不良的东西时，你会贬低自己对它的看法，所以你要么让它破损，要么通过打破更多的窗口使事情变得更糟。

在这个比喻中，你的代码库是一个房子，你和你的团队就住在这个房子里。当你添加一个黑客，就像打破一扇窗户。第一个你可以补上来阻止冷空气进入。然而，不修补它将会打开更多破碎窗户的闸门。很快，你家里就会有三四个。当门把手在大量使用的压力下不可避免地断裂时，在看到所有破碎的窗户后，你可能会让门开着，不再关门，而不是修理它或买一个新的把手。

### [](#how-did-we-get-here)我们是怎么到这里的？

当你的代码库是一个不可维护的烂摊子时，这对业务、对你都是不利的(你必须不断地修复它),如果它不能变得更好，它会让你团队中的其他人退出。

从一个简单的黑客到所有这些不好的副作用，这看起来有点戏剧性，但这不是黑客本身，而是随之而来的态度。如果不加控制，这些决定会随着时间的推移堆积起来，而你却没有意识到。

### [](#how-do-we-fix-it)我们如何修复？

第一步是知道你有问题，就像其他问题一样。识别代码库中的问题区域，没有人敢去的地方，除非他们被迫添加新功能。听起来很熟悉，对吧？与其为了重构代码库而花时间重构部分代码，我可能会补充说，现在比以后更难说服任何人值得这么做，我建议等到你有了需要在那个领域实现的特性，或者可以从重构中受益。如果构建特性会更容易的话，这些弹药可以帮助你在特性工作本身之前优先考虑重构。把它当成一项投资。

用特性本身来规划软件的重新设计，意味着到了添加特性的时候，应该是小菜一碟——假设规划和执行进展顺利。

无论它是一个随机的黑客攻击还是软件的一个糟糕的架构部分，你都可以用同样的方式来处理这些问题。如果你认为重构为时已晚，你需要完全重写，我会劝你三思，因为根据我的经验，完全重写几乎总是更难，除非有其他因素在起作用，而不仅仅是糟糕的代码。想要重新开始并致力于一套新的如何构建软件的指导方针可能很有诱惑力，但从长远来看，你最终需要在你的团队中有足够的纪律性来发现问题并解决它，而不是因为它变得如此糟糕而需要重新开始。

在 Elixir 中，我认为当你考虑模块和函数时，重构是最容易的，这与面向对象编程语言中的层次结构相反。当然，由于过度使用 OTP 特性和来自宏的元编程的明显间接性，您仍然可能在 Elixir 中陷入困境。总的来说，我发现它比我用过的大多数其他语言都要简单。

从一个不可维护的代码库发展到一个易于添加新特性的代码库，你所需要的只是一个简单的思维方式的改变。编程中一个流行的规则是童子军规则:“总是让营地比你发现它时更干净”，这与编程有关，意味着当你看到坏掉的东西时，你就修复它——当你触摸代码时。

让代码库处于当前的状态并与您的团队(或者您自己，如果您是单干的话)讨论改进，并为您希望它处于的状态做计划也是有帮助的。当你能就代码库的外观达成一致时，每次你写代码时就更容易向那个目标迈进。随着时间的推移，这将随着正确的态度得到回报。

科技债务是一种神秘的野兽，可以摧毁公司、团队和软件。通过理解这样的问题是如何在软件开发中出现的，就有可能限制它的影响。

给读者的提示:有计划的技术债务不是编写糟糕代码的借口，也不应该在不同的特性中连续发生——你可能会遇到比你想象的更多的麻烦！

*原载于[jackmarchant.com](https://www.jackmarchant.com)T3】*