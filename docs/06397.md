# 为什么测试是片状的——外部依赖性

> 原文:[https://dev . to/Fran tzen/why-tests-is-flacky-external-dependencies-4h 25](https://dev.to/frantzen/why-tests-are-flaky-external-dependencies-4h25)

当处理测试自动化的时候——特别是当使用成熟的浏览器界面进行 web 测试时——最大的问题之一就是所谓的*脆弱测试*。你也可以称之为*不稳定测试*，通常这个概念有多种含义。让我们将一个易变的测试定义为一个测试，当在一个不变的环境和系统中运行几次时，会得到不同的结论。

有这样的行为可能意味着两件不同的事情:

1.  即使环境和系统设置没有改变，当运行几次测试时，系统确实表现出不同的行为。所以在这个帖子的意义上是非确定性的:[![frantzen image](../Images/bd5d74713dc7054273e22514b5d7e232.png)](/frantzen) [## 测试中的不确定性——如何做错

    ### 拉斯 弗兰岑四月 14 日 196 分钟阅读

    #测试# web dev#初学者#计算机科学](/frantzen/nondeterminism-in-testing-how-to-do-it-wrong-3ff9)
2.  测试用例不能在每次运行中使系统总是处于它所采取的每一步的相同状态

第一种选择意味着系统表现出非决定性的行为。这是一个特殊的话题，通常不意味着有一个古怪的测试。对于片状测试，我们通常指的是第二种选择。这个选择可能有很多根本原因。一种常见的(糟糕的)处理脆弱测试的方法是重新运行失败的测试用例，看看它们是否通过了第二次(或者更晚)的测试。这需要时间，也不是办法。相反，要让测试稳定。我将在这里指出一些实际的发现，为什么测试用例可能是古怪的，以及你能做些什么。

我在这篇文章中看到的根本原因是在你的测试用例中有*外部依赖*。在 web 测试中，这可能意味着您的测试用例不仅访问您想要测试的网页和相应的系统，还访问您用来执行测试的其他页面或服务。

作为一个例子，我被要求看一个相当古怪的测试案例。测试用例从以前的测试工具迁移到我们最近的基于 PHP 的工具 [Codeception](http://codeception.com/) 。测试用例必须为某个字符串计算散列码。由于以前的测试工具没有计算散列的选项，测试用例的作者通过访问外部 web 页面来计算散列，从而解决了这个问题。因为这个测试用例正是以这种方式迁移到 Codeception 的，所以它在那里做了同样的事情。

使用这种外部页面是剥落的根本原因。等待并访问外部页面上的计算结果是非常不稳定的。因此，人们开始添加更多的等待，以及各种奇怪的东西，最终形成了计算哈希值的片状助手方法。此外，您向外部页面添加了一个依赖项。如果该页面关闭，您的测试将无法运行。

那么解决方案是什么呢？在这种情况下，只需使用普通 PHP 来计算散列。这是拥有一个使用通用编程语言的测试工具的巨大优势之一。您可以在测试中使用该语言的全部功能。另一方面，这也是一个危险，因为人们可能会引入太复杂和不可读的代码。但那是不同的话题。

所以，在最后，我可以用一行 PHP 代码替换这段混乱的代码:

[![Hash in PHP](../Images/71510bcd2689379fd9437eb3c612d86f.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--HCfM3Hv3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5ktx28k3axw5q1ynau0f.png)

这可能是一个非常明显且容易解决的案例。的确如此，但是一般来说，拥有外部依赖会对不稳定的测试产生很大的影响。它们通常涉及网络延迟、外部系统不可预见的变化等等。所以，尽可能摆脱外部依赖。

不可靠的测试有更多的根本原因，比如错误的会话处理、不同的浏览器行为、无法正确处理失败的测试用例等等。我将在接下来的文章中讨论这些话题。