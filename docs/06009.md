# 传统数据中心网络——脊柱式网络的前奏

> 原文:[https://dev . to/ngschmidt/traditional-data center-network-a-preamble-to-spine-and-leaf-51le](https://dev.to/ngschmidt/traditional-datacenter-network-a-preamble-to-spine-and-leaf-51le)

## [](#datacenter-network-engineers-have-two-problems)数据中心网络工程师有两个问题。

### [](#change)变化。

### [](#loops-lets-cover-this-one-later)循环往复。(后面再来盖这个吧！)

变化无处不在。DevOps 和/或 CI/CD 等新兴趋势催生了对数据中心资源动态、短暂分配的需求；不仅是在大规模部署中，中型公司也开始朝这个方向发展。

...但是，由于网络变更所涉及的风险，我们仍然需要安排变更窗口来从数据中心添加/删除网络。

## [](#current-state)当前状态

如今，大多数数据中心网络部署由 2 层或 3 层组成，对于“核心”层或顶层有着各种各样的看法。我将从下往上开始，因为这通常会首先涵盖主要关注的领域。

请记住，我不是在给这种类型的设计抹黑。它非常可靠，是许多公司的支柱。如果它对你有效，你不必扔掉它。在许多情况下，我将要讨论的可能性对你来说甚至是不可行的。最终，我将有足够的时间来讲述成功的数据中心网络的各个方面——但现在，我将讲述一个有大量误导信息和市场信息的主题，这让许多网络工程师感到困惑。

### [](#coreaggregationaccess-topologies)核心聚合接入拓扑

该参考设计包括三层，核心层、聚合层和访问层:

[![](../Images/6ab4e3df5afc0a7c0dcf220447eb1bfc.png)T2】](https://2.bp.blogspot.com/-obUtXvp168I/XLynq_esGlI/AAAAAAAAAjk/d4ijwz_hDv0lrNn9OQmSTVNN8SGK5_G3ACLcBGAs/s1600/Core-Aggregation-Access.png)

#### [](#datacenter-access)数据中心访问

这一层是橡胶接触路面的地方。服务器直接连接到接入层，服务的设计主要是为了满足对向服务器的需求。各种非典型服务通常都部署在这一点上，例如 MC-LAG (vPC、MEC 等)。一般来说，这应该是变化频率最高的地方，因为它是最少的。

此时大多数部署都是第 2 层，即中继服务器/工作负载 VLANs，因此工作负载在穿越不同交换机时不必更改寻址。对于大多数部署来说，这是一个尚未解决的工作负载问题，必须通过这种设计来缓解。

不过也有一些不好的地方:

*   新的网络出现涉及所有接入层交换机，至少涉及聚合层。如果您不得不修改网络中的几乎每一台设备，那么您就无法降低变革带来的风险！
*   环路防止方法必须都是第 2 层，例如生成树、FabricPath、TRILL、MC-LAG。这些环路预防方法缺乏弹性，在大多数情况下，任何故障都会波及整个数据中心。

面对这个问题，我有一些建议:

*   创建新网络时，一定要探索路由接入的可能性。将 svi 添加到您的访问层可以缓解这种情况，但是您会失去工作负载的可移植性。也许不是所有的工作负载都需要可移植性，例如。IP 存储，主机管理。
*   使用支持新服务器启动的默认配置预配置所有端口。服务器管理员喜欢把他们的设备插上电源就能工作。花大量时间与您的系统团队一起规划这个默认端口配置——这是值得的。

#### [](#datacenter-aggregation)数据中心聚合

这是数据中心网络的主要内容，对于大多数部署来说，这是大多数设计的极限。数据中心网络的这一部分将运行大量服务，这些服务可以聚合到一个地方(因此得名)。您通常会看到连接到/运行在接入层上的以下内容:

*   防火墙
*   负载平衡器
*   数据中心互连，如果没有核心
*   环路预防方法，如 MC-LAG
*   大多数 VLANs 的第 3 层网关
*   你所有的 VLANs 都属于聚合层

聚合层可能是数据中心网络中修改风险最大的设备。我建议做几件事来减轻这些风险:

*   浪费大量的地址空间。创建许多新的网络，如果可能的话，保持它们相对较小。以可扩展的方式将它们交付给所有接入层，并在一开始就对其进行预配置。请记住，无论您分配到什么容量，客户都会超过它。
*   不要在聚合设备上堆积太多。您可以将单独的防火墙、LB 等连接到聚合层，尽可能简化这些设备将确保管理工作尽可能简单。
*   确保您有足够的端口数。采用数据中心核心是一项昂贵的举措，通常是第三套聚合层设备所必需的。

#### [](#datacenter-core)数据中心核心

这是你的 VAR 开始看到美元符号的时候。大多数部署都不需要这一层，即使在数千个工作负载(虚拟机、容器，我不加区分)的情况下也是如此，因为平均聚合访问网络的端口数量(从现在开始，我们称之为 **pods** )将是:

*   32-48 个聚合端口
*   32-48 个接入端口

**您可以使用一个机架在纸面上实现 1，024-2，304 台双主服务器或 4 主 512-1，152 台服务器。当然，这些端口中的大多数都被浪费了，因为您不能总是将 24-48 台服务器放入一个机柜中。现实世界中，每个 pod 的最大服务器数量可能是数百个。**

数据中心网络扩展到网络核心的主要点是互连 3 个或更多的单元或物理位置。我对这里的设计也有一些建议:

*   不要在 IP 可移植性上让步。保持在第三层
*   当我说第三层时，我是认真的。根本没有 VLANs 如有必要，使用类似`no switchport`和. 1q 标签的东西。彻底消除生成树
*   请在此仔细选择您的路由协议。BGP 具有容错性且非常复杂，OSPF 可以快速从链路状态故障中恢复，并且经常对变化反应过度。我就不说 EIGRP 了，因为我不喜欢专有路由协议。处理好它。

这就是大多数人的数据中心——如果设计得当，可靠性的最大威胁是网络工程师。完成设计后，网络添加、配置更改、软件升级将成为网络中断的主要原因。今天可以买到的大多数网络设备都是高度可靠的，因为所有的东西都是第 2 层的，所以这种网络设计不会失败，除非引入异常或做出改变。

下一部分将是为我们这些由于频繁的变化而承受过度压力的人准备的- **有可能达到大多数系统工程师在工作时的舒适程度。**