# 测试 AWS Lambda 性能？你公平吗？

> 原文:[https://dev . to/click travelengorg/trial ing-AWS-lambda-performance-are-you-be-fair-2 LCD](https://dev.to/clicktravelengorg/trialing-aws-lambda-performance-are-you-being-fair-2lcd)

这周我在帮助一个同事，他用 AWS 创建了一个简单的无服务器风格的设置:`API Gateway -> Lambda -> DynamoDB`

设置没有什么异常，功能第一次就像预期的那样工作。当他们决定针对该功能旨在取代的传统 24/7 部署服务器进行性能基准测试时，他们的问题出现了。他们的结果让他们非常失望，近乎担忧。

## [](#why)为什么？

在这种情况下，最简单的做法是先考虑当前版本。您现有的服务在任何时候都可以有效地完全扩展；它静静地坐在您的数据中心，燃烧现金等待请求，无论它收到单个请求还是每秒 50 个请求(RPS ),它都准备好从第一毫秒起就以完全调配的容量做出响应。

但是 lambda 不是这样工作的:如果没有请求，就没有容量。

当单个请求到达时，体系结构快速提供资源来处理该请求，并在短时间内保持该资源可用，以防其他请求到达。这意味着，如果您突然从空闲状态加载 50RPS 的函数，那么您将被迫等待
一小段时间，而体系结构会做出反应，它会通过运行大量函数来处理突然涌入的请求。

### [](#lambda-doesnt-scale-linearly-to-requests)Lambda 不与请求成线性比例

一次接收 50 个请求并不意味着会有 50 个并发执行。有一些复杂的计算在幕后执行，比如:

*   启动一项新功能所需的时间
*   当前执行的预期剩余时间
*   关于该功能使用情况的历史数据
*   个人账户限额

所有这些都会影响函数的自动伸缩，因此在某些情况下，Lambda 可能会选择让一些调用一个接一个地排队，而不是选择并发执行。

这意味着，如果你决定执行一个不切实际的负载测试，那么你很可能会看到比你在真实生产负载下所期望的更差的可伸缩性和性能。

这里的要点是，Lambda 可以轻松处理负载，但是您必须了解它是如何工作的，以便公平地评估它。如果期望您的函数持续处理 50RPS 作为基线，那么在 60 秒的窗口内对 Lambda 从 0 到 50RPS 进行基准测试是不现实的:如果您想要真实地了解它在那个级别的性能，您需要给它时间来扩展。

您会发现，如果您以 50RPS 的速度运行您的函数更长一段时间，该架构将准确计算出需要多少资源才能最好地服务于该负载，并且您的函数将执行得非常出色，而无需进一步扩展。如果你突然得到一个巨大的峰值，并且有 1000 RPS lambda,**仍然会处理那个**,但是它不会立即处于与你的 50rps 基线相同的性能水平；它需要使用额外的资源来应对额外的负载，这将在峰值开始时影响性能。

### Lambda 很棒，但它并不神奇:它需要时间来处理意想不到的流量高峰。

如果你想了解你的服务在正常负载下在 Lambda 中的行为，那么你需要在一个合理的时间框架内运行测试。这将允许 Lambda 理解这是您的正常负载，并且这将使您能够看到您期望的可靠性能。

当然，在短时间内运行这样的测试还可以让您看到最糟糕的情况，即如果您的函数受到意想不到的峰值的轰击，它会如何表现。

两者都是重要的指标，但不应该混淆为等同。不要因为自己不切实际的期望而把 Lambda 一笔勾销；如果你这样做，你会错过。