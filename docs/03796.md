# 写聊天机器人时的 8 个不要和要做的事情

> 原文:[https://dev . to/okulovsky/8-dont-s-and-do-s-when-writing-a-chatbot-567g](https://dev.to/okulovsky/8-dont-s-and-do-s-when-writing-a-chatbot-567g)

每个人都喜欢聊天机器人。到处都有在线杂志宣布 2019 年为聊天机器人年-正如他们对 2018 年和 2017 年所做的那样。在博客上，在会议上，在成功的故事中，我们听到了难以置信的智能聊天机器人，难以置信的成功创业，以及难以想象的科学进步。大型科技公司跟上了步伐:微软发布了他们的聊天机器人框架和自然语言处理工具，亚马逊也做了同样的事情，谷歌似乎在 Duplex 上迈出了更大的一步，它可以代表你给医生或餐馆打电话，为你预订桌子或预约。

听到和读到这一切，你突然决定也许你应该有自己的聊天机器人。也许，你没有想到太琐碎的事情，如 Slack 聊天机器人启动部署。但是，另一方面，你可能不想围绕你的想法开始一个全新的事业。它是一种介于两者之间的东西——你的旅行社、保险公司、零售店或餐馆的聊天机器人，它允许预订桌子或取消旅程或其他刻板的行为，而不会给你的联络中心带来压力。这也将娱乐你的客户，并向你的投资者表明，你正走在数字化、人工智能和其他高科技的正确轨道上。

而且它看起来并不复杂，尤其是在听说了这些天的进步之后。人们通常认为人工智能基本上就在这里，随时可以被雇佣，在一段时间后，它会为你工作，它会很聪明，很有趣，很迷人，所以客户会出于与它交谈的乐趣而购买你的东西。

当然，这幅图从根本上说是错误的。

去年，我完成了一个聊天机器人项目，直接参与了另外两个项目，咨询了另外几个项目，测试了几十个项目，阅读了更多的内容。他们没有一个是聪明的，他们中的许多人只是坏。他们糟糕的最大原因之一是管理层和开发者之间的巨大误解，主要围绕着非常基本的问题:聊天机器人是什么，以及如何和谁应该开发它。

我想和你们分享我在这一年里学到的一些经验，这些经验将有助于让你的聊天机器人变得更好，尽管它们仍然不够智能。因此，这不是一篇又一种科学技术的文章，而是更实际的建议。这将有助于产品经理扩展这方面的知识，也有助于数据科学家或开发人员避免潜在的陷阱。

## [](#dont-get-overexcited)不要过于兴奋

是的，这是第一条建议，简单明了。不要过度兴奋。关键是，你的聊天机器人不会有任何智能。

问题是，人工智能并不是真的被雇佣的。首先，人工智能在 NLP 领域远不如其他大多数领域先进。

[![Photo from Google Duplex presentation](../Images/6e65e7e4af856ba0b209ba43df4038e0.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--eiHlaTRd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/hmx3d4enhriws52h5ceh.png)

当我们看到双工演示或使用谷歌翻译时，我们认为这些服务背后的人工智能理解文本。不然怎么翻译呢？在某种程度上，这些服务理解文本:将它转换成一个向量表示(seq2vec ),它本质上捕捉了“含义”,并使用这个表示生成一个输出。然而，这种表征是特定于任务的，这种“意义”不是普遍的，因此它不能直接用于你的需要。您仍然可以使用这种表示来提取您的“含义”，但它本身是一项数据科学任务，因此，它需要数据，最好是大量数据。

并且在许多设置中，该任务的解决方案是耗时的，需要大量的其他资源，并且与更传统的方法(例如基于单词或字母的特征的逻辑回归)相比没有提供显著的改进。这些方法很愚蠢，但是便宜，快速，有效。

这同样适用于对话管理:是的，你可以花费大量的金钱和时间来创建一个真正智能的聊天机器人，但是不太智能和更传统的方法更有效。所以在这个领域的当前状态下，情报有很大的成本，而且通常不会有回报。

好消息是，客户并不真正需要这种智能。有时当我们过度兴奋时，我们认为客户会偏离我们设计的流程很多。我们认为他们会在披萨店点寿司，我们希望优秀的聊天机器人能够说服他们点披萨，而不是说“对不起，菜单上没有寿司”。我们想象顾客订购外卖，但不会提供地址——聊天机器人会微妙地处理这种情况，安排将外卖送到汽车站。我们幻想顾客问聊天机器人是否结婚了，并试图调戏它——出于某些原因，我们认为如果聊天机器人愿意合作，顾客就会买得更多。

我的经验是，这根本不是真的。当然，有些人会试图揭露聊天机器人的愚蠢，但他们不是真正的客户，他们只是在寻找乐趣，这不是他们中的很多人。至少在我工作的德国，人们通常会遵从你提供的聊天流程，如果这个流程有意义的话。一些边缘情况是可能的，但它们根本不值得努力。

对话中唯一可能出现偏差的阶段是聊天机器人试图理解客户需求的第一步。无论你对聊天机器人功能的描述设计得有多好，人们都不会去读它，他们会试图向聊天机器人诉说他们所有的不满，其中一些是真正独特和不可预测的。你真的拿它没办法，除了那句著名的“对不起，我不懂”。这里的最佳策略是与聊天机器人背后的人进行对话。

此外，在德国没有人会与聊天机器人交往。我怀疑这取决于文化，但在德国，不需要“闲聊”，聊天机器人开发者中广泛讨论的功能。在其中一个项目中，我们花了相当多的时间来计划和实现聊天机器人聊天，却发现几周内没有一个人尝试访问它。因此，它不是吸引客户的功能，而是一个只有忠诚的客户才能找到的异国情调的复活节彩蛋。

[![Itchy Feet and small talk comics](../Images/8b58c00a569218cf9a218474564b9939.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--xvzgMuuK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/fz84vy7yzxb3r0jtok5g.png)

最后一点是，在预订飞机时，根本不需要太多的智能。客户应该回答一些特定的问题，然后应该进行 API 调用，应该向客户提供票证——就这样。想象一下，它将作为一种形式在你的网站上实现——究竟谁会说它是智能的呢？如果没有，为什么这种形式会突然变得智能，仅仅因为它现在被实现为聊天机器人？智能是由服务而不是格式决定的。当然，你可以考虑聊天机器人，它不仅能卖票，还能根据顾客的喜好帮助选择度假的最佳地点。这项服务确实需要一些“人工智能”。但是这种服务不会仅仅因为你的预订服务现在被实现为聊天机器人而出现。这将是一个不同的项目，我可以称之为“power-chatbot”，所以它需要其他方法和更大的预算——它最好被视为一个独立的创业公司，而不是一个辅助项目。

有时候，很难区分超级聊天机器人和普通聊天机器人。标准可以是这样的:你是在尝试做没人做过的事情，还是每个人都在做的事情？所以如果这是你的第二类项目，不要把它和第一类混淆，不要用第一类的方法。这真的很难，因为大多数论文和会议都是关于权力聊天机器人的，这有时会产生来自管理层的压力:嘿，为什么我们不只是使用每个人都在谈论的东西，而不是所有这些呢？！答案是，项目不同，因此解决方案也不同。

但是，如果这些普通的聊天机器人不那么智能，而且客户也不需要它，这又是怎么回事呢？

不要把重点放在智能上，试着把聊天机器人看作是接触客户的另一个渠道。很久以前，每个企业都创建网页来接触互联网上的客户。当移动电话变得可用时，我们了解到人们不太喜欢通过移动互联网访问网站，而是更喜欢应用程序-所以最近企业开发了移动应用程序。最近，我们发现客户已经受够了他们手机上的数百个应用程序，并且不打算再安装一个，所以我们试图通过他们已经有的应用程序 messenger 来联系他们。仅此而已。聊天机器人是一个界面，允许你的企业通过这种媒体提供服务，而不是客户的灵魂伴侣。下一个“大事件”似乎是语音助手，今天你已经可以为这个助手创造技能了。自然语言生成，有时甚至自然语言理解通常已经实现，所以对话管理是唯一需要开发的东西。这就是为什么聊天机器人可能会持续一段时间的原因——它们不仅是信使的界面，也是语音助手的界面。

## [](#dont-do-deep-learning)不做深度学习

深度学习是自然语言处理领域所有最新成就的主要推动者，也是聊天机器人的幕后推手。因此，关于整个主题的过度兴奋肯定会打破这一特定技术的天平，但我希望我们已经在前一段中解决了这一问题。深度学习也有自己的优势:你可能会听到承诺，不管聊天机器人有多复杂，深度学习都可以让你避免在你的项目中编程——聊天机器人会神奇地自己学习对话流。或者，更准确地说，神经网络将观察大量现有的对话，然后理解它们的隐藏结构以及如何传递它们，包括没有直接观察到但遵循相同模式的新案例。

这可能真的会发生，但是，正如我所说的，人工智能有成本和要求。第一，你有足够的数据吗？就像，成千上万的对话？这些对话相关吗——因为我们在电话中传达的信息与我们在电话中说的不完全一样？您是否征得客户同意将这些对话用于此目的？如果对话是音频文件，它们必须转换成文本-你知道成本，你同意将数据传输给第三方处理吗？

即使你有数据，下一个问题是:你还不知道对话流程吗？如果你能坐下来把对话画出来，那就做吧。那太好了！

是的，对于某些问题，我们不能。想象一下和一个医生的对话。一个接一个的问题，所有这些问题都与数十亿字节的医学知识相关并依赖于这些知识。这确实是不可能直接编码的，因此科学家们正在努力寻找完成这项任务的方法。但是，如果这是关于订购比萨饼的对话，强大的神经网络不会提出任何奇妙的东西，因为根本没有什么奇妙的东西可想！这将是用一把大锤敲碎坚果，也是用一把非常脆弱和昂贵的锤子。

## [](#dont-directly-encode-state-machines)不直接编码状态机

一旦你放弃了深度学习，你可能会继续使用一种很好的旧的状态机方法。这是定义对话的完美方式，它非常容易解释和理解，允许良好的图形描述，并且背后还有一个可靠的数学模型。因此，很容易将这种模型用作聊天机器人的软件架构。

然而，这将是一个严重的错误。很快你就会发现自己身处“如果”、“其他”和全局变量的地狱，一个你很难逃脱的地狱。所以你只能在开发一个非常小的聊天机器人的情况下才能这样做，因为一旦需要扩展，你就必须扔掉所有这些代码。

如果聊天机器人有几种技能，并且这些技能是非线性的，我肯定会建议花一些时间来找出编码状态机的最佳方式。例如，可以是由库执行的 UML 图。我自己更喜欢基于代码的方法，所以我想出了这样的东西:

```
def TraceDelivery(context):
    trackId = None
    for i in range(3):
        yield Prompt(Vocabulary.EnterTrackId if i==0 else Vocabulary.ReenterTrackId)
        yield Listen()
        if is_valid_track_id(context.input):
            trackId = context.input
            break
    if trackId is None:
        yield Prompt(Vocabulary.UnrecoverableFailureAndHandover)
        yield HandOver()
    context.slots['trackId'] = trackId 
```

聊天流是一个生成器功能。当你的解释器执行流时，它创建迭代器并从中获取命令，直到找到“Listen”命令。此时，它将前面的所有命令发送给客户，并等待他们的回复。回复被插入到“上下文”变量中，迭代器继续执行，直到下一次“监听”为止。本质上，在这种方法中，编译器将自己构建状态机。

事实证明，这种架构确实可以扩展到更复杂的用例，例如:

*   如果需要将一个场景分解成更小的部分，可以返回子程序命令，指针指向下一个生成器函数。一旦您的解释器获得这个命令，它就把当前的迭代器放入堆栈，从这个场景创建一个新的迭代器并执行它。
*   Listen 命令可以携带关于哪种输入适合继续使用的信息。如果解释器接收到不匹配的客户输入，它会丢弃或隐藏当前的迭代器，并回滚到处理未知输入的备份。
*   如果需要外部 API 调用，生成器可以生成相应的命令，然后接收其结果作为输入。这将把 API 调用从对话管理中分离出来，简化日志记录和测试。

我想过把这种方法包装成一个库，但是得出的结论是不值得。您在场景中使用的命令和附加特性太依赖于您工作的实际业务案例。

请记住，这种方法有几个缺点:

*   它可以用许多编程语言来实现，但不是所有的语言都可以。发电机的特性显然是至关重要的。
*   在许多语言中，生成的迭代器是不可序列化的，因此只能存储在内存中。如果对话不会持续很长时间，这不是一个大问题，通常不会。

对于特定类别的对话，您会发现基于 GUI 的解决方案很有帮助，通常还有自然语言处理。例如，当目的是填充一些关于订单的信息时，填充位置对话框有多种实现:例如，T 恤衫的颜色、尺寸和领口。一些信息可以通过第一个话语(“我想要一件 M 号的红色 T 恤衫”)来提供，一些其他的信息可以通过附加的问题来检索。

## [](#dont-write-unit-tests)不要写单元测试

单元测试在许多情况下是有用的，但是对话管理不是其中之一。考虑下面的对话:

[![conversation](../Images/66e8570aed4f07142c832f689e863bd5.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--1TytQ8Sr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/nrepi5t5aswvuw11ggck.png)

单元测试应该测试原子功能，比如聊天机器人对特定输入的响应。我们看到，3.1 的输出不仅依赖于 2.b，还依赖于 1.b。因此，为了在测试中重现行为，应该将关于 1.b 的上下文信息注入到测试中。这带来了两个问题:

*   我们不能真正注入整个背景，只能注入我们对它的假设。我们假设阶段 1 导致例如国家的某些领域中的某些值。这些假设是受控的吗？如果没有，它们总有一天会失效，带来假阴性结果，这是 QA 中能想象到的最糟糕的事情。但是如果是的话，这意味着在每次测试之后，您需要彻底检查输出和状态变化，这意味着编写测试将变得非常耗时。
*   当您在代码中表达假设时，您锁定了架构:为了让测试工作，聊天机器人必须具有状态，并且该状态必须具有具有特定含义的特定字段。如果你想在某个时候重构状态，你会遇到一个问题:为了安全地重构代码，你需要控制它的行为，但是你必须控制它的唯一方法阻止你重构。如果不编写一组并行的与架构无关的测试，这是一个无法摆脱的死锁。

那么，为什么不首先从这种与架构无关的测试开始呢？有时候选择单元测试之外的测试方法是非常好的，尤其是如果理由充分的话。因此，集成测试是单元测试的完美替代品。只要构建你的聊天机器人应该处理的对话，并检查它是否处理它们！

当然，所有对话的总量相当高，这个问题可以这样解决:

*   如果聊天机器人有健全的体系结构，那么不同的技能是独立的，并且你确定组合操作工作正常，你可以简单地测试技能和技能的重要部分。
*   或者，您可以构建一个包含所有可能流的图，通过在该图中进行深度搜索来生成线性场景。这样的测试需要相当长的时间，但无论如何这是机器时间。图表也有它自己的价值:它们跟踪对话的设计，所以你可以相对快速地记住它应该是什么样子。

集成测试还有两个额外的优势:

*   你可以随时向管理层展示一系列肯定有效的对话
*   您可以进行测试驱动的开发:首先将对话作为测试写下来，然后找到通过测试的实现。在一个好的设置中，产品经理，或者产品所有者，或者其他任何负责对话设计的人，甚至可能为你编写测试！

## 不要忘记日志记录

这听起来可能很奇怪，但是是的，有时候人们对伐木没有足够的重视。这对于语音助手来说尤其令人困惑，因为我们甚至不能制作一个截图来重现错误。所以我肯定会建议不要重复这样的错误，并建立一个全面的日志程序。不要试图在同一个模块中实现分析和日志:以最原始的方式记录一切，然后编写解析和表示日志的脚本，否则，您将永远不会知道错误是发生在对话管理中还是发生在分析模块中。

日志质量的良好标准是可再现性:你必须能够用对话管理来重放日志，并获得相同的结果。如果你想不出一种方法来做到这一点，这是一个很好的迹象，要么日志不包含一些重要的数据，要么聊天机器人的架构是错误的。

可重现的日志对于 QA 工程师来说是一个很有价值的工具:不是向您描述他们认为发生了什么，而是可以简单地向您提供错误的时间戳，这样您就可以检索有问题的对话，重现它，进行调试，并确保在您完成后错误真的消失了。

## [](#dont-underestimate-whatsapp)不要小看 Whatsapp

有一些很好的、灵活的信使很有趣，它们为聊天机器人提供了 API 和大量迷人的功能。还有 Whatsapp。灰色 API，可怕的支持，没有功能。巨大的不幸是，它是德国最受欢迎的信使。

Whatsapp 最近被脸书收购，所以也许，我们最终会看到一些演变，但现在你必须保守估计 Whatsapp 整合的时间。

我真的不能向你提供任何细节，告诉你到底哪里会出错，但两次我看到人们用 Whatsapp 做事情时，他们都很不高兴，并且大大超过了计划的最后期限。

## [](#dont-write-your-own-annotation-tool)不要编写自己的注释工具

手动注释数据是一项你可以愉快地避免多年的任务，尽管如此，你仍然是一个了不起的数据科学家。对于推荐系统、流失预测或业务参数预测，我们只需将所有数据准备就绪。因此，您可能会突然发现，您的聊天机器人需要:

*   表明句子的意图，例如，说明“我正在考虑买鞋”实际上意味着“订购”。
*   突出显示命名的实体，如前面示例中的“鞋子”。
*   评估已经发生的不成功对话，并了解失败的原因。

所以基本上看起来很简单:将任务呈现给注释者并收集答案。在这一点上，你可能会想:我们在谈论什么，我只是坐下来写一个小工具，只有几百行代码，很简单！

不要。

在我的整个职业生涯中，我见过大约十个这样的自制注释工具。它们中的绝大多数花费了比计划多得多的时间来开发，然而，它们是丑陋的，功能障碍的，不可维护的，并且在某个时候停止了。

幸运的是，有一个替代方案:Pybossa 框架。它在两个方面都是免费的，它是自托管的，所以你不必额外担心 GDPR，它正在被积极地开发和维护。在这个框架内创建一个新的看起来不错的任务将需要大约 1-2 天。一个称职的开发人员可以在几个小时内部署系统，也有可供开发和测试的 dockerized 版本。

## [](#do-not-hire-the-team-of-data-scientists-for-this-job)不要为这项工作雇佣数据科学家团队

是的，你没看错，我还可以补充一句:“也许，甚至一个都没有”。我们讨论的大多数事情都不是数据科学，而是纯粹的软件工程。由于我们不是在谈论权力聊天机器人，数据科学家实际上可以执行的任务非常有限。它的任务是意图识别(理解文本)，命名实体识别(从用户话语中提取重要信息)，有时也是排序问题(为客户问题提供最佳答案)。这些任务的真相是:

*   获得第一个可接受的结果真的很容易:算法是众所周知的，并得到很好的实现，这里没有真正“数据科学”的东西，一个对数据科学有肤浅兴趣的强大开发人员会管理。
*   超越第一个结果是具有挑战性的。这种进步可能需要很长时间，但最终不会带来可见的结果，因为这种改进只会影响边缘情况。这些情况可以通过其他非编码方式更容易地避免，比如编写有用的提示，让客户知道正在发生什么。
*   Google NLP 和 Microsoft LUIS 为其中一些任务提供了现成的算法。我得说，这些领域的进步将很快使任何关于这个主题的内部开发变得无用。
*   对于排名问题和问答系统，数据科学家仍然是有价值的，但只有在你已经有数据的情况下才适用。如果没有，就拼凑一些功能最少的东西，运行系统，收集数据，然后雇佣数据科学家来提高性能。

为这样的项目雇佣数据科学家也有风险。从个人经验来看，他们倾向于低估软件开发方面的问题，而过于关注复杂的边缘情况和处理它们的强大算法，有时没有评估商业价值。我自己，我设法避免了它，因为我在转到数据科学之前做了多年的软件开发人员。但并不是所有的数据科学家都来自这个领域。因此，项目进展的方向将会被扭曲，有时是灾难性的，如果管理层不真正了解什么是数据科学，这将是一个特别大的问题。因此，管理层的最佳策略是了解这一点，另一个可接受的策略是让项目由软件工程师而不是数据科学家来驱动。正如许多其他类型的项目一样，数据科学家应该改进聊天机器人，而不是从头开始构建。