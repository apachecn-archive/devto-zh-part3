# webhook 请求中有什么？

> 原文：<https://dev.to/dmulter/what-s-in-a-webhook-request-36bh>

Webhooks 是一种简单而强大的向应用程序发送事件通知的方法。在本文中，我将重点关注 webhooks 对应用程序开发人员来说最有意义的方面，即**有效负载**。有效负载包含传达事件含义的数据字段。这些字段通常在 webhook HTTP 请求的主体中发送。

这个有效负载的确切格式完全取决于向您发送 webhook 请求的源。最重要的数据字段描述了发生的事件的*类型*。处理邮件列表的服务可能包括事件类型，如*订阅*、*退订*和*发送电子邮件*。然后，这些事件中的每一个都将包含额外的字段来标识订户、交付细节等等。事件的类型可以用许多方式来表示，但是当它遵循*名词.动词*格式时描述得最清楚。

下面是 Stripe API 文档中的一个例子。注意值为`invoice.created`的`type`字段。事件名称遵循*名词.动词*格式，使得事件的意图非常清楚。

```
{  "id":  "evt_1CiPtv2eZvKYlo2CcUZsDcO6",  "created":  1530291411,  "type":  "invoice.created",  } 
```

事件通常包括跨多种事件类型共享的字段。我刚才描述的事件类型是公共字段的一个例子。另一个常见的字段用于表示事件生成的日期和时间。这个*时间戳*可以用多种格式、时区和不同精度级别来表示。时间戳可用于帮助识别重复事件，并确保事件的正确排序。一些事件还包括一个*标识符(ID)* 字段来唯一地标识每个事件。这可以用作消除重复事件的更精确的方法。

再次查看条带示例，您会发现`id`和`created`字段提供了 ID 和时间戳值。时间戳是以 [UNIX 纪元时间](https://en.wikipedia.org/wiki/Unix_time)秒的格式。通常你会发现时间也是用 [ISO-8601](https://en.wikipedia.org/wiki/ISO_8601) 格式的字符串来表示的。

```
{  "id":  "evt_1CiPtv2eZvKYlo2CcUZsDcO6",  "created":  1530291411,  "type":  "invoice.created",  } 
```

在少数情况下，您可以控制在有效负载中发送的字段。Datadog 允许使用您喜欢的任何字段和值来完全配置自定义有效负载。Zendesk 和 Leanplum 有标准的事件类型，也允许您配置额外的自定义字段。

HTTP 请求中使用的内容类型会影响有效负载的结构。您会发现最常见的格式是 [JSON](https://en.wikipedia.org/wiki/JSON) ，它在各种应用程序编程语言中处理起来非常简单。一种不太常见的格式是 [HTML 表单 URL 编码的](https://en.wikipedia.org/wiki/Percent-encoding#The_application/x-www-form-urlencoded_type)数据。在这种情况下，您需要解码每种类型事件的键/值对。在极少数情况下，您可能会发现使用 [XML](https://en.wikipedia.org/wiki/XML) 编码的内容。对于这些负载，您需要使用特定于您的应用程序编程语言的 XML 解析库。

大多数有效载荷都相对较小，可以传递处理特定事件所需的关键信息。其他 webhook 源希望您向它们的服务发出额外的 API 请求，以收集与事件相关的更多细节。在极少数情况下，当有效负载变得非常大时，您需要特别小心。其中一些 webhook 源可以在有效负载中直接包含文件附件，其大小可能有几兆字节。

大多数 webhook 请求的有效负载包含一个事件。一些 webhook 源会将这些事件批处理到一个 webhook 有效负载中。当一次发送许多事件时，批处理事件可以帮助您避免大量的 HTTP 请求，但是处理所有事件就成了您的责任。确认一个批处理请求让 webhook 源知道你已经承担了这个责任。通常，有效负载在 webhook 有效负载中会有一个事件列表。

这里有一个来自 Mailjet 的批处理事件的例子。`event`字段用于标识事件类型，`time`字段采用 UNIX 纪元时间格式，`MessageID`字段对于每个事件都是唯一的。

```
[  {  "event":  "open",  "time":  1552244670,  "MessageID":  456,  },  {  "event":  "open",  "time":  1552244731,  "MessageID":  457,  },  ] 
```

您应该在 webhook 源代码网站上找到详细的开发人员文档，这些文档准确地解释了他们如何处理我在本文中介绍的所有有效负载主题。请注意，追踪和理解每个 webhook 源及其支持的事件的所有这些细节可能是一项挑战。

Hookalu 将帮助您解决 webhook 的复杂性，以便您能够专注于为客户提供商业价值。

> 最初发表于。