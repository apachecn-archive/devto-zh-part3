# 调试的规则

> 原文：<https://dev.to/codemouse92/the-rules-of-debugging-2hf5>

这是生活中的一个事实:你将把大部分的编码时间花在调试上。

如果你已经在这方面有一段时间了，你可能已经把调试归结为某种艺术。对于你们其余的人，这里有一些来自战壕的规则:

## 规则一:什么都不要假设。什么都不要假设。

除非所有的数据都摆在你面前，否则你无法解决问题。不要想当然！检查所有相关变量的值。仔细阅读堆栈跟踪。逐句通过您的代码。

十有八九，bug 会隐藏在你认为理所当然的问题的某个区域。

我也喜欢约翰·卡马克的说法...

> 大多数错误都是由于执行状态与您所想的不完全一样。

顺便说一下:*永远不要对任何帮助你调试的人隐瞒所有这些信息。向他们展示运行代码和数据，以及输出和错误消息的所有细节。大方点。隐瞒信息浪费了每个人的时间。*

## 规则 2:问题在于你自己，除非被证明并非如此。

人们很容易得出这样的结论:在库、语言、环境、工具或其他任何东西中存在缺陷。事实上，对于你在别人的代码中发现的每一个错误，你通常会在自己的代码中发现至少一百个。

假设你的代码是问题所在，直到你完全地、可量化地证明不是这样。让别人来检查你的代码。阅读文档。尝试在单独的环境中重现该问题。如果你*确定*你的代码没有问题，请再次检查。

## 规则 3:代码失败的方式理论上是无限的。

恕我冒昧，我真想把它说成是麦当劳的第一定律。值得重复。

> 理论上，代码失败的方式是无限的。

我总是惊讶于我自己的代码有多少新的有趣的方式可以把自己炸成碎片。这是你假设问题出在你身上的另一个原因(规则 2)——即使你已经考虑了所有可能的异常状态或失败案例，仍然还有一个问题。一旦你加入了其他人的代码的不可预测性，你将会有一生的惊喜。

如果你没有发现自己盯着电脑屏幕大喊“这到底是怎么回事？”或者诸如此类的，至少一年一次，你做错了。

## 规则四:复杂性是你的敌人。

真正的代码是复杂的。这就是为什么调试它是如此的痛苦！当你遇到一个特别困难的问题时，创建一个*最小的、完整的、可验证的例子*(或者用 StackOverflow 的行话来说，MCVE)会有所帮助。

在一个相当新鲜的环境中用尽可能少的代码和依赖来复制问题。如果成功了，继续添加细节直到它爆炸。无论你最后做了什么，几乎肯定是问题的一部分！

## 法则五:如果很怪异，那就是记忆。

这不仅仅适用于像 C 和 C++这样的“边缘锋利”的语言，在这些语言中，你可以随心所欲地旋转比特。任何涉及来自除了*用户*之外的任何地方的完全垃圾的错误几乎肯定与内存错误有关。

未定义的行为和内存错误存在于所有现代编程都岌岌可危的堆栈的核心。仔细研究你最喜欢的语言的例外列表，你几乎肯定会发现一些与记忆有关的东西。

现在，如何实际检测和修复上述内存错误完全取决于您的语言和平台。

## 规则六:你可能在某个地方忘记了分号。

我曾经花了两天时间试图修复代码中的一个无限循环。当我妈妈走进房间的时候，我正在气头上，半信半疑地认为我的电脑被一股邪恶的黑暗力量控制了。

她盯着屏幕看了一会儿，然后指了指。"第 56 行中间不需要分号吗？"

我妈妈不是程序员。然而，猜猜我在第 56 行忘记了什么？分号。

从那以后的几年里，我发现许多可怕而神秘的错误都是因为缺少符号:分号、逗号、反斜杠、空格。“有效的代码”和“正确的代码”之间有一条鸿沟，我们每个人都无法每周至少*一次像埃维尔·克尼维尔那样跳过这条鸿沟。*

很可能，你自己看不到这些小错误。我们都是代码盲！如果几分钟后你还不能发现它，那就找另一个程序员来帮你看看，然后嘲笑你的愚蠢错误。你会做很多。

## 规则#7:永远不要低估完全傻瓜的聪明才智。

如果你想知道，完整的报价是...

> “当人们试图设计完全万无一失的东西时，一个常见的错误是低估了完全傻瓜的创造力。”道格拉斯·亚当斯

迟早，作为你的代码的不可抗拒的力量会遇到作为你的用户的无情的白痴。(不要冷笑...很有可能，那个用户就是凌晨 2 点的你，你体内的咖啡因不足。)Wetware 是出了名的漏洞百出:最终，有人会要求你的代码做一些违背物理、数学和常识的事情。

为了防止这种情况，我们编写了绝对阴险的测试:

> “QA 工程师走进一家酒吧。点了杯啤酒。点了 0 瓶啤酒。订购 999999999 啤酒。订购一只蜥蜴。订单-1 瓶啤酒。命令一个 sfdeljknesv。”比尔·塞姆普夫

正如人们所说，“最好的防御是有效的进攻”，这也适用于调试。尽可能多地找到自己破解代码的巧妙方法。发现当你给它垃圾输入时会发生什么。打破自己 API 的规则。调出界面，然后让你的猫坐在你的键盘上。简而言之，[对你的代码做可怕的事情。](https://blog.codinghorror.com/doing-terrible-things-to-your-code/)

(附:猫的事情我不是开玩笑的。我的一个编程朋友有一只猫，它坐在我睡着的朋友的腿上，以 85%的成绩通过了业余无线电执照的模拟考试。我是非常认真的。)

## 规则 8:老式的纸张是你最好的朋友。

现代程序员掌握了一整套调试工具:调试器、静态分析、内存检查器、代码剖析器、测试框架等等。但是不要忽略了这个星球上最古老最可靠的调试工具——一张纸，一支铅笔，还有你自己的眼球。

所谓的桌面检查是一个非常有价值的工具。虽然您可以使用所有复杂的工具花几个小时来追踪自己的尾巴，但没有什么比亲自阅读代码、写下每个变量的变化值、执行数学运算、评估每个逻辑语句更好的了。你不仅可以在像计算机一样思考的*中得到很好的练习，而且你会惊讶于你关注问题的速度有多快。*

桌面检查是我个人的第一道防线，要么在调试器之前使用，要么与调试器一起使用。我用这种方法拯救了几个小时的困惑和心痛。

## 规则 9:你正在寻找的虫子很可能是贾巴沃克。

编程很奇怪。出于我们不完全理解的原因，软件不一定遵循数学或物理定律。有时，它似乎有自己的想法。

请考虑以下内容，这些内容都摘自行话文件:

> heisenbug:当人们试图探测或隔离它时，它会消失或改变它的行为。
> 
> mandelbug (n):一种 bug，其潜在原因非常复杂和模糊，以至于其行为显得混乱甚至不确定。
> 
> schroedinbug (n):程序中的一个设计或实现错误，直到有人阅读源代码或以不寻常的方式使用程序时才显现出来，这时程序会立即停止工作，直到被修复。

虽然听起来很神秘，但却非常真实。事实上，我在野外观察并证实了所有这些至少一次。

简而言之，一辈子的调试，就要产生一些天马行空的故事。虽然大多数错误都是玻尔错误，也就是说，它们在一系列明确定义的条件下出现，而且大多数都是你的错[规则 2]，但要为奇怪的事情做好准备。永远不要认为你懂电脑。

这让我得出了一个重要的推论:**你的电脑*会*把所有对时间和难度的估计都当成个人挑战**。如果你说“实现 X 将会很容易”或者“我只需要花一个周末的时间来做 Y”，你几乎可以保证你的代码将会充满畸形。

例如，我曾经估计一个项目需要一周时间。它挫败了四个开发者历时三年完成的努力。(它上个月刚刚达到功能完备。)

欢迎来到编程。下兔子洞时请小心家具。

## 规则#10:你有没有关机再开机？

这听起来很傻，但是它比你想象的更有效，甚至对软件错误也是如此！一旦我检查了一会儿，确认问题不在我，我就重启电脑。有几次这样就完全解决了问题，以后再也不会发生了。

然而...这非常重要...你得先排除自己是问题。这一现象在麻省理工学院的一篇传奇[AI Koans](http://www.catb.org/jargon/html/koans.html)中得到了阐述:

> 一个新手试图通过开关电源来修复一台坏掉的 Lisp 机器。
> 
> 奈特看到学生正在做的事情，严厉地说:“你不能在不知道出了什么问题的情况下，只通过重启来修复机器。”
> 
> 奈特把机器关了又开。
> 
> 机器工作了。

## 规则 11:如果其他方法都失败了，就和鸭子说话。

作者注:我最初计划了 10 条规则，但是在我的编号中我错了一条。当然一篇关于调试的文章会有 bug。

橡胶回避在开发人员中是一种流行的做法，这是有充分理由的。通常，大声说出来会帮助你以不同的方式处理问题，引导你找到解决方案。为此，很多程序员在办公桌上放一只橡皮鸭。

请注意，它不需要成为一只橡皮鸭。对我来说，它是 Whooves 医生的 Funko 乙烯基图(来自*我的小马:友谊是魔法*)。让你的船漂浮的任何东西...或者鸭子。

* * *

您将花费大部分的编程生涯进行调试，而且不知道您会发现什么奇怪的事情。你将探测人类愚蠢的深度(尤其是你自己)，体验愤怒的应用数学的原始力量，并戳戳你在时间空间连续体中的明显漏洞。假设你活下来了，你会有很多故事告诉你的孩子。

我将留给你们《塞尔达传说》中不朽却被错误引用的话:

> 一个人去很危险...........那么，祝你好运！