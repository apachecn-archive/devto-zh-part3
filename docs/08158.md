# 反向代理疯狂

> 原文：<https://dev.to/gmeluski/reverse-proxy-madness-lc1>

*本帖最初发表于[meluski.com](https://meluski.com/)T3】*

在我们探究自己混乱的想法之前，让我先补充一句话，这句话让我很容易理解反向代理到底是做什么的(摘自 ["Mastering Nginx"](https://www.goodreads.com/book/show/15957451-mastering-nginx) ):

> 反向代理是一种 web 服务器，它终止与客户端的连接，并代表客户端与上游服务器建立新的连接。

太简单了，对吧？如果这就是你来的全部目的，请不要再看这个了，继续看这本书吧。

多年来困扰我的是思考这样一个想法，反向代理能逆转代理的哪一部分？从无知的消费者的角度来看，我的客户机和代理服务器是一对一的关系。我有一个始发 IP 地址，它向代理 IP 发出一个请求，实际上，在将请求传递到目的地之前，代理 IP 标记它自己的身份，而不是我自己的身份。

也非常简单。然后我会开始思考什么会逆转，我的思维会变得混乱。

代理服务器可以处理来自多个客户端的入站请求的想法很少在没有深入研究的情况下得到认可。大多数可立即搜索的文献都是关于将代理服务器用作客户机，而不是代理服务器的内部实际工作方式——例如处理来自多个不相关客户机的请求，然后重新路由它们，使它们看起来都来自同一个 IP 地址。

我认为混乱的部分原因是，从概念上讲，当不考虑整个请求周期时，有多种不完整的方法来看待反转。在纠结了一段时间后，我意识到我忽略了关系的响应方面，因为当请求传入代理服务器时，反向代理确实完成了它的初始工作，与直接代理一样。

然后我突然想到:

> 代理服务器使请求看起来来自不同的 IP，而不是真正的来源，反向代理使响应看起来来自不同的 IP，而不是真正的来源。

因此:

> 代理可以用来屏蔽实际请求者的身份，反向代理可以用来屏蔽实际目的地的身份。

太好了。我现在明白了。我希望这能帮助任何人理解这两者之间的关系。我将留给你们一些 ASCII 艺术，它们帮助我得出了这个结论:

### 代理

```
[shield the source]
from multiple independent clients, allocate requests to a single specific IP
     ____
--> |    |
--> |    | --->
--> |____| 
```

### 反向代理

```
[shield the end points]
from a single client, conditionally allocate requests to specific IPs
      ____
     |    | ---> xxx.xxx.xxx.01
---> |    | ---> xxx.xxx.xxx.02
     |____| ---> xxx.xxx.xxx.03 
```