# 活动记录、Sidekiq、池和线程

> 原文:[https://dev . to/appaloosastore/active-record-sidekiq-pools-and-threads-18 D5](https://dev.to/appaloosastore/active-record-sidekiq-pools-and-threads-18d5)

在 Appaloosa，我们经常使用 Sidekiq。事实上，我们用它来完成所有需要的后台工作。我们还使用数据库(是的，这听起来很疯狂，我知道。)与活动记录一起作为 ORM。有时，Sidekiq 作业需要在我们的数据库中做一些事情，这看起来是一种正常情况，直到…

## [](#the-recurring-error)重复出现的错误…

直到，此错误弹出多次:

> 无法在 5.000 秒内从池中获取连接(等待了 5.002 秒)；所有池连接都在使用中(active record::ConnectionTimeoutError)

它会弹出很多次，每天，在同一时间。类似深夜的东西，所以是的，让我们试着去理解和修复它。

## [](#but-how-can-this-happen)但是怎么会这样呢？

好了，在检查了我们所有的监控工具后，我们发现错误出现在 Sidekiq 作业中。然后，在浏览器上打开了 20 多个标签页(很明显，很多都是相同的，在不同的时间从不同的来源打开)，我们找到了理论和理论上的解决方案。

### [](#theory)理论

首先，我们在一侧有活动记录及其适当的配置文件。在这个`config/database.yml`文件中，您可以找到如下内容: