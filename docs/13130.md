# 初创公司的 AWS 陷阱

> 原文:[https://dev.to/lucpattyn/the-aws-trap-for-startups-536c](https://dev.to/lucpattyn/the-aws-trap-for-startups-536c)

一段时间以来，随着该系统的用户与日俱增，我们在 https://cookups.com.bd 进行了一次相当成功的尝试。

我们的创业烹饪有点像自制食物的优步。这是我国订购自制食品的最大门户网站之一。

几天前，我们的系统(当然是在 aws 上运行)出现了 cpu 和 ram 使用量的激增。我们最初的假设是，由于我们的用户群每天都在呈指数级增长，这是一个非常令人头疼的问题。来自用户的订单越来越多，我们需要做的就是选择一个更高的 aws 层(比如 m 系列而不是 t 系列)，具有更高的 cpu 能力和 ram，问题就会得到解决。由于这是一个活系统，我们不想冒任何风险，并打算在正常的感觉占上风之前进行更高的配置。

幸运的是，我们决定在导入生产数据库的临时服务器中运行一个测试，使用更高的 cpu 和 ram，看看问题是否得到解决。第二天，它显示 cpu 和 ram 的使用在特定时间再次激增，尽管我们有了更多的 ram 和 cpu 能力，但问题并没有真正平息。

是的，每天都有更多的用户在我们的系统中注册，但是 cpu 的使用和 ram 的使用不应该在特定的时间达到峰值。然后我们发现，有一个调度程序每天运行一些计划的任务，因为我们的数据库中有一些损坏的数据(由于我们后来修复的一些以前的编码错误)，数据库被锁定，cpu 和 ram 的使用增加了，因为调度程序失败并一次又一次地重试计划的任务。所以，我们正要把硬件扔给软件问题。

由于在 AWS 中升级 RAM 和 CPU 很容易(至少这是互联网上有意或无意推广的)，当我们看到 CPU 或 RAM 的使用量增加时，就会倾向于纵向扩展，尽管问题可能在其他地方。这就是为什么我称之为 AWS 陷阱。

因此，这里有一些关于如何避免在没有深入调查的情况下立即进行缩放的提示:

1)检查 cpu 和 ram 使用的性质。

如果 cpu 或 ram 在一天中的某个时间段急剧增加，很有可能是代码或数据库出现了问题。

2)查看 RAM 或 CPU 使用情况图表是否如下所示:

[![Alt cpu/ram usage](../Images/6013a48522cd6d9c165a2dd13b4decf2.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--qmcFgtgm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/lvmu0yh56v9s6feyklhf.png)

最有可能的是，对于一个刚起步的公司，这种类型的 cpu 或 ram 图表不是因为用户突然增加。这可能是由于一些编码错误。

3)在真正进行扩展(垂直或水平)之前，想想是否有办法识别瓶颈(最有可能的是，无论你承认与否，在初始阶段有相当多的瓶颈)并首先解决它们。

4)审查现有代码，如果可能的话改进 sql/orm 查询，并确保您真正理解正在发生的事情。

5)将扩展和过早优化作为任何新系统的最后选择。

落款，
@mukit