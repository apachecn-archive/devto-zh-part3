# 部署最佳实践

> 原文:[https://dev.to/tedcarstensen/deployment-best-practices-6ge](https://dev.to/tedcarstensen/deployment-best-practices-6ge)

由于 devops 的发展和容器的出现，应用程序现在比以往任何时候都更加可移植。所以现在的问题是，初创公司如何构建产品来满足本地、云 SaaS 和混合云客户部署的需求？

加入 HashiCorp 首席执行官 Mitchell Hashimoto、Heptio 联合创始人 Joe Beda (Kubernetes & Google 计算引擎)和 launch crystally 首席执行官 Edith Harbaugh 的讨论，他们讨论了架构对公司部署选项的影响，以及他们对部署未来的展望。

*[Mitchell Hashimoto](https://twitter.com/mitchellh) 是 [HashiCorp](https://www.hashicorp.com/) 的联合创始人兼首席执行官，在这里，他专注于帮助各种规模的团队将现代应用部署到跨越物理、云、虚拟化和容器化工作负载的复杂基础架构中。*

*[伊迪丝·哈博](https://twitter.com/edith_h)是[launch darky](https://launchdarkly.com/)的联合创始人兼首席执行官，在这里，她帮助微软、CircleCI 和 Atlassian 等客户每天提供和管理超过 100 亿个功能。*

*[乔·贝达](https://twitter.com/jbeda)是[赫普蒂奥](https://heptio.com/)的联合创始人兼首席技术官，在那里他继续支持和推进开放的 Kubernetes 生态系统。*

[https://www.youtube.com/embed/QG6vsbGQUeE](https://www.youtube.com/embed/QG6vsbGQUeE)

Joe Ruscio: 我们来谈谈部署。我想给它一个非常好的观点。作为供应商，部署是您如何找出如何将价值传递到您的客户手中，并在他们希望获得价值的地方满足他们的机制。理想情况下，就最后一个面板而言，以对你有利的方式将其货币化。我们应该从今天开始，回顾一下历史上有几种不同的部署模式。不管是不是前提，在 90 年代有一段短暂的患有自闭症的妄想期。我们不再谈论那个了。当然还有 SaaS，有人会说我们现在正处于 SaaS 的黄金时代。所以我们可以从乔开始往下跑。您做什么部署，使用什么模型？

**Joe Beda:** 我们帮助企业充分利用 Kubernetes。我们所做的很多事情都是在现场与现场工程师一起，帮助他们，培训他们，帮助他们理解和运行 Kubernetes，在那里提供工具集。这确实是授人以鱼之类的事情，但我们也在建立免费服务。我们仍然处于这一旅程的早期，我们正在与真正的大公司打交道。因此，我们仍在评估从纯 SaaS 到运送人的比特的选择范围，以及介于两者之间的一切。

甚至有些探索正在进行中。这个面板会对你有用。

是的，我在听。我想看看这些人怎么说。

**乔 R:** 好的。太好了。

**伊迪丝·哈博:**我叫伊迪丝，是 LaunchDarkly 的首席执行官和联合创始人。我们是一个功能管理平台。我们主要是帮助 SaaS 和 IT 公司向客户提供他们自己的功能。根据定义，我们从 SaaS 开始，所以我们有客户，例如，哈希公司就是一个客户。我们有像 Meetup 这样的客户，他们使用我们说，“这就是人们在非常敏捷快速的环境中获得的功能。”我们必须是 SaaS。这只是我们开始时的样子。

**米切尔桥本:**爽。我们有许多开源工具，我们有这些工具的子集的企业差异，它因工具而异，但我们提供-我将按收入来细分。那是做这件事最简单的方法。我们目前约 90%的收入来自内部安装。当我说的前提下，它可以意味着裸机，或者它可能只是在私人 VPC，但你正在管理它。另外 10%是 SaaS。我们确实有一个 SaaS 产品在增长，最近，但现在谈论收入数字还为时过早，我们也一直在与 MSP 合作。看看我们自己的托管服务，单租户。我笑是因为我们最终什么都做了。

乔 R: 是啊。在某些时候，整个篮子。

乔 B: 那也是我们要去的地方。

Joe R: 这方面的快速时间表。在开源背景下，天真地看起来本地将是第一步。你开始了吗——SaaS 对你来说相对较新吗？

**Mitchell:** 我们的第一步是内部迁移。因为有了开源，我们习惯于向人们交付包和二进制文件。交付现场服务相当简单，我要说的是，对我们来说，最难的部分是非技术部分。

Joe R: 这很有意思，因为 Edith，我们刚才谈到的一件事是 SaaS 应用程序有不同的类别。在有些情况下，我们只是在数据库前包装业务逻辑，从概念上来说，包装和收缩包装是很容易的。黑暗发射不是其中之一，对不对？

Edith: 最基本的，你可以把我们想象成一组 SDK，我们的客户实际上把它们安装在他们自己的软件中。然后，我们有一个集中的仪表板，他们的开发人员、产品经理、营销人员、客户成功控制功能。在某种意义上，你可以说我们确实有一个本地的，而且我们有一个人们必须使用的轻量级 SDK。

乔 R: 你有一个边缘件。

伊迪丝:是的，但它的核心其实是我们自己的仪表板，它在云中。

**Joe R:** 您 90%的收入来自内部，这种模式对您来说最大的挑战是什么？

**Mitchell:** 最大的模型是我们正在进行的安装平台的多样性。大家在销售过程中总说“我们很正常。这是一个简单的网络布局。”

我喜欢说，每个企业都是他们自己的小加拉帕戈斯群岛。

米切尔:但他们认为这很正常，就像“我们的磁盘很可靠，一切都很好。很简单。只是 Linux”之类的。而且几乎从来都不是这样。几乎总会有一些奇怪的事情，这很难。然后，产品开发也会受到相当大的影响，因为前提是客户不想更新。

> 更新是他们必须计划和做的一件事，如果有些东西在工作，为什么要改变它呢？让他们更新真的很难，所以你想以更敏捷的方式前进。

你想每周发布一些功能，但另一方面，付费用户会说“请不要发布任何功能”。请停止。”这很有趣，因为这是违反直觉的，但我们的合同有条款说，如果你不在特定的发布期内，你不仅会失去支持，还会失去软件的许可证。支持期。

**Joe R:** 那么，当你考虑长期支持时，那是什么呢？你的 LTS 术语通常是什么？

**Mitchell:** 现在时间很短，那是因为我们说不。给你的一个好建议是试着说不。我们会有客户来找我们说，“我们想要三年 LTS 支持。”“没有”“好吧。”就这样结束了。我们现在的 LTS 是一年，真的很短。这种情况不会持续太久，但在创业初期，尽量缩短 LTS 时间是非常重要的。因为我们已经弃用了一些功能，而事实上，你不能在两年内通过编码删除一个功能，这真的很痛苦。

伊迪丝:我有 2000 年代作为一名工程经理的所有伤疤，这是每次发布的巨大税收。这是一种多重意义上的税收。我们必须做一个受支持的平台列表，看看您可以在哪些数据库和应用服务器上安装它？这个大客户运行的是什么疯狂的 Sybase 版本？那是它自己的税。

**Joe R:** 之前提到过 Kerberos。

伊迪丝:然后，另一项税收就像，你开始积累我甚至可以说是技术债务，“这个老功能与新功能一起工作吗？”你想做你的新客户要求的这种很酷的新东西，而有一个客户拼命地坚持这个东西，然后你就像“上帝啊，不要。”

Mitchell: 这对供应商来说是真正的成本，因为你通常需要在内部维护测试矩阵。我们是一家类似云的公司，但在我们的办公室里，我们有服务器的物理机架，上面有我们的客户发送给我们的笨重的硬件，只是为了进行验证。

Edith: 每一个版本的税收都是如此之高，以至于你会想，“测试三个数据库版本和两个应用服务器真的那么难吗？”就像是，“是的。是的，它是。”

**Joe B:** 我们收入的 100%来自防火墙后，一半来自 AWS，一半来自内部。我们与客户保持同步的一个理由是，我们现在支持 Kubernetes 的 N-1。那是六个月的时间。

> 我们真的希望人们能搭上这趟列车，这样他们就能从更大的生态系统中受益。这取决于你在运送什么，但是如果有一套工具，如果有他们想要集成的其他东西，如果他们落后太多，那么他们就会搁浅。

这是他们希望搬到 Kubernetes 的原因之一，这样他们就可以利用这个生态系统。我们真的帮助他们用那种方式自助。

伊迪丝:落后是如此的危险，因为你所说的那些老版本的人。当他们试图升级时，风险越来越大。

Mitchell: 挑战之一是因为我们是一家开源公司，我们无法控制非客户。我们会找到现在想成为客户的人，我们意识到他们是三年前的版本。它迫使我们准备好这些升级路径，这很糟糕。没有什么好办法。

**Joe R:** 这显然是不同行业的偏好范围，Joe，我很好奇，在你的谈话中，你有没有发现垂直行业比其他行业影响更大？我假设医疗保健或金融科技，我们在 Heavybit 谈论了很多我们称之为面向企业的潮人企业。卖给 Airbnb 或 Pinterest 或 Lyft 与卖给美国银行是不同的。

Joe B: 我们专注于那些不属于技术前沿的西海岸公司，因为我们想训练自己如何向主流企业交付产品。他们还有很多，即使云是一种自然的力量，它也会发生。SaaS，无论如何，这是要发生的。但这将比这个世界上，这个国家的这一边的许多人所想的要花更长的时间。

> 你必须灵活地在顾客所在的地方与他们见面，帮助他们走完这段旅程，这很痛苦。

我们有一个支持矩阵，这并不好玩。但这也是我们在补语上构建的东西。我认为，无论我们是以 SaaS 的方式，还是作为 Kubernetes 专有补充的 on-prem 的方式，都需要与客户进行协商。你要做的是说，“我们要去 SaaS，我们要每周发货。吸起来。”他们想要的是拥有所有最新功能并且永远不会改变的产品，他们也永远不需要升级。这在生理上是不可能的。这是一场谈判，随着时间的推移，随着人们对此越来越适应，谈判也在发生变化。我们确实看到了这种转变。

乔 R: 伊迪丝，在 SaaS 这边。有人提到了我确实想问的问题，但在最后一个面板中，提到了单租户实例。这是 ASP 的精神后裔，除了供应商同意这样做。只有 SaaS 才有 LaunchDarkly，你在野外有这些吗？

伊迪丝:是的。继续乔贝达所说的，我们有一个双乔，我不知道是否有人注意到这一点。我们的许多客户都是真正的大型企业，他们正在向我们寻求帮助，我昨天听到的一句名言是，他们向我们寻求灵活性和稳定性之间的和谐。所以，根据你的观点

乔 B: 你应该发微博。我相信你已经有了。

伊迪丝:他们来找我们，因为他们说，“我们被所有的时尚公司甩在了后面。我们不想成为 Airbnb 价值数十亿美元的乏味的连锁酒店。我们不想成为 PayPal 价值数十亿美元的乏味银行。”他们知道他们必须加快速度。

> 现在已经不是 2004 年了，每个人都把软件作为成本中心来削减。

通常，当他们处于转型的某个阶段时，他们就会来找我们，“我们正在从数据中心迁移到云，我们需要更快地迁移，但我们仍然需要稳定地迁移。”他们正在寻找像 LaunchDarkly 这样的供应商来帮助他们。

单实例出现的原因是，有时我们确实有非常大的客户，他们说我真的需要一个单实例。通常原因和玛丽安娜给出的差不多。法规遵从性，很多 PII。不可预测的尖峰工作负载，他们想要自己的实例。我们通常的第一个回应是，我们说，“我们每天提供 400 亿面国旗。每个人都喜欢认为他们是巨大的，但我们实际上是在为像 fuboTV 这样的客户服务，fubo TV 是头号体育应用程序。我们为 Atlassian 供电，我们为 Hashi 供电，我们可以处理您的工作量。他们继续说，“我们真的想要这个私有实例。“我们通常向他们报出价格，他们的眼睛会说，”你知道吗？SaaS 很不错。"

乔·R:是的，“现在听起来很不错。”当人们在 2018 年谈论本地时，一件有趣的事情是，Mitchell，我感兴趣的是，本地指的是你对传统空气间隙的看法有多频繁？我是说，没有网络连接，或者有重重防火墙的数据中心？或者实际上只是，“我们在亚马逊上有自己的 VPC。这是前提。”

米切尔:对我们来说，这是相当分裂的。我要说的是，我们仍在进行大量传统的内部部署、物理内部部署，但我要说的是，这与我们公司的情况有所不同，因为我们销售许多带 Vault 的安全软件。许多人部署 Vault 的方式是他们在云中或在 Kubernetes 上或其他地方，但他们仍然想要他们的主 Vault 群集。他们通过 Vault 从我们这里购买的企业功能之一是多区域。但是他们希望主保险存储群集位于一个物理位置，而不是通常的空隙位置。因此，这种情况会出现，但这一切转移到私有 VPC 只是时间问题。我们设计的一切都假设 VPC。如果你这样做了，它的规模就会缩小。**乔 R:** 另一件事我想得到一些人的意见，因为我有意见。多云是一个让我兴奋的词，因为它是一个东西，我不认为它的意思是大多数人说出来的意思。就部署目标而言，多重云对您意味着什么？你在野外看到了什么？Joe，你是在和多云化的人说话吗？

Joe B: 首先要认识到的是，当你是一家初创公司时，你的失败模式是你没钱了，但没人在乎。当你是一家大公司时，你需要应对不同的风险。多重云最终成为一种风险缓解类型的东西。几乎我们所有的客户都不希望在其他云上运行，但他们希望能够选择在其他云上运行。

> 他们想知道迁移一些东西需要两到三个月的时间，这很痛苦，但我们能做到。

相对于“让我们重写我们的应用程序，这将是一个为期三年的过程来移动东西。”对我们来说，因为我们知道我们正在构建的东西，其中一些我们将以多租户的方式运行。我们将在防火墙后为人们运行的一些东西，我们尽可能保持我们的东西简单明了。我们不会尽可能多地使用花哨的东西、你的小虚拟机、工厂数据库，这样我们就有了灵活性。

**乔 R:** 明白了。Mitchell，您有多个云客户。他们长什么样？

米切尔:截至今天，财富 500 强中大约有 100 家是付费客户。在这 100 个中，99 或 100 个是多重云。当我提到多云时，我总是说的第一件事是多云有四种完全不同的定义。还有工作负载的可移植性，这是非常罕见的。这意味着你可以在任何云上运行你的应用，这几乎是不可能的。还有工作流可移植性，这意味着你将应用程序部署到 Amazon 的方式与你部署到 Azure 的方式是一样的。这通常是真的。还有流量可移植性，这意味着根据地理区域的不同，你会选择不同的云提供商。

这很接近，但不等同于工作负载可移植性。这是半罕见的，但更常见。然后是数据可移植性，这意味着你的实际数据可以移动云，这几乎从来不是因为光速。这就是四件事。工作流可移植性是我们公司的卖点，在企业中尤其普遍。如果只是最基本的原因就是并购，当一家大公司正在收购另一家公司，而那家公司选择了上谷歌，而你的公司选择了上亚马逊。作为 M&A 进程的一部分，这家大公司不会将基础设施从谷歌转移到亚马逊。

他们会说，“你呆在谷歌，我们呆在亚马逊，让我们做自己的事。”您最终会在云之间产生业务单位级别的分离，因此不存在工作负载可移植性。它们是独立的应用程序，完全是孤立的。我们看到的另一件事是，云现在开始区分最佳 ML、最佳无服务器和各种不同的高级功能。一些团队甚至在同一个视图中想要利用不同的技术，所以我们看到了很多。但在大多数情况下，它几乎无处不在。尤其是如果您认为本地云或多或少是一种不同的云，如果您只是投入其中的话。

> 因为企业的本质是任何范式的转变，像大型机到服务器，服务器到虚拟机，虚拟机到容器，容器到调度器，调度器到无服务器。所有这些不同的转变，大概都是 10 年，这 10 年是重叠的。他们总是处于异质状态。

即使这些优秀的新团队完全处于 Kubernetes 工作负载中，他们也有一些团队仍处于服务器虚拟机转换的最后两年。作为一个供应商，你要么说，“我们不帮你，”你可能会降低你对公司的影响和价值，或者你试图找出一种方法来使它工作。

**乔 R:** 明白了。想法？

**乔 B:** 是的。我觉得比 10 年还长。对于 IBM 来说，大型机仍然是一项不断增长的业务。他们在那上面赚了很多钱。另一点是关于多云数据，有些情况下，大公司，我认为像电影工作室。他们会将数据备份到多个云中，因为他们不相信亚马逊承诺的那些“八个九”或任何耐用性。黑天鹅事件等等。

伊迪丝，特色旗帜，这是我心中最亲近的旗帜。

伊迪丝:我也是。

乔 R: 你发现了吗，就来个有趣的兜兜风。作为托管云 SaaS 产品的 SaaS，您是否发现客户使用功能标志管理本地产品中的功能？

伊迪丝:是的，绝对是。也许你应该谈谈你是如何利用我们的。

米切尔:不，你去吧。

伊迪丝:不，你去吧。

米切尔:好的。我只想说功能标志，我之前提到过我们的本地客户不希望升级太快。我们快速提供功能，我们只是关闭它们。

乔 R: 你只是把它们藏起来。有意思。

米切尔:他们得到了。他们看不到。

Joe R: 他们被部署了，但是他们没有被释放。

米切尔:对。并且它们没有运行实际的运行时组件。

伊迪丝:我们有很多客户利用我们来管理他们自己的客户。如果他们已经签了合同，而这个客户说，通常会说，“我们在这个 UI 上做了很多培训。我不想要新功能。”句号。即使可能有像工会规则那样严格的东西，如果你说的是航空公司，关于你多久可以改变一次用户界面。他们会有一些功能，然后他们会说，“我们打算在这个日期进行一次培训，”这就是我们想要打开它们的日期。

乔·R:他们没有连续交货。

**伊迪丝:**是开发商要的。这些客户所青睐的开发人员正在大量生产功能，他们真正喜欢功能标志的是，开发人员可以非常快速地移动，然后使用功能标志来匹配其余的工作。例如，他们可以构建一个功能，然后计划所有的培训。

**Joe R:** 另一件有趣的事情是，这与上一个小组讨论 SLA 的内容重叠。

> 您可以使用功能标志来实现许多高级支持服务，或者您提供给人们的 ui。他们选择加入白金计划，你在他们的帐户上切换标志，他们就可以得到所有的好处。

米切尔:当你意识到世界并不是超级平的，不同的国家有着不同的法律时，这是一件特别有趣的事情。我们不使用 launch crystally，但我们使用功能标志，例如，当我们在中国销售 Vault 时，我们必须禁用一系列加密算法。那里的法律不允许，这是一回事，对吗？你必须有所有这些功能配置，不同的地区可以用你的软件做不同的事情。

**Edith:** 另一个类似的使用案例是一些客户会说，“我是一家银行。不要给我这个功能，直到它已经与你的其他客户 98%的战斗硬化。”

**Joe R:** 稍微改变一下思路，我一定要确保我们今天讨论的对企业销售很重要的是渠道。有很多不同种类的渠道。我们可以从米切尔开始，你提到了 MSP。首先，这里有多少人知道 MSP 是什么？好的。没关系。你仍然应该在 HashiCorp 的交付策略中定义它以及它是如何工作的。

米切尔:当然可以。当你越过潮人企业，潮人企业就像空中旅馆，网飞，世界的那些。他们想自己经营。然后，你会在德克萨斯类型的企业中获得更多价值数十亿美元的美容产品业务，他们希望在本地经营，但他们不想自己经营，也不想要 SaaS。他们想要介于两者之间的东西，而 MSP 是一个托管服务提供商，它是一个致力于在别人的场所为你运行别人的软件的企业。MSP 就是这样。

**乔 R:** 它有一个通道，因为这些有几万个。然后，如果他们对您的解决方案感到满意，他们可以有效地充当经销商。

米切尔:是的，当然。

或者至少你可以起草，他们会有现成的采购。

Mitchell: 有利也有弊，作为供应商，你想控制纸张，控制与客户的关系。有些 MSP 是经销商，有些不是经销商。有些你可以在你自己的论文发表后带来，他们有自己单独的服务协议，但这有好处也有坏处。

**Joe R:** 另一个，不是 variant，而是 Joe 我很好奇你的合作伙伴是否使用 var 或增值经销商？

乔 B: 我们还没到那一步。我们仍然想控制这种体验。那里还有很多加拉帕戈斯群岛需要处理。但是随着您的部署变得越来越全包，随着您对模式的理解，引入 var 或 si 并让他们扩展您的范围是有意义的。

一般来说，他们倾向于增加，特别是当我们回到垂直市场时，他们会专注于一个垂直市场。

乔 B: 他们说隐语。

他们说隐语。他们知道对该垂直市场中的买家至关重要的事情。

米切尔:他们通常高度专业化。就像是，“只有 AWS，只有安全和财务。”市场就是这么大。他们可以这样做，仍然是一个十亿美元的业务。

一些大公司，我知道一些公司有开放的预算。所以，当你谈论的时候，我们甚至还没有谈到预算周期，因为这不是一个采购小组。但是他们会把实际预算放在一边，你不需要做预算，你可以直接进入预算。

乔 B: 我们已经做到了。就像是，“我们想让你通过采购，但这要花很长时间。只要给这些人 5%就行了。”。

乔 R: 所有的问题都消失了。这根本不是敲诈勒索。

**Edith:** 我们肯定有，我们不打折，但是有人说——那只是一家大型体育用品公司说，“我们想买你。我们不能向你购买。你能卖给这个会加价两倍的人吗？”我们会说，“好吧。”

其他渠道走的是另一条路。有 Heroku 附加组件市场。亚马逊有，虽然它已经存在了一段时间，特别是在最近一两年，他们显然开始投资他们的市场。你看到那些倾向于自助服务的人了吗？或者自下而上，你是否看到大型亚马逊客户的企业应用进入市场？

米切尔:对我们来说，这因云而异。我不想说出任何人，所以我会说我只是不会说出他们的名字，但有一些云市场真的没有用。他们只是演示，自助类型的东西。还有其他云市场，他们在将 it 整合到如何更好地控制控制面板流程和计费方式方面做得更好。BYOL，带上你自己的企业软件许可证，我们已经看到它被更好地采用，但它没有直销那么强。

> 市场是艰难的，因为在你和云之间有一个中间人。

您希望与客户建立直接关系，因为正如前一个小组讨论的那样，当您有 tam 和各种 SLA 等时，您真的希望建立这种直接关系。

伊迪丝:这取决于你的买家是谁。如果你卖得更多，或者如果你的买家是工程副总裁，他们不想只做一点点击包装。他们想要更多的白手套服务。他们想要一些演示，他们想要一些帮助。

Joe B: 我会说，在很大程度上，我将市场视为供应商介绍服务。对他们来说，这是一个很好的方式，看看那里有什么，然后他们会绕过市场去做交易。如果你能帮助引进一些人，云还提供了其他项目，这将推动他们在平台上的更多支出。他们会给你一份。各种云提供了这些通道程序，因为它们的目标是获取尽可能多的周期、字节和数据包。如果你能帮忙做那件事，他们会给你一部分利润。这些可能是非常好的渠道。

米切尔:这也是一项非常酷的技术。很多人在云上将防火墙挡在外面，你不能打电话回家，知道是否有人在运行你的软件。我们也有这个问题。我们会做一个电话回家只是为了跟踪运行的数量，这是完全匿名的，但会有防火墙。

> 如果您可以与许多这样的云平台建立合作伙伴关系，我们与所有这些平台都有合作伙伴关系，它们都运行本地虚拟机管理程序服务器，您可以对其进行设置，这样您就可以 ping 通这些服务器。这真的很难阻止，云提供商会告诉我们有多少正在运行。太多了。

我们可以去找他们，他们会说，“你这个月运行了 200，000 个内核。”即使网络关闭，你也能知道。

乔 R: 真有意思。听起来你肯定需要在不同的项目上努力。我想我们时间不多了，所以我想快速点火。我们马上下去。给考虑在企业中部署软件的人一个建议。我们从你开始，乔。

乔 B: 我会说在客户所在的地方与他们见面。不要写来自未来的信，“这是一个美丽的东西。”相反，要认识到如果你带着人一起去，你会更成功。

伊迪丝:我们出乎意料地进取了。我们认为我们将会是一个自下而上的销售，我们的第一个大的销售是五位数。就像这样“啊哈！”我们正在解决一个大公司的问题。我们需要快速成长。所以，意识到谁是你的买家，我会重复乔的话。如果你被市场拉起，去那里。

米切尔:我的建议是，向企业销售的许多问题都是非技术性的。关注客户成功、tam、解决方案工程师、销售工程师。因为在任何比特到达服务器之前，他们将实际工作四到六个月。

**乔 R:** 谢谢。

乔 B: 谢谢你邀请我们。