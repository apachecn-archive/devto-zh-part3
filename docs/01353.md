# 无处不在的服务网格

> 原文:[https://dev.to/chintan8saaras/ubiquitous-service-mesh-404k](https://dev.to/chintan8saaras/ubiquitous-service-mesh-404k)

服务网格已经成为部署、管理和交付微服务的一种流行方式。实现服务网格的各种选择显示了它的受欢迎程度。像服务网格接口这样的计划是对网格接口标准化的一种尝试。随着 Google 提供 istio 来定义和提供服务网格，包括微软在内的一批其他公司已经开始了标准化服务网格的计划。

服务网格提供的可见性和好处仅限于微服务环境。将它们扩展到网格之外可以带来巨大的好处，尤其是在云原生环境中运行操作时。

在这里，我们将触及服务网格的一些安全特性、kubernetes 上的服务网格的提供者、围绕它的一些计划，并以[en route universal API gateway](https://getenroute.io)如何实现 API 的服务网格架构作为结论。

### [](#zero-trust)零信任

零信任假设实体之间没有信任。或者换一种说法，如果一个进程(或微服务)与其他进程一起运行在一个环境中，它们彼此不信任。在缺乏信任的情况下，必须有一种方法在彼此之间建立信任。

服务网格中的每个实体都需要一个身份。而且，它需要验证身份的能力。一旦建立了身份，就需要一种方法来指定谁可以与谁交谈的策略。

零信任环境提供了基于身份和策略的分段，可以有效防止违规。这也是一种强制遵守的方式。缺口通常利用漏洞着陆，并横向移动以扩散自身。它还尝试与外部服务(如命令和控制中心)通信，以报告环境。零信任环境通过确保受损实体无法与未经授权的服务对话来防止这种情况。这限制了你的爆炸半径。

### [](#visibility)能见度

服务网格提供遥测技术来检查系统的所有方面。这很关键。服务网格的平稳运行需要管理员快速查看遥测数据并识别问题(如果有的话)。

假设一个应用程序调用几个微服务来服务一个面向外部的 API。想象一下，如果其中一个微服务出现问题。提供关于每个微服务的详细信息的深度遥测可以帮助快速识别问题。这是运行服务网格的一个重要方面。

### Istio:Google/IBM/Lyft 实现服务网格

Istio 是一个流行的服务网格，它使用 Envoy 代理作为 sidecar 来实现服务网格的关键方面。

如上所述，服务网格也需要身份提供者。你需要一种方法来建立身份，然后执行它。istio 的 Citadel 以 X.509 证书的形式提供身份。执行部分(边车特使)使用这些证书来确保跨 pod 的通信仅根据指定的策略进行。

与每个 pod 中的服务一起运行的 sidecar 特使也报告遥测数据，以帮助观察这些微服务。除了像等待时间、吞吐量等常规统计数据之外。，这些边车也便于使用 Jaeger，Zipkin，Opentracing 等分布式跟踪。

### [](#linkerd-and-service-mesh-interface-by-microsoft-and-others)Linkerd(以及微软和其他公司的服务网格接口)

服务网格的另一个流行实现是 linkerd。istio 将 Envoy 作为 sidecar 代理运行(在每个 pod 中)，而 linkerd 有自己的代理(用 rust 编写),它与 kubernetes 集群(Daemonset)中的每个节点一起运行。它使用身份提供者获取证书，并可以加密节点间的流量以确保通信安全。

内嵌代理还报告可用于观察微服务的遥测。

服务网格的受欢迎程度可以从网格标准化的努力中看出。服务网格民主化的一个努力是微软的一个倡议— [服务网格接口](https://github.com/deislabs/smi-spec)。在撰写本文时(2019 年 5 月)，它还处于非常早期的阶段。它试图定义 kubernetes 对象(或 API ),这些对象将访问控制、流量特征、流量分割和度量等功能标准化。控制网格的这些方面的标准 API 将允许管理员具有统一的 API 来在异构网格环境中应用策略。

### [](#extending-tracing-outside-the-mesh)将描摹延伸到网格外

通过跨数据中心复制应用程序，可以实现应用程序的灾难恢复。DNS 规则可以在这些副本之间分配流量。但是，如果需要跨这些应用程序位置的任何形式的 L7 路由，那么在它前面加上一个代理是一个好主意。例如，在 lift-n-shift 类型的场景中，当(1)私有数据中心中的单一应用程序被分解为公共云上的云原生微服务时(2)在混合使用情形中，需要跨公共云和私有云进行流量分配。

现在，假设对于用例(1)，对于特定的 L7 路径，我们可以构建一个微服务并将其部署在公共云上。测试这种微服务的一种方法是复制这个特定 L7 路径的流量。或者，不是复制流量，而是将一小部分流量发送到新服务。

在上述任何用例中，如果[途中通用网关](https://getenroute.io)(或普通特使代理)在 L7 功能的网格之外运行，它可以提供端到端的跟踪信息。这样做的好处是能够端到端地可视化流量延迟，从 DNS 将其发送到边缘代理进行 L7 路由和处理开始，一直到微服务提供服务的地方。

在下面的轨迹中，标记为 edge-yastack 的跨度是由 edge 代理生成的跨度。它显示了从边缘代理到达 istio-ingress 网关所消耗的时间，以及每个步骤中产生的延迟。

[![](../Images/22b2569e3cfd79dc60efd719636fe4ec.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--cnfEFo8J--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AMNEtA4t30-EVlZU4OaVsQg.jpeg)

[途中通用网关](https://getenroute.io)是你的服务或微服务的 API 网关。[它可以独立模式运行，在 kubernetes 入口或以网状形式运行](https://dzone.com/articles/gateway-mesh)。

YAStack 是 performant envoy，它提供了 vanilla envoy 的替代产品来提高性能。

### [](#conclusion)结论

我们提出了一种方法来提供深度的端到端可见性，同时确保 API 网关功能、面向应用的多云和混合云用例的 L7 路由。随着应用被分解为微服务，管理它们的复杂性增加，[途中通用网关](https://getenroute.io)提供了必要的灵活性、可见性和网格扩展。它们可以在公共云或私有数据中心的任何地方运行，不需要像基于硬件的传统设备那样过度配置。这种架构提供的同构环境简化了操作。

如果您希望评估[在途通用网关](https://getenroute.io)，您可以使用此处的[联系我们。](https://yastack.io/contact2)