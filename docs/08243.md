# 清除旧数据的快感

> 原文:[https://dev.to/am2/the-thrill-of-purging-old-data-j3e](https://dev.to/am2/the-thrill-of-purging-old-data-j3e)

<figure>[![](../Images/ce1dd69fc38ffd5f89114bb9e11beed9.png)](https://www.youtube.com/watch?v=wdGARtyNaQQ) 

<figcaption id="caption-attachment-1737">我从过山车中得到一种刺激，但对一些人来说，它只是让他们净化他们的午餐。</figcaption>

</figure>

数据库管理员和数据专业人员往往是数字包鼠。我的个人 Google Drive 充满了我拒绝放弃的随机文件——尽管这些文件的价值值得怀疑。我很遗憾我没有我在高中或大学时打过的每一篇论文的副本——我很羡慕那些有副本的人。你永远不知道什么时候你会需要 6 年前那次会议的笔记，或者什么时候你会需要你为一个你不再记得的内部笑话制作的有趣的 GIF。

然而，在工作中，我们经常面临删除或清除数据的挑战。旧数据不需要永久保留。它可能对业务不再有用，或者可能被存档在某个安全的地方(以防万一！).在某些时候，保留数据的成本超过了保留数据的价值。在某些情况下，保留超过必要时间甚至可能是一种责任——在数据泄露如此普遍的时代，囤积数据会让不可避免的泄露更加痛苦。当然，还有 GDPR 要考虑——欧盟公民可以要求将他们的数据从你的系统中删除。

因此，我们最终必须删除数据。我承认，我是一个肾上腺素上瘾者，因为我在生产中运行 TRUNCATE TABLE 时感到兴奋。这比我在黑市上能买到的任何药物都要好。有时我怀疑自己是否会迷上截断表格。然而，这种删除数据的需求也带来了一些实际的复杂性。

## [](#its-easier-if-you-plan-to-delete-data)如果你打算删除数据，那就简单多了

如果您同意我的观点，即删除数据是不可避免的，那么最好用您的模式设计对此进行规划。在删除数据之前，您会将数据保留多长时间？保留是否基于数据的创建？是基于最后一次修改吗？也许这是基于用户是否活跃(定义“活跃用户”可能会变成一个完全不同的考验！)…

不管标准如何，在设计模式时，花点时间考虑一下这个问题。我们通常会被确保数据在我们需要时始终可用的主要责任所分散，并且我们忘记了我们还需要确保数据在不再需要时不可用。我们是否在数据创建时收集了正确的信息，以便在时机成熟时删除它？

如果保留是基于创建时间的，我们需要确保在行上保留一个`CreateDate`(或者你想叫它什么都行……因为我糟糕的命名约定，你可以随意放大注释)。如果保留基于“活动用户”场景，可能您需要跟踪用户最后一次登录系统的时间…最有可能的是，不是 DBA 或开发人员将决定这些规则，而是业务用户、法律部门或产品团队将做出决定。作为数据专业人员，我们需要确保在设计时提出正确的问题**，以确保我们能够适应以后的业务需求。是否应该在一定时间后删除？这段时间有多长？什么操作启动(或重置)删除时钟？**

 **提前进行这些对话可以确保您有数据和流程在以后删除它。有一个新表，数据保留三年？设置流程现在就删除，而不是三年后。三年后你可能会有一份新工作——一拖再拖可不是个聪明的主意。即使暂时不需要工作，也要在今天设置清除流程**。这将确保您的数据在适当的时候得到妥善处理。**

## [](#you-cant-delete-everything)你不能删除一切

尽管删除东西很有趣，但你不能删除所有东西。有一句谚语说“你不能解开一个铃铛”——有时数据就是那个铃铛。如果你卖了一个小部件，出于法律原因，你可能需要在若干年内保留该销售的所有细节。如果因为我删除了一些数据，去年的财务数据发生了变化(或不可用)，财务人员会非常不安。哎呀。

无论你从删除东西中得到多少刺激，你都需要逐个处理每个数据点。这意味着你也需要一个地方来记录这些细节。它不一定要很奇特——但它必须发生，而且必须始终如一。记下您需要将数据保留多长时间，以及是谁做出的决定。它可以像源代码控制中的表定义附带的一些注释一样简单。或者使用表上的扩展属性来跟踪它的保留要求。

重要的是提前想好，并记录下这些决定。

现在，如果你不介意的话，我要去截断`dbo.SalesOrderDetail`来刺激肾上腺素。

* * *

#### [](#additional-reading)补充阅读

*   [批量删除清除数据](https://dev.to/2019/04/purging-data-with-batched-deletes/)
*   [根据创建日期清除数据的代码](https://dev.to/2019/04/code-to-purge-data-on-creation-date/)
*   [DBA 数据库 Github Repo](https://github.com/amtwo/dba-database)

清除旧数据的兴奋感首先出现在 T2 的安迪·M·马龙-安的 T3 上。**