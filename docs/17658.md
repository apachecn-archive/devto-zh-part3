# 备份和恢复您的 SQL 数据库

> 原文:[https://dev . to/rachelsoderberg/back-up-and-restore-your-SQL-database-4ol 8](https://dev.to/rachelsoderberg/back-up-and-restore-your-sql-database-4ol8)

有时候，开发人员需要经历这样一个过程:安全地创建现有数据库的新版本，或者每隔几个月用生产数据更新/刷新他们的开发服务器。作为一名初级开发人员，这是我的技术主管要求我做的最可怕的事情之一，因为我觉得我有可能弄乱我们所有的客户数据并毁掉公司！当然，我们有备份，这是一个愚蠢的恐惧；经过一点时间和练习，一切都很顺利，我没有毁掉我的公司。如果您可能是第一次使用 SQL Server Management Studio 2012 备份和恢复工具，或者刚刚使用了一段时间，并且希望确保使用正确，那么这份方便的小指南将带您了解这些工具。

对于本指南，我将假设您已经有一个现有的数据库(或者两个，如果您用一个数据库的数据还原另一个数据库)，并且您是当前唯一访问您想要备份或还原的数据库的人。如果其他计算机/用户可能连接到此数据库，您必须确保此时您是唯一访问它的人(通过 SQL 或潜在的. NET 或其他应用程序)。如果您不确定是否有其他用户连接，请在新的 SQL 查询中执行 *sp_who* 以查看登录到服务器的所有主机和用户的列表以及它们的状态。休眠和可运行状态都可能导致备份和恢复过程挂起，因此它们都必须断开连接。

在对象资源管理器中右键单击要备份的数据库，导航到任务，然后选择备份(如果对象资源管理器未打开，请通过工具栏视图>对象资源管理器打开)。

在“备份数据库”窗口的“常规”页面中，您需要确保在下拉列表中选择了正确的数据库，可能需要完整备份类型和数据库备份组件，并在适用的情况下重命名数据库备份集以及任何描述和到期时间(可选)。删除文本框中当前的任何目标，单击添加，然后单击“...”目标文件名框旁边的按钮。选择备份的位置，并给它一个文件名。注意:一定要在文件名后面加上. bak 扩展名，否则以后就更难找到了！然后单击“确定”,直到返回到主“备份数据库”窗口。在“选项”页面下，我通常会保留这些设置，但是如果您希望当前备份覆盖现有备份、验证您的备份或继续出错，请根据需要选择这些设置。完成后，单击确定，SQL 将开始执行备份过程。假设该过程成功完成，您应该很快会看到一个弹出窗口，显示同样的内容。

为了恢复我们的数据库，我将介绍两种不同的场景。使用以前的备份还原现有数据库(可能是由于您想要修复的某种错误)。
2。使用不同数据库的备份恢复现有数据库(例如，您有一台生产服务器和一台开发服务器，并且您希望确保开发服务器具有最新的生产数据)。

这两种场景的工作方式相似，但最终结果会略有不同。

无论是哪种情况，我们都将右键单击要使用备份文件恢复的数据库，然后导航到“Tasks”>“Restore”>“Database”。在您要将源更改为设备的常规页面中，单击“...”按钮，并找到。你刚才创建的 bak 文件。如果你忘了用。bak 扩展名，您将需要导航到您使用的路径，并选择“所有文件”类型的文件来找到它。单击“确定”,直到返回“恢复数据库”主窗口。在“目标”下，确保从“数据库”下拉列表中选择了要使用备份恢复的数据库。**如果您使用数据库自身的备份来恢复数据库，数据库名称应该匹配。如果您使用不同数据库的备份来恢复数据库，它们将不会匹配，这应该反映出要用备份数据“覆盖”的数据库的名称。**

接下来，在“Files”页面中，更改三个“Restore As”选项，以与最后一部分类似地匹配——要么是与备份相同的数据库，要么是在使用另一个数据库的备份数据更新另一个数据库的情况下将被覆盖的数据库。如果您要重新定位所有文件或需要使用特定的数据和日志文件夹，请选中此框并分别选择您的文件夹。在“选项”页面中，确保选择“覆盖现有数据库”恢复选项，以便新数据覆盖旧数据。其他两个复选框是根据需要的，保留复制设置并限制对恢复的数据库的访问，因此请根据需要使用它们。最后一个选择——在恢复之前进行 tail-log*备份——是我通常取消选择的选项，但根据您的恢复情况，您可能希望保留该选项。您可以选择在恢复每个备份之前进行提示，但这不是必需的。

* **Tail-log** :对于任何尚未备份的日志记录，Tail-log 会捕获这些记录并将其带走，以确保没有丢失任何工作，并保持日志链完整。并非所有情况都需要尾日志，例如，如果恢复点位于较早的日志备份中，或者在我们的示例中，我们正在覆盖数据库，并且不需要将它恢复到最近一次备份之后的某个点。
T3】https://docs . Microsoft . com/en-us/SQL/relational-databases/backup-restore/tail-log-backups-SQL-server？view=sql-server-2017

单击确定。如果数据没有损坏，并且您仍然是唯一连接到被覆盖/恢复的服务器的人，您应该很快会看到一个确认窗口，说明恢复成功。您的数据库应该反映备份的数据，并处于正常工作状态！