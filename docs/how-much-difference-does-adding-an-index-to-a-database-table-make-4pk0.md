# 向数据库表中添加索引会产生多大的影响？

> 原文：<https://dev.to/matthewbdaly/how-much-difference-does-adding-an-index-to-a-database-table-make-4pk0>

在过去的几周里，我一直忙于为我维护的传统内部网系统建立一个新的主页。新的主页几乎是用 React 从头开始构建的，并有一组全新的查询。此外，我还为导航重新构建了 UI，以便使用 React。这让我绕过了整个代码库中许多最糟糕的代码，目的是在新主页上线后就把它们去掉——这让我非常高兴！

作为其中的一部分，我构建了一些新功能来显示最近七天添加的项目。主页的这一部分可以通过几个参数进行排序，包括流行度。我还添加了一个工具，通过 AJAX 请求将其扩展到 31 天。然而，AJAX 请求非常慢，通常需要 20-30 秒。此外，主页加载速度非常慢，检查查询时间表明，罪魁祸首是对新条目的查询。

对新条目背后的查询(初始页面加载和 31 天 AJAX 请求)的进一步检查表明，问题是一个连接。去年，我的第一个任务之一就是添加一个工具来记录任何媒体项目被访问时的轨迹。这是使用多态关系完成的。虽然 Zend 1 没有 Laravel 提供的对多态关系的现成支持，但伪造它是可能的，所以我创建了一个`tracks`表，其列包括被跟踪对象的主键的`trackable_id`、其类的`trackable_type`和访问它的用户的 ID 的`user_id`。现在，我使用同一个表，通过连接每个媒体项目来确定每个项目被查看的次数，这是除了在管理中生成的报告之外，第一次读取它，性能非常慢。

一旦我确定从查询中移除该连接就消除了性能问题，那么很明显我需要向`tracks`表添加一个索引。该表已经变得相当大了(低几十万)，所以它有很多要整理。由于 join 使用了`trackable_id`字段来连接添加的条目，这似乎是一个不错的选择，所以我在那里添加了索引。

委婉地说，结果是戏剧性的。初始页面加载时间从 4.44 秒下降到 1.29 秒——大约是以前的三分之一。对于获取最近 31 天的新项目的 AJAX 请求，结果甚至更令人印象深刻——加载时间从 22.44 秒下降到 1.61 秒。总的来说，找出查询的哪一部分导致了差的性能并解决它需要大约 10 分钟，并导致了惊人的改进。

如果您没有特别扎实的关系数据库理论背景，索引知识可能会有所下降。然而，正如您从这个例子中看到的，如果您有一个特别慢的查询，那么添加一个索引可以产生惊人的差异，所以花时间了解更多关于索引的知识以及它们在什么时候有用是非常值得的。