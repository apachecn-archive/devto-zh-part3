# 12 个月内 12 种语言:ionice for Mac OS，C 语言

> 原文:[https://dev . to/dr hyde/12-languages-in-12-months-ion ice-for-MAC-OS-in-c-4chj](https://dev.to/drhyde/12-languages-in-12-months-ionice-for-mac-os-in-c-4chj)

我知道人们通常会在新年给自己设置这样的挑战，但我最近看到了《七周七种语言:学习编程的实用指南》这本书。不，我没有读过它，但是这个概念在我的脑海中挥之不去，所以我决定做一些类似的事情，摆脱我的双语 shell 和 perl 习惯。今年的挑战是用 12 种语言写一些有用的东西，而不仅仅是一个教育玩具。

当我在三月份开始时，我决定把一月和二月作为 gimmes，并说他们对我不断使用 perl 和 shell 感到满意。然后我开始四处寻找这个月的一个小的、简单的、但最重要的是有用的任务。

现在，我家里有一台有点旧的 Mac Mini，上面挂着比合理数量更多的磁盘，因为我将这台机器用作我的家庭媒体中心和文件服务器，并使用 [rsnapshot](https://github.com/rsnapshot/rsnapshot) 自动备份我所有的其他机器。问题是，进行备份会产生一吨*IO，而那台机器有...好吧，就说磁盘争用问题吧。如果它将本地文件系统备份到另一个磁盘，就没有足够的 IO 来完成录制直播电视等任务。*

一段时间以来，我一直在用脚本解决这个问题，这些脚本在开始和停止记录某些东西时向 IO 饥渴的进程发送 [SIGSTOP/SIGCONT](https://major.io/2009/06/15/two-great-signals-sigstop-and-sigcont/) 信号。这基本上是可行的，但是如果它停止了一个进程，这个进程在敲打磁盘的同时也在网络上进行对话，那么它就会有不好的副作用。当使用 SIGCONT 恢复该过程时，网络连接已经超时。

我真正想做的不是暂停和恢复进程，而是当更重要的东西想要使用磁盘时，让它们让开。对于那些了解 [nice(1)](https://linux.die.net/man/1/nice) 的人来说，这可能听起来很熟悉。为 CPU 访问做这种调度。您可以将一个进程设置为不太重要，或者如果您是 root 用户，您可以将它设置为更重要，然后当机器的 CPU 负载很重时，您的重要进程将比不重要的进程获得更多的 CPU 时间。

它如此相似，以至于在一些平台上也有 [ionice(1)](https://linux.die.net/man/1/ionice) ，它允许你用 IO 玩那些优先级游戏。不幸的是，还没有人把它移植到我能找到的 Mac OS 上，所以我决定把它作为我的小型、简单、有用的 C 项目。

我没有实现 Linux 版本拥有的所有选项，因为 Mac OS 上的相关系统调用似乎不支持获取/设置其他进程的 IO 优先级。谢天谢地，我不需要那个。我的需求可以通过启动一个具有更高或更低 IO 优先级的进程来满足。

所以，我给你...ionice-MacOS ，从我的清单上勾掉第三种语言。我当然欢迎补丁和错误报告，我希望它对你有用。

当然，我预计它会在几年内过时。从我的测试来看，如果你使用固态硬盘，它似乎只有最小的影响。事后看来，这是你所期望的，因为在重负载下真正减慢旋转 rust 速度的是磁头为了下一次读写而来回颠簸。固态硬盘是真正的随机存取，因此它们的性能在负载下不会下降太多。我最初是在我的笔记本电脑上写的，它有一个 SSD，最困惑的是它似乎没有真正做任何事情。我花了一段时间才意识到问题出在哪里，并转向了最初引发这一系列练习的 Mini)