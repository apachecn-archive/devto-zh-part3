# 用 C，Go & Swift 构建一个跨平台的小型 CLI 工具

> 原文：<https://dev.to/gerwert/on-building-a-small-cross-platform-cli-tool-in-c-go--swift-45d4>

作为一名程序员，一件很棒的事情是，如果你需要特定的、定制的工具，你可以自己写。通常有现成的选项，但是当然编写自己的工具更有趣，尤其是当您有空间进行一些实验的时候。

[![](img/9c3e86731c3c77497a4f4d919ee2d82f.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--5G3ULnVL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn-images-1.medium.com/max/1024/1%2AGw0ATlzGnZnFFYky_w7HyQ.jpeg)

这就是我如何编写一个简单的工具..三次，用不同的语言。

#### 实验

我的目标是编写一个非常简单的命令行工具，可以生成与 [Google Authenticator](https://en.wikipedia.org/wiki/Google_Authenticator) 兼容的一次性密码。Google authenticator 使用[基于时间的一次性密码算法(TOTP)](https://en.wikipedia.org/wiki/Time-based_One-time_Password_algorithm) 来生成代码。我不想编写自己的实现，而是想使用现有的 TOTP 库，因为已经有很多好的库了。

本质上，我希望我的工具做的就是接受一个秘密作为单个输入，然后调用一个现有的 TOTP 库来生成代码，并将生成的访问代码打印到标准输出中。

我问自己的问题是:假设我想在几个平台(Mac、Windows、Ubuntu)上使用该工具，并且想

在一小群人(不一定是技术人员，例如同事)中分发该工具，那么什么编程语言将是最实用/可行/有趣的选择？

当然你可以从很多角度来看这个问题。让我们专注于构建和分发工具。然后，这些是我“应该有的”要求:

*   应该可以将工具作为“开箱即用”的单个可执行文件分发，这意味着用户不必安装诸如运行时、框架、库等依赖项。
*   使用相同的代码库(但可能是不同的工具链)，应该可以为多个平台生成构建。

#### 语言选择

我想为这个特定的实验创建一个二进制文件，这就是为什么我没有考虑像 Node.js、Ruby 和 Python 这样的解释语言用于这个特定的工具。当然，一般来说，这些语言都是编写跨平台命令行工具的非常可行的选择。

这些语言还有一个缺点，那就是最终用户需要安装一个运行时(例如 Node.js)。尽管许多平台预装了通用运行时，但用户可能需要安装不同的版本。对于非技术用户来说，这并不总是一个微不足道的任务。

*(我知道有工具可以将解释语言编译成独立的可执行文件，但这里感觉有点像作弊)*。

最终我的选择是用 **C** 、 **Go** 和 **Swift** 做实验。

我决定呆在我的“编程语言舒适区”，因为学习一门新语言不是我实验的一部分。因此，我没有尝试(在我看来)非常有趣的其他语言，比如 **Rust** ，我将在未来尝试(请随意留下您对 Rust 体验的评论)。也许还值得注意的是:对于这个实验，我认为 **C++** 有些过头了(或者实际上也许，我的 C++知识很缺乏)。

#### 我学到了什么

#### **C**

*   通常，用 C 构建的可执行文件是动态链接的。这意味着最终用户需要安装依赖项(链接库)才能运行该工具。那肯定不理想。
*   有一些方法可以解决这个问题，但是这些方法都有一些缺点:
*   **静态链接:**创建一个二进制文件，保存所有需要的二进制代码。但是，这要求您使用的所有库(例如 TOTP 库)都支持静态链接。情况肯定不总是这样。此外，苹果[不支持 Mac OS X](https://developer.apple.com/library/archive/qa/qa1118/_index.html) 上的静态链接二进制文件。
*   **用您的应用程序分发链接的动态库**。这意味着，对于每个目标操作系统，你必须预先构建所有的链接库，确保这些库可以被可执行文件找到(例如，在 macOS 上更改 rpath)，并将它们与应用程序捆绑在一起。换句话说，你需要编译和捆绑。dll (Windows)，。dylib (macOS)或者。所以(Linux)文件用你的 app。
*   c 没有需要与应用程序捆绑在一起的运行时。因此，生成的可执行文件非常小。唯一的依赖项(动态库)是 C 标准库 libc，默认情况下，它在我想要定位的操作系统上是可用的。
*   在不同的平台上构建单一的 C 代码库可能是一件痛苦的事情。我通常更喜欢使用“默认的”，或者最广泛支持的平台构建链。在我看来，那就是 Windows 上的 Visual Studio，Mac 上的 Xcode(或者 Mac 命令行上的 GCC)和 Linux 上的 GCC。但是这意味着对于每个平台，您需要安装和设置一个完全不同的构建环境(项目文件、构建脚本等)。
*   从源代码中为多个平台编译依赖项是很困难的。就像我上面提到的，在不同的平台上为你的*自己的*代码建立构建链已经很困难了。为多个平台从源代码编译*第三方*库甚至更难。有些相对容易跨平台工作，但其他的确实很麻烦，因为它们缺乏对跨平台构建的支持或文档。

**出发**

*   默认情况下，Golang 构建的可执行文件是静态链接的。这意味着用户不需要安装任何依赖项，也不需要在应用程序中分发动态库。对于小型命令行应用程序，您唯一需要分发的就是可执行文件。
*   不幸的是，由于静态链接，[产生的可执行文件相对较大](https://golang.org/doc/faq#Why_is_my_trivial_program_such_a_large_binary)。这是因为 Go 二进制文件包含 Go 运行时，所以最终用户不需要安装 Go。(但是，正如 [Dotan Nahum](https://medium.com/u/333bfa9d9c3) 指出的那样，[有办法减掉一些脂肪](https://hackernoon.com/a-story-of-a-fat-go-binary-20edc6549b97)
*   Go 在我感兴趣的所有目标平台上都可以作为二进制发行版获得。这使得建立一个构建环境和在这些平台上构建变得轻而易举。
*   Go 的一个伟大之处在于，你可以在一台机器上轻松地为多个平台编译。

雨燕

*   建议静态链接到 Swift 标准库，以便生成的可执行文件不会绑定到构建该文件的特定 Swift 版本。这会产生一个很大的二进制文件(对于一个简单的工具来说超过 10 MB)。需要静态链接是因为 [Swift 缺乏 ABI 稳定性](https://developerinsider.co/what-will-be-new-in-swift-5/)。不过，这是在未来 Swift 版本中要解决的路线图。(顺便说一下，相比之下，Objective-C 确实具有 ABI 稳定性)。
*   跨平台支持尚未成熟。你可以在 Mac 和 Linux 上编译 Swift 程序(目前还没有正式的 Windows 版本)，但跨平台的构建系统——[Swift Package Manager(SPM](https://swift.org/package-manager/))——远不如 MacOS 上的 Xcode 成熟。此外，CocoaPods 或 Carthage(仅限 MacOS)上的许多库还不支持 SPM(跨平台)。

#### 结论

说到构建跨平台和分发工具， **Go** 给了我最好的开发者体验。

由于默认的静态链接，很容易创建一个单独的可执行文件进行分发。

在不同平台上构建围棋程序也非常容易。不需要编写特定于平台的构建脚本，或者使用依赖于平台的工具链。

缺点是产生的可执行文件相对较大(几兆字节)，但在我的情况下，这不是一个真正的问题。

接下来是 **C** 。由于没有运行时的约束，用 C 编写总是给我一种愉快的控制感和自由感。当然，这样做的缺点是你很容易搬起石头砸自己的脚。但是这里最大的问题是没有一个工具链可以像 Go 一样完美的跨平台运行。

最后，**雨燕**。虽然我真的很喜欢 Swift 这种语言，但在为 macOS 编写命令行工具时，我只会认为 Swift 是显而易见的选择。斯威夫特对我来说是太多的[【移动目标】](https://www.altexsoft.com/blog/engineering/the-good-and-the-bad-of-swift-programming-language/#tt16)。这有几个含义，其中一个重要的含义是，在其他平台上使用 Swift 并不简单。对我来说，另一个问题是 Windows 还没有得到官方支持。

最后一点:我想分享我的经验，但最终，哪种语言最适合你取决于个人偏好和语言的现状。明年可能会有所不同。