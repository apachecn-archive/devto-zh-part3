# 模板引擎的真相第 2 部分

> 原文：<https://dev.to/cocoroutine/truth-about-template-engines-part-2-nf6>

## 我的背景

这是我关于模板引擎的文章的第 2 部分。特别是今天，我写的是关于小胡子的规范。

我有什么资格评判模板引擎？我为财富 500 强公司写过网页和电子邮件模板。其中一些是大而复杂的订单确认和机票预订，充满了漂亮的、不可读的业务逻辑。

## 输入小胡子

当没有逻辑的小胡子出现的时候。它做了一些惊人的事情；那就是让其他程序员接受它并用他们选择的语言重写它。POODR 的作者 Sandi Metz 说“如果你的设计很好，那么其他人会想要复制它”。我认为这是适用的。小胡子真的说到点子上了，少逻辑真的很有意义。

除了小胡子不是没有逻辑的。它包含条件逻辑和循环逻辑。我会说它是一种最小逻辑模板语言。你也可以通过把 lambdas 嵌入到你的数据 is 中来成为全逻辑。如果您认为向 json 数据中添加可调用函数听起来是个坏主意，那么它确实是个坏主意。

小胡子并不完美。事实上，如果是的话，它将是下载最多的 JavaScript 模板库。这不是，车把才是。证明逻辑还是王道。

在下面，我将概述一些我认为需要改进的规范部分。

## 符号里有什么？

小胡子的符号及其定义的快速纲要。

| 标志 | 意义 |
| --- | --- |
| `{{ }}` | 定界符 |
| # | 开始部分 |
| / | 端截面 |
| ^ | 倒置截面 |
| > | 部分的 |
| & | unescape，安全内容 |
| ！ | 评论 |
| 。 | 当前节点运算符？ |
| < | 建议的布局运算符 |

只是在现实生活中，有时选择正确的词语会大有帮助。很明显，符号的选择及其含义受到了 JavaScript 的影响。然而，与其他语言相比，它可能会引起一些混乱。

*   # '在许多脚本语言中是一个注释
*   '!'在许多语言中都是否定
*   '.'规范中没有提到，但指的是当前变量？
*   >“vs”

这些符号比真正的单词更好吗？对于任何非程序员来说，乍一看这些符号会使阅读模板变得更糟。与此相比:

```
 {{if section }}

{{not section }}

{{each item }} 
```

## 真假

Mustache 的一个租户是它的目标是语言不可知论者。这是以语言实现之间的清晰性为代价的。

下面的小胡子模板将会根据不同的语言呈现不同的效果。

```
Template:

Shown.
{{#person}}
  Never shown!
{{/person}}

Hash:

{
    "person": false  // or '', 0, "0", [], {}
} 
```

下面是脚本语言中一些不同真值评估的简要表格。

| 语言 | '' | Zero | "0" | {} |
| --- | --- | --- | --- | --- |
| 服务器端编程语言（Professional Hypertext Preprocessor 的缩写） | 错误的 | 错误的 | 错误的 | 真实的 |
| Java Script 语言 | 错误的 | 错误的 | 真实的 | 真实的 |
| 计算机编程语言 | 错误的 | 错误的 | 真实的 | 错误的 |
| 红宝石 | 真实的 | 真实的 | 真实的 | 真实的 |

在我看来，规范中的这种可变性是它的弱点之一。从商业角度来看，除了让开发人员更容易实现该规范之外，它没有任何意义。模板引擎开发人员不应该是模板语言的目标受众。

我知道其他人已就此事发表了意见，社会似乎存在分歧。然而，考虑一下这个对话。“如果我们迁移到一个新的后端，我们的客户可能会因为 Mustache 的设计方式而在他们的模板中看到错误”。试着把这个卖给你的经理。

这似乎不是问题，因为您不太可能在不同语言之间转移模板。然而，当你选择一个非程序员使用的模板引擎时，像这样的东西会咬你一口。后端重写也会发生。

几乎任何标准化都比完全没有标准化要好。只是认为将模板块的评估与语言内部的真值表联系起来是没有意义的。毕竟这可能是我想要显示 0 个项目可用的情况。

根据我的专业经验，在呈现一个条件块时，明确一点总是比较安全的。在其他模板语言中不存在等价的问题，因为你总是可以做一个' == '比较。这是明确的。

问题的出现是因为 Mustache 的目标是无逻辑的，这与一些模板块用例不匹配。使用 Python 的一切都是假的模型已经足够好了。只是请不要 PHP。

## 空白

空白是神圣的。我对模板语言最大的不满之一是它们总是破坏空白。空白是不明确的。小胡子规范在空白方面也很宽松。考虑下面的小胡子代码:

这是变量还是节？

`{{ #person }}`

一些开发人员通过要求胡子是连续的来解决这种模糊性，例如`{{#person}}`。但是，请考虑以下情况:

什么比较好读？

```
{{name}} vs {{ name }}

{{#person}} vs {{# person }} 
```

在一个完美的世界里，空白通常应该被保留。这很难实现，因为空白本质上是模糊的。

如果这个`{{variable}}`为空，是否应该保留间距？是一个还是两个空格？

空节中的前置、后置和嵌套换行符怎么样？也是缩进？事情变得复杂了。

```
 {{#mysection}}
              {{nested}}
         {{/mysection}} 
```

所有这些场景的规范都不清楚。一些实现限制了间距，而另一些则没有。保留空白也是一样。这个结果在实现中有太多的可变性。这可以用一个更清晰的规范来澄清。

## 模板继承

最受欢迎的特性之一是模板继承。这是当您拥有其他模板可以继承的基本布局时。例如，带有页眉、页脚和其他模板的布局可以呈现正文内容；或者，他们可以覆盖父布局的某些部分。

我的答案是不。只是不。这是一个很好的，也许应该是一个可选的规格。然而小胡子不需要这个。我不认为这是无逻辑的概念。部分已经足够好了。他们本身就是有点太多的逻辑。

## 小胡子 2.0 愿望清单

有什么比没有逻辑更好的？更少逻辑！我对 Mustache 2.0 的愿望清单不包括实现任何新功能。

*   移除 lambdas 功能
*   删除设置传送者功能
*   标准化真实性
*   标准化空白规则
*   没有模板继承

小胡子 2.0 完成了

不要误解我。我是小胡子的超级粉丝。然而，就像编写代码一样，我们可以通过重构来使它变得更好。