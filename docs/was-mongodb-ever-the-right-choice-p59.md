# MongoDB 曾经是正确的选择吗？

> 原文：<https://dev.to/simple_thread/was-mongodb-ever-the-right-choice-p59>

我最近在读一篇关于红帽从卫星上移除 MongoDB 支持的帖子(是的，有些人说是因为许可证的变化)。这让我想到在过去的几年里，我经常看到[发](http://www.sarahmei.com/blog/2013/11/11/why-you-should-never-use-mongodb/)后[发](http://cryto.net/~joepie91/blog/2015/07/19/why-you-should-never-ever-ever-use-mongodb/)愤怒的帖子，说 MongoDB 有多可怕，以及没有人应该使用它。然而，在这段时间里，MongoDB 已经成为一个更加成熟的产品。发生了什么事？所有的憎恨真的来自 MongoDB 早期实现/营销中的错误吗？或者，问题是人们在评估 MongoDB 是否适合时，将自己的努力不足归咎于 MongoDB？

如果你发现自己在这一点上口吐白沫，因为我似乎在捍卫 MongoDB，请跳到这篇文章的结尾，阅读我的免责声明。

## 趋势预测

在这一点上，我从事软件工作的时间比我愿意承认的要长，但即使在那时，我也只经历了冲击我们行业的一小部分趋势。我见证了 4GL、AOP、敏捷、SOA、Web 2.0、AJAX、区块链的兴衰……这个清单永远不会结束。每年都有新的趋势出现在软件工程领域。有些很快就失败了，而另一些则从根本上改变了软件开发的方式。

随着任何新的创新开始获得牵引力，你会看到人们开始蜂拥而至，或者看到其他人发出的嗡嗡声，并决定他们也想参与进来。这一过程由 Gartner 用其[炒作周期](https://en.wikipedia.org/wiki/Hype_cycle)进行了整理，这(尽管有争议)是最终被发现有价值的技术的大致情况。

但是每隔一段时间，一个新的创新就会出现(或者在这种情况下再次出现),它是由该创新的一个特定实现所驱动的。就 NoSQL 运动而言，它主要是由 MongoDB 的出现和迅速崛起推动的。MongoDB 并没有发起这场运动，真正推动回归非关系数据库的是大型互联网公司面临的数据挑战。像谷歌的 Bigtable 和脸书的 Cassandra 这样的项目启动了它，但 MongoDB 是大多数开发人员都可以访问的 NoSQL 数据库的最可见和最易访问的实现。

旁白:您现在可能会想，我把文档数据库与列数据库、键/值存储或任何其他属于通用 NoSQL 的数据存储类型混为一谈了。你是对的。但这在当时正疯狂地发生。每个人都投入到对 NoSQL 的狂热中，他们知道他们绝对需要 NoSQL，但并不真正了解所涉及的不同技术。对许多人来说，MongoDB **就是** NoSQL。

开发商抓住了这个机会。无模式数据库可以神奇地伸缩以应对任何挑战的想法非常有吸引力。大约在 2014 年左右，你看到的任何地方似乎都有人在实施 MongoDB，而就在一年前，人们还在使用 MySQL、Postgres 或 SQL Server 等关系数据库。当被问及为什么使用 Mongo 时，得到的回答从老生常谈的“这是 web 规模的”到更有思想的“我的数据结构非常松散，非常适合无模式数据库”。

重要的是要记住，MongoDB 和一般的文档数据库解决了人们在使用传统关系数据库时遇到的许多问题:

**严格的模式**–对于关系数据库，如果你有动态的数据，你不得不创建一堆随机的“杂项”数据列，将数据作为一个数据块塞进去，或者使用 [EAV](https://en.wikipedia.org/wiki/Entity%E2%80%93attribute%E2%80%93value_model) 设置…所有这些都有明显的缺点。

**难以扩展**–对于关系数据库，如果您的数据太大，以至于您无法轻松地将其放入一台服务器，MongoDB 内置了允许您跨多台机器扩展数据的机制。

**困难的模式修改**–没有迁移！对于关系数据库，改变数据库的结构可能是一个巨大的挑战(尤其是当数据变得非常大的时候)。MongoDB 承诺让这变得更加简单。它让开始变得如此容易，你可以不断更新你的模式，然后非常快速地移动。

**写性能**–MongoDB 的性能很好，尤其是在以某些方式配置时。MongoDB 的开箱即用的写配置，这是它被批评的一大原因，使它能够提供一些令人印象深刻的性能数据。

## 概不退换

MongoDB 提供的潜在好处是巨大的，特别是对于面临某些问题的人。在没有背景或经验的情况下阅读上面的列表，会让您相信它确实是数据库系统的游戏规则改变者。唯一的问题是上面列出的好处伴随着许多警告，我在下面列出了其中的一些。

公平地说，在 10gen/MongoDB Inc .没有人会声称下面的项目是不真实的，它们只是权衡。

**事务丢失**–事务是许多关系数据库的核心特性(不，不是全部，而是大部分)。拥有事务意味着您可以自动执行多个操作，并且可以确保数据保持一致。当然，使用 NoSQL 数据库，您可以在单个文档中处理一个事务，也可以使用两阶段提交这样的策略来获得类似事务的语义。但关键是你必须自己做这项工作…而且做好这项工作可能会很有挑战性，而且需要大量的人力。通常，直到您开始看到数据库中的数据由于无法保证操作的原子性而进入无效状态时，您才会意识到您放弃了多少。

**失去关系完整性(外键)**–如果您的数据有关系，那么您将会有关系。几乎所有的数据都有某种关系，如果您的数据库不强制它们，那么您的应用程序将不得不这样做。让数据库实施这些关系可以减轻应用程序的大量工作，因此也减轻了工程师的工作量。

缺乏强制实施数据结构的能力–强模式有时可能令人头疼，但它们也是确保数据结构良好的强大机制。如果您恰当地利用它们，它会提供一个强大的机制来确保您的数据符合您的预期。像 MongoDB 这样的文档数据库在模式方面提供了令人难以置信的灵活性，但是这种灵活性将保持数据整洁的责任推卸给了维护者。如果您不付出努力，那么您最终会将大量代码放入您的应用程序中，以处理可能不符合您预期的数据。就像我们经常在简单线程上说的……你的应用程序有一天会被重写，你的数据会永远存在。

**自定义查询语言/工具生态系统的丧失**–SQL 问世的时候绝对是一场革命，从那以后什么都没有改变。SQL 是一种非常强大的语言，但也很有挑战性。对于熟悉 SQL 的人来说，使用由 JSON 片段组成的定制查询语言来查询数据库会被认为是一大退步。有很多工具可以与 SQL 数据库进行互操作。从 ide 到报告工具。转移到不支持 SQL 的数据库意味着你不能使用这些工具中的大部分，或者你必须找到一种方法将你的数据放入 SQL 数据库以便这些工具可以使用，而这可能比你想象的更难。

许多使用 MongoDB 的开发人员并没有深刻理解他们所做的权衡，他们经常一头扎进去，将它作为应用程序的主要数据存储。这意味着收回这个决定的代价通常是难以置信的。

## 有哪些可以做得不同的地方？

不是每个人都一头扎进去，一头扎进深水区的底部。但是已经足够了，未来几年还会有项目将 MongoDB 从它不适合的地方移除。如果这些组织中的许多组织花一点时间系统地思考他们正在做出的技术选择，很可能他们中的许多人就不会做出他们所做的决定。

那么，您如何决定什么技术对您的用例有意义呢？已经有一些创建评估技术的系统框架的尝试，例如“[一个软件组织中技术引入的框架](http://www.wohlin.eu/spi96.pdf)”和“[一个评估软件技术的框架](https://pdfs.semanticscholar.org/4268/30dd5dd944d3b75ec56b2a3b151c18afbaf9.pdf)”，但是我不认为它需要那么复杂。

许多技术只需问两个主要问题就能得到合理的评估，但挑战在于找到能够负责任地回答这些问题的人，花时间回答这些问题，并且不带偏见地回答这些问题。

> 如果你没有面临某种问题，你不需要新的工具。句号。

## 问题 1:我在努力解决什么问题？

如果你没有面临某种问题，你不需要新的工具。句号。不要寻找解决方案，然后又回到问题中。如果你没有面临一个新技术不能比你现有的技术更好解决的问题，那么你的决定就结束了。如果您因为已经看到其他人在使用这项技术而考虑使用它，那么思考他们面临什么问题，并问问自己是否面临同样的问题可能会有所帮助。因为你看到另一家公司在使用某项技术，所以接触这项技术往往很容易，困难的是确定你是否面临同样的挑战。

## 问题二:我放弃了什么？

这肯定是两个问题中较难回答的一个，因为你必须钻研并充分理解旧技术和新技术。有时候，你无法真正理解一项新技术，除非你已经用它做了一些东西，或者接触到花了大量时间研究这项技术的人。

如果你两者都没有，那么你应该考虑你能做的最小投资是什么来决定这个工具是否有价值。如果你投资了，撤销决定会有多难？

## 人类总是把事情搞砸

你必须记住的一件事是，当你试图尽可能不带偏见地回答这些问题时，你将与人类的本性作斗争。为了有效地评估一项技术，必须克服许多认知偏差，这里仅举几个例子:

[**跟风效应**](https://en.wikipedia.org/wiki/Bandwagon_effect)——这一点大家都知道，但还是很难对抗。只要确保你选择一项技术是因为它能解决你的真正需求，而不是因为酷小孩在做它。

——许多软件开发人员倾向于低估他们已经工作了很长时间的技术，而高估一项新技术的好处。这不是软件工程师特有的，每个人都有这样的倾向。

[**特征——正面效应**](https://pigeon.psy.tufts.edu/avc/dittrich/fepef.htm)——我们倾向于看到现在的东西，而忽略不存在的东西。当与“纯粹的新奇偏见”一起工作时，这可能会造成严重破坏，因为你不仅内在地赋予新技术更多的价值，而且还忽略了新技术的差距。

客观地看待事物是一个挑战，但了解可能影响你的偏见将有助于你做出更理性的决定。

## 总结起来

当一项新的创新出现(或再次出现)时，我们需要非常小心地回答两个问题:

*   这个工具为我们解决了一个真正的问题吗？
*   我们是否彻底理解了权衡？

如果你不能自信地回答这两个问题，后退几步，重新评估。

那么 MongoDB 曾经是正确的选择吗？是的，当然是；像工程中的大多数事情一样，这要视情况而定。对于回答了这两个问题的团队来说，许多人在 MongoDB 中发现了价值，并继续发现价值。对于那些没有这样做的人来说，希望他们学到了有价值的，不太痛苦的关于如何驾驭炒作周期的一课。

## 免责声明

我想澄清一下，我对 MongoDB 既不爱也不恨。我只是没有遇到很多我认为它最适合的问题。我知道 10gen/MongoDB Inc .一开始并没有通过设置不安全的缺省值和到处宣传 MongoDB(特别是在黑客马拉松上)作为所有数据需求的终极解决方案来为自己做任何事情。是的，这些可能是错误的决定，但我认为它支持了我在这里提出的观点，因为这些问题可以很快被发现，即使是对技术进行粗略的评估。

MongoDB 曾经是正确的选择吗？最早出现在[的简单螺纹](https://www.simplethread.com)上。