# 将绿地项目变成棕色地块项目

> 原文：<https://dev.to/mikulskibartosz/turning-greenfield-projects-into-brownfields-projects-4dlh>

我们都知道没有什么比绿地项目更好的了。当我们开始一个新项目时会发生什么？
有希望。有远大的梦想和新的想法。现在，是我们的时代了！现在，我们可以写出公司有史以来最好的代码！现在，我们可以证明提前三个月完成一个项目是可能的！

项目六个月后是什么样子？我们还这么热情吗？一切都还是崭新的酷吗？这不再是一个全新的项目了，是吗？不好的东西不是到处都有，但是有我们不想碰的地方。有些代码我们不说。发生了什么事？

坏代码的创建方式与好代码相同，一次一行。有什么不同？

# 软件架构

软件架构怎么了？不知何故，我们开始假装不再需要它。建筑不再酷了。如今，当有人提到软件架构时，人们会想到由架构师制作的丑陋的 UML 图。
建筑师，我们讨厌的人。那些坐在象牙塔里的人。那些不再编码的人。
我们不想和他们一样。我们不做“软件架构”

很明显，我们没有正确的理由去做。我们很敏捷。敏捷中没有软件架构的位置。是的，当然…不要让我开始数据模型设计。

事实是，我们总是有一些架构。如果我们不是故意制造出来的，那将是我们随机决策的结果。

我们不需要创建 UML 图的繁琐过程。我们不需要建筑师的监督。我们只需要一张纸和一支笔。

我们可以边吃午饭边在餐巾纸上设计我们软件的架构。如果我们不喜欢这个结果，我们会扔掉它，重新开始。当我们只需要扔掉一张纸时，改变决定就容易多了。当我们需要删除 60%的代码时，改变我们的想法变得很困难。

随机产生的建筑是唯一的问题吗？我们应该在开始实现代码之前规划架构，以清楚地定义我们的意图。在我们编写一行新的产品代码之前，我们必须知道代码将会是什么样子，以及它将如何表现。光有建筑是不够的。我们也需要测试。

# 测试驱动开发

第二个让美丽的绿地项目变成可怕的棕色地块噩梦的问题是“颠倒测试”

许多程序员编写测试只是因为他们被期望这样做。他们不相信自动测试。正因为如此，测试是在实现之后产生的(查看我的关于 TDD 拖慢你速度的 4 个原因的博客文章)。

我们经常会听到:“我完成了这个任务。现在我只需要写测试，我们就可以关票了。”？每次我们听到这样的声明，我们都知道结果将是巨大的。生产代码会很复杂，有两位数的圈复杂度。在测试代码中，我们会看到很多很多的模拟，但是测试功能却少得惊人。只要一两个测试就能验证一切。

在实践 TDD 时不可能产生如此难看的代码。说真的。试试看，我谅你也不敢。按照“红绿重构”的步骤，写一个有 14 个模拟依赖项的函数。你做不到。写这么糟糕的代码会对你的身体造成伤害。就像看着它一样疼。

TDD 的敌人声称它只是一个玩具练习。它适用于一些编程形练习，但在“真实世界”中没有它的位置我以前也相信这一点。在一个项目中，我看到如果我们“信任过程”，我们所有的代码开始看起来像一系列小的、简单的编程动作的结果。

我知道有人会声称以任何方式(TDD、测试优先、测试最后、有时间时测试等)编写任何测试(单元测试、集成测试、用例测试)。)不足以避免所有错误，何必呢？嗯，避孕套也不是 100%防错的，但人们还是会用，不是吗？

# 重构

当我们想恐吓项目经理时，我们应该说什么？重构。这让他们感到害怕，因为他们知道，不停止这个世界，我们就做不到。他们知道我们可能会清理一些代码，但我们也会产生更多的 bug。

这怎么可能呢？重构应该是改变代码结构而不改变其行为。我们有测试，我们可以在每次更改后运行它们，验证我们是否有 bug。

这个假设有两个问题。首先，我们不相信我们的测试。我们在生产代码创建后编写它们。我们知道有一些未经测试的路径。

第二个原因是我们必须同时改变我们的产品代码和测试代码。没有其他选择。当生产代码准备好时，我们编写测试。我们需要摆弄他们，让他们通过。我们的测试代码与产品代码的实现细节相结合。

如果我们遵循 TDD，这就不会发生。我们的产品代码应该像我们测试的插件一样。我们应该能够改变插件。只要新的实现按预期运行，测试仍然会通过。如果我们实现了这种程度的解耦，我们可以在任何时候重构产品代码，并且仍然确保整个应用程序的行为不会改变。

> ![Bartosz Mikulski profile image](img/959f03387d803bcc3146867f54fd4636.png)巴托什米库尔斯基[@米库尔斯基巴托什](https://dev.to/mikulskibartosz)![twitter logo](img/65e26e35707d96169ec8af6b3cbf2003.png)又名:【考前】[twitter.com/viktorklang/st…](https://t.co/pPO75223pf)19:59PM-01 2018 年 11 月Lgd。viktor Klang@ viktor Klang最喜欢的 API 设计技巧:首先勾画出你希望能够编写的代码，然后看看你是否能以这种方式实现它。[![Twitter reply action](img/e5d6036ea29f7fc2ceecadd7806ec22d.png)](https://twitter.com/intent/tweet?in_reply_to=1058086271011209218)[![Twitter retweet action](img/045a8cb35300a0b869b6787434707687.png)](https://twitter.com/intent/retweet?tweet_id=1058086271011209218)2[![Twitter like action](img/1bf915c7b46baf6310d9eb9b48e72a89.png)](https://twitter.com/intent/like?tweet_id=1058086271011209218)1

我们关心测试吗，或者它们只是必要的邪恶？我们在代码审查期间审查测试吗？在审查拉取请求时，我们在测试中滚动了多少次？

当我们不遵循 TDD 时，测试就成了二等公民。这绝不应该发生。在测试中，我们不仅可以定义预期的行为，还可以描述我们想要的 API。测试向我们展示了代码将如何被使用。如果我们遵循 TDD 实践，代码设计发生在编写测试时，而不是在我们实现产品代码时。

# 所有权

下一个问题是缺乏所有权。谁应该解决问题？找到它的人？最后促成这个失败项目的人？受问题影响最大的人？

当我们谈论一个 bug 时，可能很容易做出决定。如果代码质量是问题所在呢？当我们看到一个 1000 行长的文件，并且我们刚刚向它添加了另一行时，会发生什么？我们发现了问题。我们是文件的最后贡献者。我们受到这个问题的影响。为新代码行找到合适的位置并不容易，是吗？

我们解决问题了吗？我们是否忽略了这个问题，并通过说有 n 行代码，我们添加了第 n+1 行，这不是我们的问题来证明我们的决定？混乱已经存在。我们甚至会抱怨它，而不做任何其他事情。

向已经一团糟的文件中添加新代码的小错误会被另一个人、另一个人、再一个人重复。两周后，我们有了 1000 行代码。

如果你需要一些关于软件工程中所有权的提示，可以看看我的文章:[极端所有权和软件工程](https://mikulskibartosz.name/extreme-ownership-and-software-engineering-ef5bbc95f248)

# 队友

这个观察引导我们到最后一个问题。谁把绿地项目变成了棕色地块的怪物？人们。

我们可以抱怨不想学新东西的队友。我们可能会抱怨说，他们中的一些人每天工作 2 个小时，接下来的 6 个小时只是假装工作。我们可能每次看到复制/粘贴的代码都会尖叫。我们可能会做许多其他事情，但没有一件会改变什么。

我们不能改变人。我们不能说服他们做他们不想做的事。影响他人的唯一方法是以身作则，因为你唯一能改变的人就是你自己。你是唯一一个能阻止一个了不起的项目变成烂泥的人。

* * *

本文转自我的个人博客:[https://mikulskibartosz . name/turning-green field-projects-into-brown fields-projects-5028 a2 c 90 c](https://mikulskibartosz.name/turning-greenfield-projects-into-brownfields-projects-5028a2c90c)