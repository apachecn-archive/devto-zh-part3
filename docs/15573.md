# C 语言中的小模式和习惯用法

> 原文:[https://dev . to/Noah 11012/small-patterns-and-习语-in-c-47d1](https://dev.to/noah11012/small-patterns-and-idioms-in-c-47d1)

模式是程序员用来解决一般重复出现的问题的结构。如果一个问题偏离了原来的模式，那么这个模式可以被修改以仍然有效。在本文中，我们将学习 C 编程语言中的一些技巧，我相信初学者和中间用户应该知道并开始尽可能地应用它们。

## [](#1-dowhile-loop-in-macros)1。宏中的 Do-While 循环

如果你需要使用一个临时变量来存储一个很快就会在宏中使用的值，那么它将会“泄漏”到使用它的局部范围。用户将不再能够重用变量名，如果他们这样做，编译器将抱怨“重定义”。一些程序员通过给一个别人不会使用的名字来解决这个问题。通常，这是一个前缀/后缀在变量名上的散列。在我看来，更好的方法是使用 do-while 循环。当循环超出范围时，变量也会超出范围，因此没有“泄漏”。即使`while`的条件为假，do-while 循环也总是至少运行一次。

示例:

```
#include <stdio.h> 
#define swap(type, a, b)  \  
    do                    \  
    {                     \  
        type temp = *b;   \  
        *b = *a;          \  
        *a = temp;        \  
    } while(0)            \  

int main()  
{  
    int a = 100;  
    int b = 200;  

    swap(int, &a, &b);  

    printf("Swapped values:\na = %d, b = %d\n", a, b);
} 
```

## [](#2-unions-and-enums)2。联合和枚举

在我们继续之前，让我们确保我们所有人都明白什么是工会。联合就像一个结构，但是有一个规定:一次只能使用一个成员。您可以将联合视为根据我们想要存储的值的类型而变化的类型。在编译器/解释器中处理标记时，可以找到使用联合的示例。一些标记可以是整数、字符或字符串。完美的结合场所。但是有一个问题:工会没有给我们目前使用的是什么类型的信息。这就是`enum` s 的用武之地。一个`enum`或枚举是映射到一个数字的名称列表。默认情况下，第一个成员等于零，后续值为 1 加上前一个值。枚举的用途之一是列出可能的值。在我们的例子中，这是我们可以接受的可能记号的列表。

例子:

```
typedef enum  
{              
    INT,  
    CHAR,  
    STRING  
} TokenType;  

typedef struct  
{          
    TokenType type;  
    union  
    {          
        int  int_value; 
        char char_value;  
        char *string_value;
    } value;
} Token; 
```

每当我们遇到一个令牌，我们就判断出它是什么类型，将`type`设置为适当的值，并在`value`中设置正确的成员。当编译器/解释器返回到这个令牌列表来形成 AST 或它需要做的任何事情时，它可以查看`type`并进行正确的操作。

## [](#conclusion)结论

程序员可以利用语言的杠杆作用来解决不时出现的问题。有时我们会看到两个特性成对出现，就像上一个条目一样。

目前，这是一个独立的帖子，但在未来，或近或远，可能是一个系列。