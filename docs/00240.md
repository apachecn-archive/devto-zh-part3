# 雨果可能不适合你

> 原文:[https://dev.to/yawpitch/hugo-probably-isn-t-for-you-5e57](https://dev.to/yawpitch/hugo-probably-isn-t-for-you-5e57)

## [](#yes-its-quick-enough-to-break-your-neck)没错，快得可以扭断脖子

正如谚语盒子上所说的那样，[雨果](https://gohugo.io)静态站点生成器是*快速*。在 [Go](https://golang.org) 中写道，雨果承诺*极速*它肯定会交付，我已经得到了证明这一点所需的所有红肿、疼痛和灼痛感。

当我在 Markdown 中使用 Vim 写这篇文章时，我所要做的就是保存文件，我在后台运行的`hugo --server`进程将会呈现为 HTML，并在我能看到它时更新我的浏览器窗口。几乎即时的反馈，即使我对多个帖子做了重大修改。毫无疑问，Hugo 是*快速的*，并且*一旦你开始运行*，你的网站将会从这种速度中获益，*尤其是*当你已经建立了一个重要的内容目录时。

### [](#but)但是……

> 准备飞船以可笑的速度前进！
> 
> 桑德斯上校

有一种观点认为*快*不一定*高效*，在准备不足的情况下，它往往是致命的。为了让你能读到这篇文章，我需要做的*比[快速入门](https://gohugo.io/getting-started/quick-start/)教程所暗示的要多得多*，甚至要做*我不得不学习的*也比我最初准备的要多得多。几个月来，雨果以极快的速度带给我的唯一一件事就是剧烈的头痛。公平地说，这并不完全是 Hugo 的错——我犯了几次错误，都是基于我的渴望，而不是我既定的需求——但我让我对速度和一些令人兴奋的营销文案的渴望从一开始就绊倒了我。也就是说这几个月我大部分时间都在脸上，甚至更糟。在那段时间里，Hugo 真正帮助我的是*失败*非常快；它经常做阻碍我的事情。

坦率地说，这是一次痛苦的旅程。祈祷你不要重复它。继续读下去，也许你不会。

### [](#a-bit-of-background)有点背景

我是一名经验丰富的程序员，但我绝对不是一名 *web* 程序员。在最终决定在[建立我的个人网站](https://www.yawpitchroll.com)作为我的技术思考之家之前，我只是偶尔用 Tumblr 这样的所见即所得工具写博客。从专业上来说，我主要为视觉特效行业编写后端和过程自动化代码，所以说我已经开发了普通野生长臂猿的 UX/UI 设计印章是仁慈的。我上一次真正体验 HTML/CSS 是在《漫威电影宇宙》之前，从那以后就有了一些情节发展。

所以我在网站开发方面没有太多的经验，但我也不寻求获得这种经验。我也没有需要移植的现有内容的大型备份目录，所以我基本上是一个希望相对快速地启动和运行的绿色博客作者。我只需要选择如何去做这件事。

我对那个选择并不天真；我知道我所做的任何选择都会涉及到一个学习曲线，我只是想让它稍微慢一点，比如说，拿起[矮人要塞](http://i.imgur.com/4AzYP.jpg)，所以我试着以批判的态度对待工具的选择。

#### [](#step-1-establish-key-criteria)第一步:建立关键标准

经过大量的离线研究，我最终缩小了我认为我想要的最小可行网站的范围:

*   我可以在免费的 CDN 服务层上托管一个静态站点，比如 Github Pages 或 Netlify
*   一个反应灵敏、移动优先的主题，带有语法高亮和易读的排版
*   现代标记实践；JSON-LD 结构化数据、OpenGraph 和语义 HTML5
*   合理的隐私做法；我生活在欧盟，所以我必须真诚地努力遵守 GPDR 协议
*   轻松分享到脸书、LinkedIn 和 Twitter，但没有不必要的跟踪
*   对帖子进行某种形式的评论，这样我就能收到我真诚希望的读者来信
*   注册邮件列表的最低能力；谷歌阅读器死后，很多人离开了 RSS
*   *快速*加载时间；我被 Tumblr 咬的*很惨*；谷歌的 AMP 页面*看起来*很理想
*   对可及性的得体点头；我越来越老，我有一些视力受损的朋友

现在，这九个标准可能看起来很多——事后看来，也许它们确实很多——但实际上它们可以归结为**可交付的**、**可发现的**和**可读的**，由于我的视觉需求是*非常简单的*，它们看起来不像是太多的要求。

当然，我会很快了解到其中一些有着自然的，甚至不可逾越的冲突——AMP 最终会被放弃，因为它使得评论和邮件列表注册变得不可行，并且社交分享和隐私并不完全一致——但是我有*希望*。

#### [](#step-2-assess-the-field)第二步:评估现场

像 Wordpress 这样的动态工具显然被我的第一个标准淘汰了，所以我开始了解静态站点生成器的选项，其中有[多个](https://myles.github.io/awesome-static-generators)。虽然我在研究中很早就遇到了雨果，但我真的不想在没有了解竞争对手的情况下就全力以赴，所以我暂时把它放在一边。

我试图通过消除用对我来说很陌生的语言编写的生成器来缩小范围。由于我对 Python 非常熟悉——远远超过我对 Go 的熟悉程度，或者说我从未打算过——我开始研究[鹈鹕](https://blog.getpelican.com/)、[尼古拉](https://getnikola.com/)和[海德](https://hyde.github.io/) <sup id="fnref1">[1](#fn1)</sup> 。在每一种情况下，很快就发现这些对我来说都不是正确的选择，因为没有一个看起来非常深入或广泛使用，我想要一些相对广泛采用的东西和一个社区来帮助我度过学习曲线。在我的第一语言中没有选项，但是我真的需要——或者想要——摆弄发电机的内部吗？如果工具*起作用了*，我就不需要这么做了，我想，尽管能够理解*它是如何起作用的会很好。另外，在一天结束时，我对速度的渴望部分源于对 Python 的多年等待，所以快速的警笛声把我引诱出了我的舒适区。*

当然，我也检查了由 Ruby 编写的 Github Pages 的第一个类成员 Jekyll。这是一个非常可靠的替代方案，已经完善到可以发布第三个主要版本了，有一个足够大的社区来要求一定程度的稳定性，而且看起来也足够友好。但是我对 Ruby 一点也不感兴趣，所以对至少要打开引擎盖一次的挥之不去的恐惧，再加上——所有人都说很明显——速度差异，让天平向 Hugo 倾斜。此外，杰克尔*觉得*老掉牙了，一些长期未解决的问题和主题展示在我看来就像一大堆猪和几颗珍珠。就连它自己的网站也显得陈旧而乏味，这更让人觉得它跟不上时代。

#### [](#step-3-embrace-confirmation-bias)第三步:拥抱确认偏差

相比之下，在我欣赏的技术博客中，Hugo 周围有明显的、翻腾的嗡嗡声，大量最近的提交历史，以及一些听起来绝对很酷的功能，如 [Hugo Pipes](https://gohugo.io/hugo-pipes/introduction) 。作为一个静态的、自我管理的博客的新手，我真的希望有什么东西可以把我从似乎淹没 web 开发世界的混乱的工具潮流中拯救出来 <sup id="fnref2">[2](#fn2)</sup> ，所以 Pipes 看起来像一个闪亮的大胜利。

并且，浏览了一下[主题浏览器](https://themes.gohugo.io)，有很高比例的选项看起来不错——如果不是*理想的*——对于极简主义的科技博客，我很明显*要*去*最后*已经启动并运行**了**。我很快找到了符合我的大部分功能标准的主题，以及其他一些似乎实现了一些缺失的主题。所以我可能需要弄清楚如何将一些元素，比如弗兰肯斯坦，从一个主题移植到另一个主题，但是模板语法*看起来*足够简单，似乎有很多[文档](https://gohugo.io/documentation/)，并且显然有很多活跃的[论坛](https://discourse.gohugo.io/)需要仔细研究。

因此，在对 CI 部署和托管选项等更乏味的话题进行了一些比较后，我们做出了决定。雨果是早期的竞争者，现在是雨果赢了！我很自信；我是一个新手博主，没什么大不了的——或者就此而言，也没什么大不了的——不需要担心导入问题……我所要做的就是选择一个主题，开始写我的第一篇文章，然后部署！我过几天就上去！说不定还要*小时*！

什么会出错？

### [](#it-doesnt-exactly-work-out-of-the-box)开箱即用并不完全有效

> 你永远没有第二次机会留下第一印象。
> 
> <cite>头&肩</cite>

也许是运气不好，也许是变革之风，最有可能是在阿南刻主题上犯了一个错误——谁知道呢？–但在决定命运的那一天，我第一次做了[快速入门](https://gohugo.io/getting-started/quick-start/)我迅速而顽强地一路跑到了关键时刻，气喘吁吁地跑着`hugo server -D`，然后，满怀期待地打开浏览器窗口，指向终端上方便显示的本地主机地址。在那里，我发现绝对 *bupkiss* 被服务。没有。带有空源文件的空白屏幕。回到我启动该命令的终端，那里有几个警告，但没有什么可以明显解释错误 <sup id="fnref3">[3](#fn3)</sup> 。

这是令人失望的。但是一天下来，我对使用阿南刻毫无兴趣，所以我决定用我已经收藏的一个更适合我的主题来尝试快速入门的其余部分。

…没用。下一个也没有。

后面的*三个*也没有。

#### [](#the-agony-of-teething)咬牙切齿的痛苦

Hugo 是一个开源项目；截至目前，其最新的[版本](https://github.com/gohugoio/hugo/releases)是 0.55。与 Jekyll 不同，它还没有发布 1.0 版本，因此没有承诺向后兼容性。这就是*精*。每个主题都是类似的开源工作，通常——尽管不总是——由一个开发者完成，这个开发者很可能也是唯一投资的消费者。事情就这样断了，*坏了*。在这样一个不成熟的项目中，这也许是意料之中的。

但是对于这些主题中的每一个，“官方”托管的主题演示似乎都工作得很好，这给了像我这样的 Hugo 新手一个印象，即开箱即用的功能主题比实际情况多得多。

那么是什么原因呢？事实证明，这是因为 hosted showcase 使用嵌入在每个提交的主题中的`exampleSite`目录，这在快速入门中甚至没有提到，而且*非常*通常主题中的模板依赖于配置，而这些配置根本不会出现在您的快速入门网站中。

最终，在*读了很多*旧论坛的帖子，浏览了很多早已过期的文档后，我发现下面的*通常*会给你一个本地主题演示，其行为大致与作者的意图相同:

```
mv config.toml config.toml.bak
cp -r themes/YOUR_THEME/exampleSite/* .
find . -maxdepth 1 -type f \( -name "config.toml" -or -name "config.yaml" -or -name "config.json" \) -print -quit | grep -q "." || cp config.toml.bak config.toml
cp themes/YOUR_THEME/archetypes/*.* ./archetypes/ 
```

第一行在主题的`exampleSite`目录的内容被复制到根目录之前备份默认的`config.toml`文件。我们需要移动`config.toml`，因为该文件如果存在，将优先于`config.yaml`，而 T3 又优先于`config.json`。没错，Hugo 在其短暂的生命周期中已经有了三种配置文件格式，这三种都是可行的选择，尽管出于某种原因 TOML 更胜一筹。因为其中任何一个*可能已经出现在主题中，我们将只在*没有一个*出现的情况下将备份移回原位。*

同样，最后一行用主题的`archetypes`目录中的所有文件覆盖了`archetypes/default.md`文件；这是因为目前 Hugo 将*总是*假设根`archetypes`目录中的`default.md`应该覆盖来自主题的任何*原型，不管它有多专业。最终的结果是，快速入门中提到的`hugo new posts/my-first-post.md`命令不会在帖子的[前题](https://gohugo.io/content-management/front-matter)中包含主题关键元素，经常会导致错误或遗漏内容。*

正如我所说的，上面的修正只会*通常*给你一个你选择的主题的工作示例。例如，阿南刻主题本身将需要进一步的步骤:

```
sed -i 's/gohugo-theme-ananke/ananke/' config.toml
sed -i 's/^themesDir/#themesDir/' config.toml 
```

这些都是必需的，因为快速入门指导让你在制作子模块时重命名主题目录，而且 **themesDir** 配置键显然是作为一个黑客设置的，以使主题更容易测试。

这类问题大多源自 Hugo 的*快速*进化中不同阶段的不同主题，其中许多都致力于不再是最佳实践的旧选择，或者现在正等待弃用<sup id="fnref4">T5 4T7】。一个主题系统树*要求*内容在`content/post`而不是`content/posts`中，如果不反过来，另一个就会倒下。</sup>

不过，这些都是相对次要的问题；花几天时间，仔细阅读论坛和文档，进行一些关键的配置更改，可能在一两天内清除一些蜘蛛网，这样就很好了，对吗？

#### [](#failure-is-a-recursing-theme)失败是一个递归主题

> 这不是快车道上的生活，而是迎面而来的车流中的生活。
> 
> <cite>特里·普拉切特</cite>

如果说我从这个故事中学到了什么，那就是静态博客的主题往往相当复杂，令人惊讶，人类可以让它们比这复杂得多。作为一条规则，你应该假设，无论是谁写了你选择的主题，他都只了解——或者至少只是遇到了——潜在问题的一小部分。仅举一个反复遇到的问题的例子，当您等待服务器超时并发出关于过度递归的抱怨时，对配置值的微小且看似无害的更改可能会突然将 Hugo 自吹自擂的速度变成同样令人印象深刻的无聊之举。不幸的是，这是一系列错误中的一个，让您不清楚问题孩子可能在哪里，甚至不知道正在处理什么文件。

我遇到的这些递归问题并不常见，但令人沮丧的是，我试图弄清楚到底发生了什么；它们*似乎*与 [Scratch](https://gohugo.io/functions/scratch/) 区域的使用有关，这是一种各种网站/页面/模板本地化的“scratchpad ”, Hugo 团队将其加入以克服 go 模板语言<sup id="fnref5">T5 5T7】中的一个明显缺陷。Scratch 工具似乎是为了解决一个小问题而添加的，但它显然被主题作者热情地采用了——也许是太广泛了，有时是不恰当的。不幸是，他们已经提供了关于一个明显强大但似乎危险的特性的稀疏文档，更重要的是，如果不深入了解主题的各种模板，你这个主题的消费者就无法知道这个特性正在使用。</sup>

调试这类问题很难，如果你不是一个相当有经验的开发人员，你就没有希望这么做。而且，除了 Scratch 之外，Go 模板语言*令人印象深刻*灵活而强大，允许你在模板中嵌入比我在其他模板 DSL 中看到的要复杂得多的逻辑。但随之而来的是复杂性和可能错误数量的潜在爆炸性增长。因为到目前为止还没有有意义的或者明显的方法来测试一个模板，你可以想象展示中不同主题的可靠性是*非常*可变的。

### [](#lessons-hard-won)教训来之不易

以上并不是说没有现成的、有效的主题，只是我从未发现过它们。然而，我也没有接近全部测试，完全有可能我只是不明智地选择了，所以你的里程可能会有所不同。当然，你的需求可能与我的完全不同；如果你需要一个单页登陆网站或者一个产品发布页面，有一些看起来很光滑，看起来很专业的产品，只需要很少的配置就可以很好的工作。

但是，如果你*像我一样*，在 web 编程方面的经验相对较少，并且有快速开始制作内容的强烈愿望，并且有尽可能多的现成支持，那么预先警告你，*隐含的*使用 Hugo 快速启动和运行的承诺是相当空洞的。

如果你对主题内部没有兴趣——或者没有能力——瞎折腾，那么 Hugo 几乎肯定不是你的正确选择，至少现在不是。如果你*有兴趣并且有能力，那么要意识到即使你最终没有重写你选择的主题的每一行——而且有一个*非常*的好机会你会*想要*重写——那么你肯定*会投入大量的时间来浏览、安装、调试和拒绝展示中的主题。最终你会发现你需要了解内部正在发生的事情，这一点对于这个领域中其他更成熟、更稳定、更有据可查的项目来说是无法立即做到的。**

如果你不打算成为*特别是*多产者——或者如果你还没有得到*大量*过期帖子目录——那么很有可能 Hugo 的*极其*令人印象深刻的渲染速度所支付的红利根本不会回报这种投资，更不用说给你带来真正的回报了。

也就是说，如果你*真的*有勇气从零开始——就像我最终用自己的主题所做的那样——那么当那些令人沮丧的几个月的努力结束时，拍拍自己的背，因为第一个帖子——这一个——感觉*很好*,即使它花了很长时间才最终呈现出来。

* * *

* * *

1.  当通过 http 和 https 提供服务时，Hyde 自己的站点看起来不同，这并没有激发信心。 [↩](#fnref1)

2.  我恶狠狠地盯着你`npm`、`grunt`、`yarn`、`webpack`、`yack`和`pork`，最后两个我都不确定*是我刚编出来的*。 [↩](#fnref2)

3.  在我写这篇文章的时候，快速入门指南确实有效，尽管有很多反对的警告。但是，您最终会得到一个看起来一点也不像主题演示页面的站点；即使是石像鬼顶部的闪屏图像也无法加载。 [↩](#fnref3)

4.  因此，即使进行了上述修复，您也会在《阿南刻快速入门》中看到警告。 [↩](#fnref4)

5.  变量可以用`:=`赋值操作符在模板中赋值，但不能更新。这似乎已经在某个时候被悄悄地修复了(现在有了一个`=`更新操作符)，减少或者可能消除了对暂存空间的需要，至少在单个模板的范围内*。 [↩](#fnref5)*