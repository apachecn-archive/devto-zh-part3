# 一只小虫子毁了一切

> 原文：<https://dev.to/arturmartsinkovskyi/a-little-bug-to-ruin-everything-3b43>

[![](img/c9a829840d9164d5e31c8fb0177bd252.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ONvEqKUj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/u50vanddgu1kiydet032.png)

## 简介

最近我一直在开发一个有趣的项目，这个项目的灵魂和 flash 主要来自 Kickstarter 和许多类似的网站。如果有人反驳我，我的项目配置文件中的那一行代码会让我感到愤怒和疲惫，就像我写下那行代码两周后一样，我会大声笑出来。然而，这是真的——那条线对我来说太难追踪和修补了。

## 出谋划策

我正在快速开发我的项目，所以我认为添加一些基于注册和依赖于用户的功能是个好主意。好吧，我说。包含**的时间:用于在我的用户模型中设计 gem 并使其工作的可确认的**模块。SMTP-config 设置，在 Figaro 文件中隐藏凭证，一点视图修复，然后第一封邮件到达我的测试电子邮件地址。一切都很好，但是...我看到了什么？是的，用户得到他的确认链接，点击它，然后他只是没有得到确认。什么？在隐藏了 Devise guts 之后，我修补了它以向前发展(基本上允许用户在不需要确认的情况下使用站点)，但问题仍然在这里，当我第一次错过和实现日期时间相关的功能时，它会爬来爬去抓住我。

## 狼的第二次帮助

Yaaas，我想你知道接下来会发生什么——鼓声来了，换句话说，需要时间和日期的附加功能是它们的一部分。什么都没有，实际上什么都没有，必须与日期、时间和时区一起工作才能真正发挥作用。你通过 ORM 向数据库传递一个日期或时间，甚至是基本的 **:created_at** ，当你得到它时，它只返回 **nil** 。你尝试的任何方法都不能解决问题。重置数据库？啊啊。调试保存过程？没有。根据 PostgreAdmin 和其他数据库管理程序的信息，最有趣的事情实际上是每个插入数据库的奇怪日期都出现在其中的细节，但每次我试图获得它时，Rails 都返回给我奇怪的**零**。正如你可能推测的那样，它真的让我感觉像是看了整整一周的 Uve Boll 电影。

## 驯服时区之兽

在我的项目上所有失败的尝试和实验之后，我感到疲倦、愤怒和充满仇恨。尼尔斯在我的脑海中无处不在，最后一个镜头我谷歌了一下我遇到的情况。在第一个搜索页面中间，我看到了这个 [stackoverflow 链接](http://stackoverflow.com/questions/20255272/rails-4-model-returns-always-nil),哦...飞行意大利面怪物，成功了。出于某种原因，当你以错误的格式将时区传递给时区配置时，应用程序不会显示任何错误或异常。它甚至没有指出你是一个哑元，没有。它只是破坏了它的 ORM 时间和日期操作，因为没有正确的时区，它不能正确地解释数据库中的日期，并最终取回 nils 而不是任何日期。对于作为活动记录的高级数据映射系统来说，这是非常糟糕且难以跟踪的行为。

## 结论

总结上面写的东西，我可以告诉你，你的代码中的每一个，甚至是最小的变化都应该在你的文档和变更列表中被考虑和提及。请记住，即使是最小的 bug 也会在您最意想不到的时候阻碍您的整个解决方案工作流程。