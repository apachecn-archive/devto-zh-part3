# 程序员的实用隐私(第 2 部分)

> 原文:[https://dev . to/rijks-ICT-gilde/practical-privacy-for-programmers-part-2-5d 05](https://dev.to/rijks-ict-gilde/pragmatic-privacy-for-programmers-part-2-5d05)

在本系列的第 1 部分中，我们从一个简单的方法开始，在一个假想的厨房水槽应用程序中处理(GDPR)隐私问题。

我们为每个功能开发了一个简单的清单，看看我们是否符合所有隐私要求。即使对于一个简单的静态网站，也存在隐私问题，这导致了这个小小的合规表:

| 与人员相关的信息 | 个人身份？ | 人格解体？ | 职责履行完毕？ | 支持所有者权利？ |
| --- | --- | --- | --- | --- |
| 网站访问 | 不 | 是(遮罩) | 钠 | 钠 |

在这第二部分，我们将做厨房水槽的第二个增量。

# [](#another-bit-of-theory)另一种说法

隐私的关键要素之一(如第 1 部分所述)是个人数据的处理者*有特定的职责要履行。如果我们真的想履行这些职责，是时候知道它们是什么了。

GDPR 实际上区分了处理器和控制器的责任，但是我们在这里把这些责任放在一起。

再次遵循[通用数据保护条例](https://eur-lex.europa.eu/legal-content/EN/TXT/PDF/?uri=CELEX:32016R0679&qid=1541482324985&from=EN) (GDPR)，它概述了与处理个人数据相关的六项原则:

1.  合法、公平和透明:有处理个人数据的正当理由，以公平和预期的方式使用个人数据，并就此进行清晰和公开的沟通
2.  目的限制:仅将个人数据用于声明的目的
3.  数据最小化:仅收集所需的最小数量的个人数据
4.  准确性:尽量确保个人数据是正确的
5.  存储限制:仅在需要时保留个人数据
6.  完整性和保密性:保护个人数据免受未经授权的阅读或修改

作为原则，这些不是现成的职责，但它们确实有助于理解和分组 GDPR 指定的实际职责。在开发我们的应用程序时，它们也是一个很好的列表。

那些关注以上 GDPR 链接的人可能已经注意到实际上还有第七项职责:责任。因为 GDPR 把它单独列出来了，而且这是一个很大的话题，我们将在一篇单独的文章中讨论它。

# [](#increment-2-sending-pictures-of-kitchen-sinks)增量 2:发送厨房水槽图片

为了让我们的静态厨房水槽应用程序更“令人兴奋”，我们将添加一个新功能:网站的访问者可以订购厨房水槽的图片，我们将通过邮件向他们发送一份硬拷贝。要做到这一点，他们只需提供他们的地址信息。因为我们预计不会有很多人想要一张厨房水槽的照片，所以我们将免费手动处理邮件。

显然，地址信息与一个人有关，当然也可以根据地址来识别一个人。因此，我们将把它添加到下面的列表中:

| 与人员相关的信息 | 个人身份？ | 人格解体？ | 职责履行完毕？ | 支持所有者权利？ |
| --- | --- | --- | --- | --- |
| 网站访问 | 不 | 是(遮罩) | 钠 | 钠 |
| 地址 | 是 | 不适用的 | TBD | TBD |

由于我们有六个职责，我们将用另一个(小)表来填充上面的字段:

| 原则 | 完成 |
| --- | --- |
| 合法 | TBD |
| 目的限制 | TBD |
| 数据最小化 | TBD |
| 准确(性) | TBD |
| 存储限制 | TBD |
| 完整性和保密性 | TBD |

## [](#lawfulness-fairness-and-transparency)合法、公平、透明

第一个原则其实更多的是一组原则。最重要的一点是合法性:我们处理个人数据有正当的理由吗？在我们的例子中，有一个明确的功能需求:否则我们不能邮寄照片！根据 GDPR，处理个人数据有[六个有效理由，其中之一是合同义务。虽然我们的合同是非正式的，但在这里仍然适用。](http://www.gdprtoons.com/2017/08/the-gdpr-provides-six-6-grounds-for_29.html)

这意味着我们应该能够显示我们存储的每个地址都链接到一个合同。一个简单的方法是——假设我们有一个关系数据库——在`contracts`和`addresses`表之间创建一个一对一的关系，并使用一个[外键约束](https://www.sqltutorial.org/sql-foreign-key/)来执行它。这确保了在没有相应契约的情况下不会存储任何地址，并且如果契约被移除，则地址也被移除。(如果我们想使用 NoSQL 或将地址数据存储在`contracts`表中，我们必须自己编写一些测试来检查。)我们的表现在看起来像这样:

| 原则 | 完成 | 支票 |
| --- | --- | --- |
| 合法 | 合同义务 | 合同(外键) |

你可能已经注意到我们忽略了这个原则的另外两个部分:公平和透明。这两个概念都与我们可以在这里测试的职责没有直接关系。由于它们也与所有者的一项权利(知情权)密切相关，我们将在本系列的下一部分讨论它们。

## [](#purpose-limitation)目的限制

我们声明我们将使用该地址来履行合同义务:邮寄照片。这意味着我们不能将它用于任何其他用途，除非它与最初的目的“兼容”。在我们的案例中，除了发送照片之外，我们没有任何其他用途。

虽然这意味着我们在法律上不被允许，比如说，使用这些地址为每个人订阅我的新厨房水槽月刊，但几乎没有什么物理阻止我这样做。虽然相信未来的自己已经很危险了，但是如果更多的人参与进来，这种危险还会增加。存储限制和数据最小化这两个原则(见下文)将对此有所帮助，但我们可以做得更多。

一是除了真正需要的人或进程，任何人都不应该访问这些地址。这符合更广泛的最小特权原则。在我们的例子中，这意味着 Kitchen Sink web 应用程序应该只拥有对`address`表的 insert 访问权限，因为它只需要存储新条目，而没有 select、update 或 delete 权限。

我们可以通过一个测试来测试这些特权是否已经设置好，该测试读取数据库特权并检查只有`mail-sender`用户拥有对`addresses`表的读取权限。

| 原则 | 完成 | 支票 |
| --- | --- | --- |
| 合法 | 合同义务 | 合同(外键) |
| 目的限制 | 访问限制 | Test ✅ |

我们在这里可以做得更多。例如，我们可以启用[审计日志](https://www.datamation.com/columns/article.php/3578916/The-Importance-of-Audit-Logs.htm)。这不会阻止地址被用于其他目的，但有助于检测是否发生了这种情况。然而，以一种安全而有用的方式设置审计日志可能是一件非常麻烦的事情，对于我们这个简单的应用程序来说，这是一项覆盖微小风险的大投资。在讨论数据保护措施时，GPDR 允许此类考虑，如果风险合理，则不采取措施是合理的。

## [](#data-minimisation)数据最小化

我们应该只收集“足够的、相关的和仅限于必要的”个人数据。这意味着我们不能收集我们寄信时不需要的信息，比如出生日期。但这也意味着我们不必过于简约。在我居住的荷兰，实际上，在很多情况下，寄信只需要邮政编码和门牌号就可以了。名称、街道和城镇与目的相关，事实上是由万国邮政联盟的荷兰地址指南推荐的。

仅使用荷兰地址，我们需要向我们的`addresses`数据库表添加四个字段:`name`、`streetAndNumber`、`postal Code`和`town`。为了防止未经验证的个人数据字段被添加到数据库表中，我们可以添加一个简单的测试来检查`addresses`表的列名，如果遇到非白名单列，就会失败。

| 原则 | 完成 | 支票 |
| --- | --- | --- |
| 合法 | 合同义务 | 合同(外键) |
| 目的限制 | 访问限制 | Test ✅ |
| 数据最小化 | 万国邮联建议的地址字段 | Test ✅ |

## [](#accuracy)准确度

存储个人数据时，我们有责任确保个人数据准确、最新并尽快得到更正。由于我们只保留地址，直到我们把它们记在信封上(见存储限制)，更新或纠正过程对我们来说是不必要的。但是，我们仍然必须采取“合理的”措施来确保我们记录的数据是准确的。

由于数据错误的影响非常有限，我们可以在这里做一些最小的步骤。一个明显的例子是做一些用户输入验证。在我们的例子中，我们可以要求所有字段都非空，并且邮政编码具有正确的格式。更高级的方法可能是查找邮政编码，以验证(或自动填充)它是否与街道和地名匹配。但是因为厨房水槽没有带来任何收入，而且这些都是付费服务，所以我们将省去那张支票。

除了对验证代码进行单元测试之外，我们还可以通过查看数据库中的实际数据进行测试，并执行相同的检查(非空的有效邮政编码)。然而，这样做的缺点是需要我们的检查来读取数据，这并不理想。最好将这些作为契约添加到数据库模型中。SQL 数据库[可以通过使用`CHECK`](https://www.sqltutorial.org/sql-check-constraint/) 来做到这一点。

| 原则 | 完成 | 支票 |
| --- | --- | --- |
| 合法 | 合同义务 | 合同(外键) |
| 目的限制 | 访问限制 | Test ✅ |
| 数据最小化 | 万国邮联建议的地址字段 | Test ✅ |
| 准确(性) | 用户输入验证 | 合同(列检查)✅ |

## [](#storage-limitation)存储限制

如果我们不再需要获得个人数据的原因，我们必须摆脱它。在我们这个简单的例子中，在我们把地址写在信封上并放进邮箱后，我们就不再需要它了。(如果我们更复杂一点，我们可能希望将它保留更长一点的时间来处理跟踪和追踪、退货等。)在此之后，我们可以选择手动删除每个地址记录，但手动操作容易出错，也容易忘记——在这种情况下，我们会被不允许保留的个人数据所困扰。

自动清理过程更加健壮。例如，如果我们记录发送邮件的人检索地址的时间，我们可以运行一个每日作业，删除在该时间点之前收到的所有地址。我们可以运行一个测试来检查这是否顺利，计算“旧”记录的数量。(注意，这与上面提到的准确性有相同的缺点。我们可以通过在只包含旧记录的`addresses`表上创建一个视图来解决这个问题，并提供对它的访问。)

我们应该解决的第二个问题是备份。设置这些是一个很好的做法，但是它们当然也会包含个人数据。因为我们不想从备份文件中删除单个地址，所以我们需要一种不同的方法。合理的做法是，我们将备份保留一段有限的时间，比如说 30 天，然后删除它。这是一个相当标准的设置，称为“滚动备份”。我们可以通过检查最旧备份的年龄来验证，它最多为 30 天。

| 原则 | 完成 | 支票 |
| --- | --- | --- |
| 合法 | 合同义务 | 合同(外键) |
| 目的限制 | 访问限制 | Test ✅ |
| 数据最小化 | 万国邮联建议的地址字段 | Test ✅ |
| 准确(性) | 用户输入验证 | 合同(列检查)✅ |
| 存储限制 | 自动移除 | Test ✅ |
| 存储限制 | 备份翻转 | Test ✅ |

## [](#integrity-amp-confidentiality)诚信&保密

这是迄今为止最广泛也是最难保证的原则。完整性和机密性是信息安全的三个传统关键概念中的两个，被称为“中情局三要素”。正确保护应用程序超出了本文的范围，但幸运的是，许多其他人已经就此写了大量文章(参见下面的阅读建议)。此外，验证应用程序是否得到了适当的保护也不简单。就看 owasp[应用安全验证标准](https://www.owasp.org/index.php/Category:OWASP_Application_Security_Verification_Standard_Project)(ASVS)；对于一个 web 应用程序，您可能要执行将近 200 项检查。对于其中的一些，自动化要么很困难，要么很昂贵，或者两者兼而有之。不过，我会列出我们可以在厨房水槽应用中采取的两个措施，让大家对我们在这里能做什么有个印象。

让我们从 HTTPS 开始。虽然慢慢成为默认，但仍有许多网站不保护浏览器和网络服务器之间的流量。真的没有借口不再使用它，因为[让我们加密](http://letsencrypt.org)提供免费证书，像 [Caddy](http://caddyserver.com) 这样的网络服务器默认启用它。我们甚至可以使用免费的 HTTPS 配置检查器之一，通过自动化测试来验证 HTTPS 是否设置正确。我喜欢 SSL Labs 的那个，但是还有其他的。

第二个安全问题是第三方组件中日益普遍的漏洞。对于一个简单的 web 应用程序，我们可能已经依赖于一个 web 应用程序框架、一种编程语言、一个 web 服务器、一个数据库、一个操作系统和几个库来将它们粘合在一起。所有这些，无论是开源的还是私有的，都可能包含漏洞，并且这些漏洞经常被发现和利用。定期检查所有组件，修补、升级或远离易受攻击的组件是最佳实践。虽然您可以将它变成一个手动过程，但是可以获得(部分)支持。源代码控制巨头 GitHub 支持[检查某些语言的易受攻击的库](https://help.github.com/articles/viewing-and-updating-vulnerable-dependencies-in-your-repository/)，像 [Snyk](https://snyk.io) 或[depend bot](https://dependabot.com)这样的工具也支持。

前面，我们已经提到了最小特权原则，确保用户只拥有所需的最小特权。但是为了安全地使用这些用户帐户，我们应该适当地保护它们。这包括用密码或 SSH 密钥保护它们，但也限制它们可以连接的 IP 地址(理想情况下，数据库甚至不能从整个互联网到达)。如果您使用密码或 SSH 密钥，您应该对它们有强度要求，最好由数据库强制执行(例如，在 MySQL 中有[密码验证组件](https://dev.mysql.com/doc/refman/8.0/en/validate-password.html))。不幸的是，我不知道有什么(简单的)方法可以验证这个设置是否正确。

| 原则 | 完成 | 支票 |
| --- | --- | --- |
| 合法 | 合同义务 | 合同(外键) |
| 目的限制 | 访问限制 | Test ✅ |
| 数据最小化 | 万国邮联建议的地址字段 | Test ✅ |
| 准确(性) | 用户输入验证 | 合同(列检查)✅ |
| 存储限制 | 自动移除 | Test ✅ |
| 存储限制 | 备份翻转 | Test ✅ |
| 完整性和保密性 | HTTPS | Test ✅ |
| 完整性和保密性 | 安全组件 | Test ✅ |
| 完整性和保密性 | 强身份验证 | — |

验证中的这最后一个缺口对于安全性来说是典型的。虽然有(昂贵的)工具涵盖了许多安全问题，但最终[手动验证](http://www.veracode.com/security/penetration-testing)通常是合适的。一定要聘请专业人士来处理关键的应用程序，但也不要害怕[自己动手](http://hack-yourself-first.com)。

这标志着这篇文章的结束，但不是这个迭代的结束。我们的清单仍然有“支持所有者权利吗？”标记为待完成的列。在下一部分中，我们将解决这个问题。

与此同时，以下是对上述主题的进一步阅读:

*   [开放 web 应用安全项目(OWASP)](https://www.owasp.org/index.php/Main_Page) 有大量关于 Web 应用安全的信息。它的前 10 名毫无疑问是最著名的，但这只是他们所做的很小一部分。

*   由安全资深人士 Gary McGraw 撰写的《软件安全——在 中构建安全》一书已经有十多年的历史了，但是除了几个关注代码级问题的部分之外，它仍然适用于今天。

*   澳大利亚人 [Troy Hunt](https://www.troyhunt.com) 写了很多关于安全性的文章，也谈了很多，有很多优秀的入门文章或者培训视频。

* * *

这篇文章之前发表在 [Rijks ICT Gilde](https://www.rijksictgilde.nl/actueel/weblogs/blog/2018/2-pragmatische-privacy-voor-programmeurs) (荷兰语)

**照片由[杰森·黑眼](https://unsplash.com/photos/8yYAaguVDgY)在[Unsplash](https://unsplash.com)T5 拍摄**