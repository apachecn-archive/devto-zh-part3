# 我在面向微服务的项目中的经验和收获

> 原文：<https://dev.to/brpaz/my-experience-and-learnings-from-working-in-a-microservices-oriented-project-li5>

在过去的几年中，微服务已经成为我们行业中非常热门的话题，并被视为构建更去耦、可扩展和易于维护的应用程序的推荐方法。

在大约一年的时间里，我在一个项目中从头开始遵循面向微服务的架构。在这篇文章中，我将分享我的经验和从中得到的教训。

## 项目

给你一些背景，我工作的项目是构建一个机票预订 web 应用程序，类似于 [Skyscanner](https://www.skyscanner.net/) 。

主用户流程真的很简单。用户会看到一个搜索表单，在那里他可以输入他想去的地方，日期等等。

在他点击搜索按钮之后，一个可用航班的列表出现了。

然后，用户可以选择所显示的航班之一，并开始结帐过程，在该过程中，他将输入他的个人详细信息，随后选择付款方式。在旅程结束时，他会收到一封确认航班的电子邮件。

## 开始-确定你的服务边界

从微服务架构开始，最重要的事情是确定您的服务边界。考虑你的领域模型和领域实体之间的关系。来自微软的这个指南是一个很好的资源，它更详细地解释了这个主题。

这真的很重要。如果服务边界没有很好地定义，您可能会以服务过于相互耦合而告终。如果有疑问，从更大的界限开始。稍后分解成更小的单元比反过来更容易。

从我上面描述的主要用户流中，我们可以清楚地识别出一些潜在的服务。搜索服务，将负责查询我们的航班提供商，并显示可用航班列表。“订单”服务，将管理预订/结账流程。一个支付服务，将处理所有与支付相关的事情，甚至一个消息服务，将负责向用户发送确认电子邮件。

这种关注点的分离在业务领域方面很有意义，但是您也可以看到在可伸缩性和操作方面的优势。

你将会有比预订更多的搜索，所以搜索服务可能需要比订单服务更大的规模。作为一个独立的服务允许。

此外，搜索服务将需要做大量的处理，以获取多个合作伙伴的可用航班。作为一个独立的服务，我们可以为这项工作选择最合适的语言和工具。此外，不同的团队可以分别处理这些服务。

这就是我们最终建立的。

航班业务真的很复杂，所以我们最终将搜索服务进一步细分为更小的专业服务，一起工作。

我们还有其他一些较小的服务，我不会详细介绍。

总的来说，这个结构是一个巨大的成功，但当然也有一些不太积极的东西，我接下来会谈到。

## 一个不该诞生的状态机服务

在公司中，我们确定了不同项目的共同需求。每个项目在某个时候都需要某种状态机。这个项目也不例外。我们需要一个订单和支付的状态机。

所以我们决定做一个通用的状态机服务，这个服务可以被公司的其他项目使用。虽然这在理论上听起来是个好主意，但实际上并不那么好。我来解释一下原因。

第一个问题是术语“通用”状态机。概括和抽象一般来说当然是一个好主意，但是它经常会导致过度工程化，比做更具体的事情要复杂和耗时得多。

为了能够正确地概括和抽象一个解决方案，清楚地理解所有的业务需求、它们最终将如何随着时间的推移而发展以及服务的每个潜在用户的特定需求是至关重要的。

事实并非如此。与我们专注于基于这个特定项目中的新内容来构建更具体的东西相比，我们要花费更多的时间来预测所有可能的功能和需求。

第二个问题是，如果你考虑我们的域模型和我谈到的服务边界，状态机本身是没有多大意义的。它不能独立工作，必须与某个业务实体相关联，在这种情况下是订单或支付。这显然属于订单/付款的范畴。这两个服务之间的紧密耦合是显而易见的，因为两个服务最终会在一个请求中多次调用对方的每个操作以及所有相关的开销。

对于当前的实现，订单服务不能在没有状态机服务的情况下工作，状态机服务也不能在没有订单服务的情况下工作。当两个服务同步通信时，这个问题就更大了，这就留给了这个项目的下一次学习，尽可能选择异步通信。

如果我们想重用一些代码，可以做的是构建一个库和一些 SDK，而不是创建一个完全独立的服务。

## 偏好异步通信

虽然每个服务应该是一个独立的可部署单元，但是它们一起工作来构建您的应用程序，所以它们之间当然存在一些依赖关系，并且它们必须以某种方式进行通信。但是这种依赖并不一定是一种硬依赖，即如果某个服务关闭，它会导致所有应用程序关闭。你如何避免这种情况？通过使用像消息队列这样的异步通信。

这个项目中的一个例子是支付服务。当用户进行预订时，订单服务将对支付服务进行同步 HTTP 调用以进行支付。然后，支付服务将向外部支付提供商发出另一个请求，以有效地进行支付。

这个过程是缓慢的，而且中间会有很多事情失败。使用异步通信使您的服务对失败更有弹性，因为您可以以更容易的方式实现诸如出错时重试之类的机制。

## 结论

微服务架构的优势是显而易见的，从更好地分离关注点导致更多解耦的应用程序，到独立扩展每个服务或将每个服务编写成最合适的编程语言的可能性。

但是微服务不是银弹。应用程序的编排/部署更加复杂，调试更加困难，每个服务与其他服务的通信方式也需要仔细考虑。

如果你想走这条路，你需要很好地规划你的架构。基于您的领域模型正确识别服务边界是基于微服务的成功实施的第一步。

由于我参与的项目的性质，服务边界被清晰地定义，采用微服务方法完全有意义。如果这不是很清楚，或者预计会有很大的变化，从一个更大的整体开始，然后在需要的时候提取一些部分，这没有什么错。

monolith 这个词通常有不好的含义，但事实是，没有什么能阻止你拥有一个模块化的 Monolith，有很好的关注点分离，低耦合和高内聚。像 SOLID 这种流行的设计模式可以提供很大的帮助。如果这样做，随着应用程序的增长，开始将应用程序的特定部分转移到单独的服务将会相对容易。

每个应用程序都不同。作为软件工程师，你的工作是分析需求并选择最合适的路径。

希望你喜欢这篇文章。如果您有任何问题或意见，请随时使用下面的评论框。

## 引用

*   [什么是微服务？](https://microservices.io/)
*   [边界上下文](https://martinfowler.com/bliki/BoundedContext.html)
*   [微服务领域分析|微软文档](https://docs.microsoft.com/en-us/azure/architecture/microservices/domain-analysis)
*   [微服务是你成长的过程，而不是从开发社区开始](https://dev.to/nickjj/microservices-are-something-you-grow-into-not-begin-with-2llj)
*   [设计一个成功的微服务工程文化开发社区](https://dev.to/jakelumetta/designing-a-successful-microservices-engineering-culture-3n07)