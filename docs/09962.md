# 为什么 TDD 对你不起作用

> 原文：<https://dev.to/arminaskatilius/why-tdd-is-not-working-for-you-2hbd>

测试驱动开发看起来是如此简单的技术，然而它却引起了广泛的反响。从人们认为它让你变得更加专业，到人们认为 T2 已经死了。

总的来说，我认为来自 TDD 爱好者的太强的推动弊大于利。当你对良好的编码实践感到兴奋时，这很好，但是当你开始强迫别人时，这可能会产生相反的反应。甚至还有一个心理学术语来形容它——[电抗理论](https://en.wikipedia.org/wiki/Reactance_(psychology)):

> 当某人在巨大的压力下接受某种观点或态度时，反应就会发生。逆反心理会导致这个人接受或强化一种与本意相反的观点或态度，同时也会增加对劝说的抵制。

我认为这在某种程度上影响了开发者更有可能表达和分享关于 TDD 为什么不为他们工作的观点。TDD 是一种特定的技术，认为它可以适用于所有人是幼稚的。没有人会因为不使用 TDD 而感到不舒服或不专业。然而，也许 TDD 对你来说是正确的技术，但是许多巧合让你得出结论，它太难了，不切实际。在这里，我将分享一些想法，可能会帮助你重新思考你的 TDD 体验。有些是关于如何交替应用规则的想法，有些是关于如何改进测试体验的想法，即使你没有使用 TDD。

## 你遵守规则太严格了

这来自所有的教程和书籍，其中的规则是严格制定的。TDD 的第一[定律规定:](http://butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd)

> 除非是为了通过失败的单元测试，否则不允许编写任何产品代码。

从如此强烈的措辞来看，严格遵守规则似乎是必须的。虽然这三条定律都准确地描述了 TDD 过程，而且一些开发人员确实严格地遵循了它们，但是它应该被视为初始学习的材料。

> 了解规则，然后打破它们

对于 TDD 来说，这意味着一旦你掌握了它是如何工作的，你就可以在任何你觉得它有效的时候应用它。最初，严格过程教你如何编写可测试的代码。但是以后你可能会发现先构建结构，然后开始编写逻辑的 TDD 测试会更舒服。

## 你只是将它用于单元测试

TDD ==单元测试是一个常见的误解。其实连名字都是“测试驱动开发”，而不是“单元测试驱动开发”。单元测试主要用在 TDD 的例子和教程中，通常，TDD 对于纯单元测试功能非常有效。但实际上，这种技术适用于任何类型的测试。

例如，我已经使用 TDD 编写了许多 SQL 查询。有时我不确定我需要写什么 SQL，但是我只需要创建一个插入一些数据库行并期待一些结果的测试。然后，我可以尝试不同的 SQL 查询，直到它的工作。API 测试也是如此。您可能需要修复 JSON 输出格式错误的错误。不用用 Postman 手动测试，你可以写一个 API 测试用例，然后开始修复代码。

## 你的测试基础设施太慢了

TDD 的最大好处是它实际上可以让你更快。以下是方法。

编写新的功能或修复现有的流程可以简化为两个步骤:

1.  创建/更新代码
2.  检查它是否按预期工作

TDD 让你优化“检查它是否按预期工作”的速度。你不需要等待一个应用程序被重新构建，你不需要打开一个浏览器，创建测试数据，看看代码是否如你所愿。使用 TDD，您可以立即看到结果。

然而，如果测试执行缓慢，那只会中断流程。有人说[测试应该在 10 秒或更短的时间内运行](https://blog.ploeh.dk/2012/05/24/TDDtestsuitesshouldrunin10secondsorless/)。
我部分同意，因为当测试套件很快时，TDD 对我来说感觉最好。然而，如果你有一个大的测试套件，我不同意为了更快而运行测试套件的一部分是不好的。但是在使用这项技术之前，还有其他方法可以提高速度。

首先，找出测试缓慢的原因至关重要。如果有冗余的数据初始化，或者如果每次都在重建数据库，集成测试可能会变慢。每个案例都是独一无二的。单元测试也是一样，它根据你使用的栈或工具而变化。找出他们的限制和最佳实践，看看你是否能以任何方式提高速度。

如果没有其他方法来提高速度(例如 IT 测试自然比单元测试慢)。您可以应用这种技术，它允许快速运行测试。以特定频率运行不同数量的测试:

1.  当您做小的代码更改时，最常执行一个测试
2.  在一段时间之后，或者如果你认为你已经做了很大的改变，运行特定函数/方法的所有测试
3.  一段时间后，运行多个相关的测试(可能是同一个类/模块的所有测试)
4.  最后，运行所有测试套装

这不是一门精确的科学，你应该找到最有效的方法。但是尽量不要过多考虑应该运行哪些测试。

## 您的测试基础设施不方便

它与前面关于速度的陈述密切相关。为了在 TDD 上高效，你必须使用舒适的工具(这同样适用于在没有 TDD 的情况下高效地编写测试)。

作为一个例子，我可以提到我认为非常重要的测试基础设施的两个品质:

1.  与单个测试相比，执行所有测试有多容易？最好的情况是，您可以通过单击一个按钮或键盘快捷键来执行所需的测试。到控制台键入 regex 来匹配您想要运行的测试是非常乏味的。
2.  断言错误有多明显？你应该不需要解释测试失败的原因。当您期望数组中的某个项目时，出现类似*“期望真为假”*的失败消息是不好的。

这个清单还可以继续下去，但主要目标是尽量减少对日常行为的思考。相反，这可以让你更多地考虑你需要解决的实际问题。如果测试基础设施妨碍了你，让你过多地考虑如何开始写或者写测试，那么在 TDD 上就很难有效率。这样一来，不管你是在测试之前还是之后写，测试都会变成烦人的琐事。

## 你只对简单的情况应用 TDD

为简单的逻辑编写测试，尤其是在涉及嘲讽的情况下，会感觉有点尴尬。您需要编写设置代码，初始化模拟对象，为方法调用添加断言，等等。最后，实际的代码只是“if”语句和一些函数调用。这可能让人觉得有点乏味。

我不是说你不应该在简单的情况下使用 TDD。虽然学习它肯定有帮助。但是只申请简单的案例可能不会显示出它的全部潜力。当我开始使用 TDD 时，似乎我只能将其应用于新的代码，并且只能应用于某些功能。但我已经开始在修复新错误或向现有代码添加新功能时使用它，它真的帮助我理解了如何在不同情况下应用它。

当您有复杂的逻辑要实现时，TDD 感觉最好。您甚至不知道如何实现它，但是它允许您去除需求，最终得到完全可行的解决方案。同时，这也增加了你重构的信心。

## 你在测试太多的实现细节

好的测试清晰易懂。有了 TDD，考虑预先写什么测试应该很简单。然而，如果您试图过多地涵盖内部行为，那么预先编写测试可能会非常困难。

例如，当涉及到大量的奚落和嘲笑时，这种情况经常发生。这种类型的测试很难编写，因为它们涉及到诸如“这个方法应该用这些参数调用 3 次”之类的断言。

我记得的另一个例子是使用[酶](https://airbnb.io/enzyme/)编写反应测试。我有时以检查内部状态、检查组件如何呈现子组件等测试结束。当我开始使用 [React 测试库](https://github.com/kentcdodds/react-testing-library)时，使用 TDD 变得容易多了。您无法访问内部细节，这迫使您以不同的方式思考组件测试。你不关心什么子组件被渲染，什么道具被传递给它们。相反，您可以编写期望呈现某些文本的测试，这样的测试肯定更容易编写。