# 用户界面作为反射

> 原文:[https://dev . to/oieduardorabelo/interface-de-usual IOs-como-uma-reflexao-1g gj](https://dev.to/oieduardorabelo/interface-de-usuarios-como-uma-reflexao-1ggj)

人们经常问我的一个问题:“React 的所有新功能( *context，hooks，suspende*)如何影响我们今后开发(web)应用程序的方式？他们是否使诸如 Redux 或 MobX 之类的状态管理库过时？”

有了这个职位，我会试着一劳永逸地回答这个问题！为了真正了解问题，我们需要做些工作。让我们回到过去，留下反应器，Redux 和 MobX 单独，同时我们回答一个更基本的问题。

什么是 web 应用程序？为了本文的目的:Web 应用程序是允许客户与公司交互的用户界面。这里的关键是它是**一个**用户界面。否 **a** 界面。良好前端的目标:为您的客户提供愉快、无缝的体验，以便与他们的业务流程交互。但是前端本身并不是业务！

* * *

作为实验，想象一下‘t0’inbox . Google . com 停止工作(啊，等等，他已经停止了-我...。😭).从理论上讲，用户可以拿起电话，打谷歌电话，表明自己的身份，问一位谷歌员工:请告诉我你有什么消息等着我？这种精神锻炼是弄清你的生意是什么的好方法。如果一个客户经过你的办公室，他们会问什么问题？如果办公室要烧毁，你会尝试保存哪些信息？哪些用户交互可以为您的企业带来资金？

我意识到，在前端开发中，我们经常从相反的角度对待用户界面:我们从一些 mock-ups 开始，在几乎任意的地方添加状态片段，使这一切都变得栩栩如生。基本上，状态和数据是一种延迟的反映，这是创建这种美丽的用户界面工作所必需的邪恶。努力在这方面应用必然得出结论:国家是一切邪恶的根源。是那件可怕的事情，它使一切美好的事物开始，丑陋和复杂。但这里有一个反思考:

> 状态是整个收入流的根。

-信息。最终，客户与业务流程交互的机会是唯一能够赚钱的机会。是的，更好的用户界面体验可能需要更多的钱。但这并不是金钱的来源。

因此，我谦卑地认为，我们应该从相反的方向着手创建 web 应用程序，并首先对客户与我们的系统之间的交互进行编码。有哪些流程。他需要什么信息？他打算发送什么信息？换句话说，让我们从建模我们问题的域开始。

这些问题的解决方案是我们无需用户界面库就可以编码的东西。我们可以用抽象的术语来规划互动。测试他们。并深入了解这些过程可能处于哪些不同的状态。

> 模拟和开发应用程序逻辑，就像它用于许多不同的选项卡(如 web、CLI、本机等)一样。)，即使不是。这将迫使您避免将逻辑与主流框架(react、Angular、vista)无意中鼓励的演示绑定在一起。- [大卫 k。钢琴〔t1〕](https://twitter.com/DavidKPiano/status/1092424711655567360)

此时，无论客户使用何种工具与业务进行交互。web 应用程序？React 的本机应用程序？SDK 作为 NPM 模块？CLI 吗？没关系！像这样:

> 首先，设计状态、存储和处理，就像构建 CLI 而不是 web 应用程序一样。

现在你可能会想，“你在工程方面不是夸大其词吗？为什么要构建应用程序，就像要启动 CLI 一样？我显然永远不会这样做……你是在吐独角兽吗？”

现在，请停止阅读此博客一段时间，返回到您正在跟踪的项目中，然后开始测试...。现在告诉我:您的应用程序是否有 CLI？您团队中的每个开发人员都有一个 CLI(希望):测试框架。它交互并检查其业务流程。您的驱动器测试与您的流程交互所需的指示级别越少，就越好。驱动器测试是系统的第二个用户界面。甚至是第一个，如果你应用 TDD。

React 在使单元测试了解组件接口并与之交互(无需浏览器等)方面做得非常出色。但即便如此，您也应该能够在没有“mount”、“render”(“浅薄”)等概念引入的指示的情况下进行测试吧？)、“调度事件”、“快照”。这些都是与业务领域无关的概念，不必要地将它们的逻辑与 React 联系起来。

> 没有什么比将您的业务流程作为一组功能直接调用更简单了。

此时，您可能知道为什么我一直反对将域状态直接捕获到 React 组件的状态。这使得业务流程分离和用户界面变得不必要的复杂。

如果要为我的应用程序创建 CLI，我可能会使用类似于[yags](https://www.npmjs.com/package/yargs)或 [commander](https://www.npmjs.com/package/commander) 的东西。但这并不意味着因为 CLI 是我的用户界面，所以这些库必须管理我的业务流程的状态。换句话说，我愿意支付全部重写的费用，只是为了在**yags**和 **commander** 之间切换。React 对我来说就像一个 CLI 库，一个帮助捕获用户输入、运行流程并将企业数据转换为良好输出的工具。是一个用于[构建用户界面](https://reactjs.org)的图书馆。这不是业务流程。

* * *

仅当您捕获、测试和验证了客户端进程后，才开始导入实际用户界面。它是用什么技术建造的。您将处于非常舒适的位置:开始构建零部件时，您会发现它们不需要太多状态。某些组件会有自己的状态，因为并非所有的用户界面状态都与它们的业务流程相关(所有不稳定的状态，如当前选择、指南、路由等)。页:1。但是... but ...：

> 其大部分成分将会呈现(***【dumb 组分】***

你也会发现测试变得更简单；您将编写更少的测试来装配组件、触发事件等。您还想要一些，以验证您是否正确连接了所有内容，但不需要测试所有可能的组合。

这种大的解组功能允许在 ua UI、A/B 测试等方面进行更快的迭代。域状态和 UI 取消关联后，您可以重新构建用户界面。说实话，即使切换到完全不同的 UI 或范式也会变得更便宜。因为国家不受它的影响。这很好，因为在我看到的大多数应用程序中，用户界面的发展速度远远超过了实际的业务逻辑。

例如，在孟德斯鸠，我们非常成功地使用了上面的模型。这种分离已成为每个人自然遵循的范式。例如，用户需要加载 excel 电子表格，然后执行一些客户端验证，再与服务器交互，最后启动一些进程。此新功能首先会生成一个新存储(仅一个简单的 JS 类)，用于捕获流程中每个步骤的内部状态和方法。这将捕获逻辑进行验证。后端交互。我们还将创建驱动器测试，以验证是否生成了正确的验证消息，以及整个过程是否在所有状态切换和错误条件下正常工作。只有在那之后，人们才开始创建用户界面。选择一个好的上传组件，为所有步骤创建表单等。

此时，您也可以理解为什么我不喜欢直接在用户界面中混合后端交互的东西。就像把**反应-阿波罗**的连接作为与**图形 SQL**交互的手段一样。后端交互(如发送更改或查找数据)是我的域的责任。而不是用户界面层。 **react-apollo** 到目前为止，我认为这是一条容易导致高度耦合构型的捷径。

* * *

终于来了！现在回到我们最初的问题:“React 的所有新功能( *context，hooks，suspende*)如何影响我们将来开发(web)应用程序的方式？他们是否使诸如 Redux 或 MobX 之类的状态管理库过时？”

我的答案是:新功能不会改变状态管理游戏。*语境*和*挂钩*不允许反应堆制作新把戏。这些都只是同样的把戏，组织得更好，更容易作曲，更不容易出错(当然，我是粉丝！页:1。但盒子外的试剂只能对属于部件的状态作出反应。如果您希望域状态位于组件树之外，则需要单独的状态管理模式(抽象、体系结构、库)来组织所有这些。

> 最近对 React 的添加基本上没有改变状态管理游戏中的任何内容。

也就是说，如果意识到自从引进前后关联和*挂钩*以来就不再需要 Redux 或 MobX，那么从一开始就不需要它们了。这是逻辑与表达耦合的后期反映。

请注意，使用*挂钩*、[时，使用 MobX 管理本地组件](https://blog.cloudboost.io/3-reasons-why-i-stopped-using-react-setstate-ab73fc67a42e)状态的理由较少。特别是考虑到 MobX 作为组件状态的**可观察到的**，将无法利用**悬架**的优点。

说起暂停对一般的国家管理，我认为这只是证明了利益分离的健康。suspension+react local status 非常适合于管理整个用户界面状态，以便可以进行并发渲染和其他操作。并行渲染对于不稳定状态(如用户界面)非常有用。但是对于我的业务流程呢？业务流程在任何时候都必须完全处于一个状态。

借此，我希望回答反应战对国家管理的新问题:

> React 必须管理用户界面的不稳定状态，而不是其业务流程。因此，一切都没有真正改变。

关于 [MobX](https://mobx.js.org/) 和 [mobx-state-tree](https://github.com/mobxjs/mobx-state-tree) 的快速说明，可以更好地了解其总体目标。它们旨在:

*   能够独立于任何用户界面抽象来管理状态。
*   一种向用户界面添加用户创建的状态的向下透明的方法
*   通过确保事件不会导致许多组件重新呈现，避免处理针对订阅、**选择器、**等功能的手动优化时出现常见错误。

如果你想知道与一个有组织的独立的统治国家合作是多么的合法，请观看我的演讲[【复杂性:分裂】&征服](https://www.youtube.com/watch?v=3J9EJrvqOiM&index=7&t=0s&list=PLW0vzLDjfaNSFs7OBLK6anfQiE5FJzAPD)，或者阅读:[【如何分解国家和 ui】](https://hackernoon.com/how-to-decouple-state-and-ui-a-k-a-you-dont-need-componentwillmount-cc90b787aa37)。[奥卢费米·阿德霍](https://medium.com/u/f90a459e227f)最近也写道:[【可重用国家管理的奇案】](https://medium.com/@fadeojo/the-curious-case-of-reusable-javascript-state-management-25e433a7b05)。

在我们离开之前:每个博客都知道一个博客需要图片来吸引用户。此博客尚未呈现任何图像，因此用户界面较差且不满意。但你还是可以实现你所有的“业务目标”:和你分享上面的想法。因为，从实施的角度来看，尽管极其重要:

> 用户界面只是一种反射。

[![](../Images/e2c6852e1ca7b0d649e88430e36a593c.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--27tY6RSH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn-images-1.medium.com/max/800/1%2AcDCUFkPebqyS0x7mX2kn3g.gif)

*捕获业务流程后，也可以使用它们来[定向用户界面](https://www.youtube.com/watch?v=3J9EJrvqOiM&index=7&t=0s&list=PLW0vzLDjfaNSFs7OBLK6anfQiE5FJzAPD)！*

最后提示:是否将 MobX 与 React 16.8.0 或更高版本配合使用？查查 MobX 的*挂钩*，它们比原来的要小得多！

**更新，2019 年 2 月 25 日**:对这篇文章感兴趣吗？我推荐罗伯特 c 的《失落的岁月建筑》演讲[。马丁〔T3〕！](https://www.youtube.com/watch?v=WpkDN78P884)

# [t1【学分】](#cr%C3%A9ditos-%EF%B8%8F)

*   [UI 作为事后的想法](https://medium.com/@mweststrate/ui-as-an-afterthought-26e5d2bb24d6)，escrito originate por[@ mweststrate](https://mobile.twitter.com/alligatorio)