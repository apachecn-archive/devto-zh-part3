# 如何给出优秀的代码评审

> 原文:[https://dev . to/atyborska 93/how-to-give-great-code-reviews-44jg](https://dev.to/atyborska93/how-to-give-great-code-reviews-44jg)

*这篇文章最初发表在[我的博客](https://angelika.me/2019/05/19/how-to-give-great-code-reviews/)上。*

为了给出好的代码评审，你需要知道你为什么要做代码评审。

## [](#why-do-we-review-code)我们为什么要评审代码？

我们都知道代码审查很重要，但是为什么呢？他们可以捕捉一些错误，防止糟糕的设计决策进入生产，但这是他们唯一的功能吗？

根据我的经验，一个优秀的代码评审有三个重要的目标:

1.  让团队与不断变化的代码库保持同步。
2.  提高项目质量。
3.  为开发人员提供反馈。

## [](#keeping-up-to-date-with-a-changing-codebase)与变化的代码库保持同步

进行代码评审迫使开发人员阅读他们自己没有参与的代码部分。这提高了团队对代码库的整体了解。因此，任务规划进行得更加顺利，时间/复杂性估计的准确性也提高了。

### [](#i-find-out-the-why-first)一、先搞清楚*为什么*

为了能够理解代码更改，您必须首先理解为什么要进行代码更改。

我们大多数人都使用某种问题跟踪系统。确定与此代码变更相关的问题/票据，并彻底阅读，包括注释。阅读拉取请求的描述(如果有)。这将给你必要的上下文，不仅理解变更本身，而且判断变更是否符合需求。

例如，在没有上下文的情况下，硬编码一个点作为数字的小数点分隔符对于您的仅限美国的应用程序来说似乎是合理的，但如果您阅读了标签，您会知道您的公司正在扩展到其他国家，现在用户的区域设置需要参与选择小数点分隔符[。](https://en.wikipedia.org/wiki/Decimal_separator#Arabic_numerals)

如果没有问题/票证，也没有公关描述，请写下您自己的描述，并将其作为评估的一部分。如果你误解了目的，被评审者很可能会指出来。

### [](#ii-read-dont-skim)二世。阅读，不要略读

不要满足于一句简单的“我看着不错”。当你浏览时，所有格式良好的代码看起来都不错！你想要阅读这些变化并且真正理解它们。是的，很难。是的，需要更多的时间。是的，值得。这也会增加你发现不太明显的项目质量问题的机会。

## [](#improving-project-quality)提高项目质量

在代码投入生产之前，让第二双眼睛来看代码是一个捕捉一些 bug 并确保代码可维护的好方法。

### [](#iii-always-run-the-code)三世。总是运行代码

一行变？运行代码。只是 CSS 的变化？运行代码。只是翻译？快跑。的。代码。

不要欺骗自己，以为每个人都会在每次做出更改后编译和运行项目。我们应该...但是我们没有。你知道，那些时候，在你需要离开办公室之前，你只剩下 5 分钟，你只有一个更小的改变要做，但你没有时间去验证它。

确保项目仍然可以编译和运行，而不会抛出异常，这是您作为评审者最起码要做的事情。这是一个简单的理智检查。所以你应该去做。

如果引入了任何用户可见的更改，请确保您亲眼看到它们。单击浏览新的 UI 组件。

进行测试。是的，我知道 CI 应该这么做。但是，也许有一些古怪的测试会偶然通过 CI？或者可能有一个 bug 只出现在你的 macOS 上，但是 CI 运行的是 Linux？也许有人没有遵循测试文件的正确命名模式，测试运行人员完全忽略了这个文件？

这些更改包括数据库迁移吗？通过回滚、检查`master`并检查项目是否仍在运行来结束您的评审过程。

### [](#iv-do-not-nitpick)四世。不要挑剔

有人在应该插入一行的地方插入了两行空行？别提了。被评审者修复他们的代码**中的问题的耐心**是有限的**，你不想把它浪费在琐碎的问题上。**

相反，尝试找到一个自动化的解决方案，确保所有这些琐碎的细节都被自动检测到，并建议您的团队开始使用它。

### [](#v-focus-on-readability-issues-that-cant-be-detected-automatically)五、关注无法自动检测的可读性问题

一旦您的自动化工具验证了函数名长度和适当的缩进，您就可以专注于只有人类才能理解的重要内容。

那些函数/变量名对你有意义吗？他们是否一致地使用项目的词汇？它们会令人困惑吗？有什么模棱两可的缩写吗？

有趣的故事:我曾经花了 10 分钟相信我正在开发的应用程序有一个功能，允许访客用户(付费用户邀请的非付费用户)邀请更多的访客用户，因为有人命名了一个变量`sub_guest`而不是`subscription_guest`。

## [](#providing-feedback-for-the-developer)为开发者提供反馈

好的反馈是指**强化某人的好习惯**的反馈，有助于注意和消除坏习惯。为了让您的反馈产生任何影响，您需要**确保您被倾听**。

### [](#vi-always-say-something-nice)六。总是说些好听的

我不在乎代码变化有多小。你总是可以说些积极的话。正反馈越具体越好。

如果你以前从未做过，可能很难想出什么，所以这里有一些启发灵感的通用示例:

> 干得好！我尽力在你的代码中寻找 bug，但是找不到。
> 
> 谢谢你纠正了这个错别字，我不知道这个单词的拼写是正确的。
> 
> 我喜欢你给这个函数起的名字。它的作用显而易见。
> 
> 哇，太棒了。我不知道我们的编程语言/这个框架/这个库的这个特性。
> 
> 我喜欢你在一个新文件中添加了所有这些新代码。将它放在现有文件中很有吸引力，但这会使现有文件太大。

如果你害怕因为欣赏琐碎的事情而听起来很傻，问问你自己当你接受代码评审时是什么感觉。你兴奋吗？还是你害怕它，因为你知道在最好的情况下，这将是中立的沉默的批准，但在最坏的情况下，它将充满严厉的批评？你真的希望你的同事害怕收到你的评论，仅仅因为你害怕听起来很傻吗？

正面反馈的另一个重要作用是，它**让被评估者对你的负面反馈**更加开放。

你有没有一个家庭成员利用每一个见到你的机会来抱怨你？你又胖了，你的兄弟姐妹比你挣钱多，你应该多笑笑...你有多大可能将他们的抱怨视为能激励你改进自己的有效观点？一点也不？好吧，几个月来只收到来自同一个同事的负面反馈感觉是一样的。

### [](#vii-avoid-judgemental-and-bossy-language)七世。避免判断和专横的语言

停止听起来武断和专横的最简单的方法是**假设你是错的**，而被评估者是对的。**然后问问题**，这将帮助你认识到你为什么错了。毕竟，他们花在代码上的时间可能比你花在审查代码上的时间要多得多。他们更容易理解细节。

不说*~~不做这个，做那个~~*。你不想培养你的同事服从命令的能力。你希望他们创造性地、批判性地思考。此外，没有人喜欢被人使唤。

相反，你可以说“你会怎么想……”。表示你愿意与人交谈。如果人们参与决策，他们会更有动力去做某事。

不要说*~~你为什么不干脆...~~*。这句话暗示你的解决方案是显而易见的选择，而被评估者不使用它是愚蠢的。这可能会引发一种防御性反应，让原本聪明、理性的人热情地捍卫一个有缺陷的立场。

相反，说“你考虑过了吗...?"，解释为什么你的解决方案在这种情况下会有优势，然后友好地邀请对方证明你是错的，例如*...还是我错过了什么？”*。

我并不是说你总是错的。但是**你肯定不总是对的**。这种方法会让你和被评估者更容易承认自己的错误**，而不会丢面子**。

#### [](#github-pr-reviews)GitHub 公关评论

GitHub 有一个特性，允许你将你的拉式请求评审标记为*评论*、*接受*或*请求变更*。

我倾向于避免*请求改变*,除非我绝对确定某些事情需要改变。*要求改变*是专横的语言，没有留下多少争论的余地。我会做*评论*评论，直到我所有的问题都得到解答，然后*接受*。

## [](#summary)总结

伟大的代码评审需要时间去做，但是它们不仅会提高你的项目，还会提高你对项目的了解以及你与团队的关系。

请记住:

*   跟上不断变化的代码库
    *   一、先找出*为什么*
    *   二。阅读，不要略读
*   提高项目质量
    *   三。总是运行代码
    *   四。不要挑剔
    *   动词 （verb 的缩写）关注无法自动检测到的可读性问题
*   为开发人员提供反馈
    *   不及物动词总是说些好听的
    *   七。避免判断和专横的语言