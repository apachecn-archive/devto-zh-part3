# 基本安全卫生

> 原文：<https://dev.to/lvl99/basic-security-hygiene-2a11>

就在最近，纯属巧合的是，我在 GitHub 上看到了一家公司使用的所有 API(销售点 API、Oauth 服务器、产品 API 等)的完整生产访问凭证。

我喜欢“[做正确的事情](https://www.youtube.com/watch?v=muc7xqdHudI)”，所以我马上通知了该公司，他们现在已经从 GitHub 上删除了这些信息。但这让我再次思考与代码、版本控制系统和凭证管理有关的基本最佳实践，以及保护您的系统的基础知识有多普及。

我想大家应该已经很清楚这些概念了(开发者版的“常识”)。然而，如果你在 GitHub 上对某些匹配 [env](https://github.com/search?utf8=%E2%9C%93&q=prod+pass+extension%3Aenv+extension%3Aenv&type=Code&ref=advsearch&l=&l=) 或 Java [properties](https://github.com/search?utf8=%E2%9C%93&q=prod+extension%3Aproperties&type=Code&ref=advsearch&l=&l=) 文件的查询进行高级搜索，你可以看到一些开发者已经向万维网泄露了用户名、密码和其他有趣的信息。

考虑到我最近的发现，我想我应该分享一下我所认为的开发人员的安全“常识”——或*基本安全卫生*——作为我在 [dev.to](https://dev.to) 上的第一篇帖子。

## 不要提交带有访问凭证或重要 API 密钥的文件

如果你有任何存储各种访问凭证或你的代码库引用的重要 API 密钥的文件，请为了对[飞行意大利面怪物](https://en.wikipedia.org/wiki/Flying_Spaghetti_Monster)和所有那些*多孔*的爱，确保它们要么存在于代码库之外，要么被忽略。

如果您使用 git，像这样简单的事情可能会将您保存在您的`.gitignore`文件中:

```
 .env*
  staging.properties
  production.properties 
```

如果您想将凭证存储在位于代码仓库之外的文件中，在 Mac/Linux 机器上，您可以使用类似于`~/.<project name>.credentials.json`或`~/.<project name>.properties`的东西。

## 让你的代码回购私有

如果您的代码不需要开放并可供在线阅读，那么请不要将其开放并可供在线阅读。

过去我使用 [BitBucket](https://bitbucket.org) 作为免费的私有库，然而最近 GitHub 宣布[为每个人提供免费的私有库](https://blog.github.com/2019-01-07-new-year-new-github/)。继续操作，确保你的回购现在是私有的:但是如果你把它从公共的改成私有的，确保你重置了所有的用户名/密码...

## 在您的代码库中删除凭证文件是不够的

如果您在 repo 中错误地提交了凭据，删除文件或包含它们的行并提交您的更改是不够的，您的编辑历史仍然存在！这就是 git 的全部意义。

使用类似 [`bfg-repo-cleaner`](https://rtyley.github.io/bfg-repo-cleaner/) 这样的工具来根除你 git 历史中的部分内容；然而，使用时要小心谨慎。最好的方法是首先不要在代码中包含您的凭证、API 密钥或任何其他敏感信息。

## 确保数据库备份和敏感文件无法通过公共网络访问...

如果你使用像 WordPress 这样的东西，核心软件和许多插件将凭证存储在 SQL 数据库中。如果您使用像 [iThemes Security](https://wordpress.org/plugins/better-wp-security/) 这样的工具创建 SQL 备份，请确保生成的 SQL 转储不在公共可用的文件夹中(或在类似`www`、`htdocs`或`public_html`这样的文件夹的后代中)和/或在您的服务器上无法查看 SQL 文件。

使用`.htaccess`文件(对于 Apache)或[配置 nginx](https://unix.stackexchange.com/questions/363346/block-access-to-a-file-or-location-on-nginx) 的位置来限制公众访问敏感文件和文件夹(尤其是`.git`文件夹，如果您碰巧使用 git 作为部署代码的方式)是非常重要的。更好的是，不要将这些文件和文件夹提交到您的代码库中，并且避免将它们部署到生产服务器上！把它们存放在别的地方。

## ...更好的是，使用您的管道/服务器基础设施来存储凭证

DevOps 是这方面的专家。这也是确保关注点分离的一个很好的方法，通过管道或环境变量将凭证提供给托管项目的虚拟机，从而将凭证从项目代码中分离出来。

如果您正在编译代码，可能需要包含 API 键。老实说，我不确定这里的最佳实践是什么。如果使用谷歌服务，你通常可以将一个 API 键限制在特定的域中，这增加了一个额外的授权级别，所以可以在你的代码中包含这些 API 键(对于前端项目，是必需的)。

如果您使用的服务带有不具备该特性的 API 键，那么将它包含在代码中可能会有安全风险。或许有人有好的建议，可以评论一下。

## 传递凭证时要小心

纯文本邮件和短信不是日常通信的未来。我很惊讶他们居然能坚持这么久。

如果您正在传递您的任何凭据数据或文件，请确保您是通过加密方法和/或私人渠道进行传递的。更好的办法是，把信息分开，这样如果有人窥探，他们只能得到部分或一半的数据。

请不要把凭证写在纸上。前几天，我在我的电脑包里发现了我前雇主的 PayPal 用户名和密码，我只是在把一些文件拿出来放在别人的桌子上时碰巧看到了这个。如果你想成为一名*白帽*开发者，最好销毁那些写在纸上或数字文档中的安全凭证，或者取消你访问它们的权限。

还有一些凭据服务和工具可以帮助实现安全和受保护的凭据共享方式:

*   [1 密码](https://1password.com/)
*   [仪表板](https://www.dashlane.com/)

## 如果可以，创建每个用户或每个项目的凭证

当人们离开一个组织或者一个项目被移除时，这样做将允许更好的安全控制。

此外，使重置凭据的过程变得非常简单。如果您的用户/项目凭证受到损害，您将希望能够重置并生成新的用户名和密码，并尽快更新项目。

## 请创建更智能、更安全的凭证

我被赋予用户名`<brand/agency name>`和密码`<brand/agency name><year>!`的次数多得令人麻木。从字符范围的角度来看，理论上添加年份和感叹号确实会使密码更安全，但是这是一种很容易被猜到和强行破解的常见格式。使用安全的密码生成工具。

必备 XKCD 参考:[https://xkcd.com/936/](https://xkcd.com/936/)

# 默默无闻的安全性有所帮助，但只有在有额外的安全级别支持时(并且你没有使用带有搜索功能的公共服务)

您可以添加到安全实现中的任何附加层都有助于进一步保护您的代码。

如果你的第一个也是唯一的安全级别是晦涩难懂(即假设你的代码或项目不会被其他在线人员发现)，那么有人偶然发现你的代码只是时间问题。需要我提醒你美国共和党全国委员会发生了什么吗？

你可能认为你在 GitHub 上没有追随者，你可能没有重要到让任何人看到或找到你的代码，但是请记住 GitHub 上的代码是可以搜索的，人们可以(并且可能会)随机搜索东西，看看他们能找到什么样的秘密。

谷歌的网络爬虫也是每个人都可以使用的另一个强大的工具，你会惊讶于你认为在它的结果中有什么东西混淆了表面。

## 确保您的外部供应商实践*基本安全卫生*

同样，我们都认为这是基本的开发人员“常识”，但是，如果您使用任何外部供应商(无论是个人开发人员还是代理机构)，您应该对安全方面的高质量实践有所期待，这一点很重要。

我发现的最初问题与外部供应商的一名员工有关，该员工暴露了他们的一个客户的所有访问凭证。哎呀。

## 总结

1.  不要提交带有访问凭证或重要 API 密钥的文件
2.  不要公开私有代码:确保你的回购可见性设置是正确的
3.  从您的存储库中删除提交的凭据时，请确保清除您的历史记录
4.  确保数据库备份和敏感文件无法通过公共网络访问...
5.  ...更好的是，使用您的管道/服务器基础设施来存储凭证
6.  传递凭证时要小心
7.  如果可以，创建每个用户或每个项目的凭据
8.  请创建更智能、更安全的凭据
9.  不要仅仅依靠*默默无闻的安全性*
10.  确保您的外部供应商实践*基本安全卫生*

我认为没有意识到、不关心或不在乎实现上述任何一点或所有几点是一种*开发人员的味道*。

你可能会损害你或你的客户的系统，在这个世界上，隐私和安全真的很重要，像 GDPR 这样的法律准则存在并有意识地惩罚那些不公平或不公正的人，公然回避更好的安全实践将使你成为一个有风险和令人讨厌的开发者。

**永远记住，被黑是*当*而不是*如果*** 的事情。增加您的*基本安全卫生*将有助于减少对您的凭证和系统的访问，但是总有更多的技术和问题超出了本文档的范围，需要您的注意。从 [OWASP 前 10 名](https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project)开始了解更多信息。

无论是开发人员还是非开发人员，都要格外警惕，提醒每个人基本的安全卫生知识。任何有权访问安全凭据的人都必须具备保护这些凭据的最低限度的知识和意识，并尽最大努力使这些凭据远离错误的受众。

我敢肯定，还有更多我没有完全涵盖的基础知识，或者也许我已经错过了一些其他重要的细节。请随时在评论中贡献您的其他*基本安全卫生*提示和关注点。