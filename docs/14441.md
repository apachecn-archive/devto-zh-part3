# 密码短语实现

> 原文:[https://dev . to/Lima wi/implementations-de-la-phrase-de-passe-k63](https://dev.to/limawi/implementations-de-la-phrase-de-passe-k63)

先读这篇关于[什么是好密码](https://dev.to/micheelengronne/tout-sur-un-bon-mot-de-passe-47m2-temp-slug-2740311)的文章，然后再继续读下去——这个。

## [](#r%C3%A8gles-de-mot-de-passe)密码规则

如果尝试将此类密码规则设置为 8 到 20 个字符或 3 个大写字母，请停止所有操作。

这种方法已经过时，对用户来说过于严格，导致他们为自己创建了复杂的密码，而且对于 Bot 来说非常容易破解。

你不相信我？观看[passwordistoostong](https://twitter.com/PWTooStrong)的 Twitter 帐号。

联合国例子:

让我们设想一下规则:

8 到 20 个字符，至少 3 个大写字母和一个标点符号。

密码匹配:AbCdEfgh！尽管他不能被认为强壮。

另一方面，用户可能会感到沮丧。

## [](#entropie)熵

而是使用熵值系统。

[zxcvbn](https://github.com/dropbox/zxcvbn) 库(即美国键盘底部的行字母)是一种很好的熵密码强度计算实现方法。它有多种计算机语言可供使用。这是我们在[【limawi】](https://limawi.io/fr-fr)使用的。

优点是密码强度估计不再有严格的规则该库计算密码的复杂性(考虑到字母的稀少性、它们的排列方式等)。)并给他一张便条。然后，您可以定义您认为输入的密码足够安全的注解、章节。

当然，您必须有相同的笔记、胶囊、服务器端和客户端。如果出现差异，则服务器是最后的选择，因为客户端可能会被黑客攻击(其环境不安全)。

## [](#%C3%A9viter-les-mots-de-passe-perc%C3%A9s)避免破解密码

一旦设置了密码保护机制，您仍需要验证输入的密码是否不是已破解的密码。

此步骤是可选的附加安全性，因为如果复杂程度较高，存储密码的方式可以相对有效地抵御彩虹攻击。但这仍然是一个奖励。

为此，您可以加载客户端 javascript 文件，或在用户创建其密码时对 API 进行 ajax 查询。

如果 Ajax 请求发送清晰的文本，则会出现问题，因为它为黑客提供了额外的攻击面。

加载的 javascript 文件很重，最好异步加载。但是，即使是异步的，文件大小(以及密码数)也不能很大。

当然，由于客户端不确定，因此需要重复服务器端操作。

另一种技术是使用服务[我已被聘用](https://haveibeenpwned.com/)。它提供了一个技术上优雅的解决方案，但它是澳大利亚法律规定的，并以美国服务为基础，它提出了一个关于遵守欧洲残疾人权利公约的严重问题(见我们网站上今后的一篇文章)。

该服务通过 k-knowledge(知识-k)运行吗？页:1。

您可以散列用户输入的密码，然后将该散列的前 k 个字母发送给服务。服务会将数据库中包含前 k 个字母的所有散列返回给您。与用户密码散列进行比较，如果服务散列之一匹配，则密码被破解。

例如:

framboise 密码为 SHA256 散列:

f9e 4141 ee 43 a3 b 877758 e 2584 a1 F6 a0e 7 a9 c8 d6e 58 bb 859 a 1665 D8 C1 f 447003 c

前五个字母是 F9 和 41。

你把这 5 封信寄给我已经被录用了。

它返回:

*   f9e 4141 ee 43 a3 b 8777 ert 8584 a1 f 6a 0e 7 a9 c8 D6 e 58 bb 859 a 1665 D8 C1 f 447003 c
*   f9e 4141 ee 962758777 ert 8584 a1 F6 a0e 7 a9 c8 d6e 58 bb 859 a 1665 D8 C1 f 447003 c
*   f9e 4141 ee 43 a3 b 877758 e 2584 a1 F6 a0e 7 a9 c8 d6e 58 bb 859 a 1665 D8 C1 f 447003 c

比较后，您会发现第三个散列值与密码散列值相同。因此，密码被破解。

有了这个系统，网络上没有密码流通，[我已经被选中](https://haveibeenpwned.com/)不知道你测试过哪个密码。举个例子，返回了三个结果，但是 k 越小，返回的结果越多。

## [](#puis-stocker-vos-mots-de-passe)然后存储密码

然后，用户找到正确的密码后，它会(安全地)发送给您，您必须将其存储起来。

所以，一个非常基本的原则是:永远不要储存明确的密码。如果黑客成功访问了您的密码存储库，则您已在一个托盘上为其提供了对您的服务和其他服务中所有帐户的访问权限(不幸的是，用户经常在不同的服务中重复使用相同的密码)。

那怎么办？

首先，您需要限制密码长度，但不要太多。例如，Drupal 的长度限制为 512 字节，即 UTF-8 中的 512 到 128 个字符。此步骤是避免 DOS 攻击的必要步骤，因为散列步骤需要一点计算机资源(输入一个由数千个字符组成的庞大密码，用于阻止散列步骤中的计算机)。页:1。

然后随机生成盐(通常称为胡椒或线盐的表盐)？页:1。这是一个特定数目字符的字符串。

[![Sel de table aussi appelé poivre](../Images/d4427424cf3b499ccb44475dd489a682.png)](https://res.cloudinary.com/practicaldev/image/fetch/s---Zg64z6y--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.limawi.io/fr-fr/posts/implementations-de-la-phrase-de-passe/images/sel-de-table.jpg)

<figcaption>

【table sel】

<small>【table sel 又称为胡椒】</small>
</figcaption>

您可以在库存级别(即整个库存)或密码级别(每个密码一个)生成它。它将被添加到密码中，使两个相同的密码不同。如果一个用户在多个不同的服务上使用了相同的口令，或者两个用户选择了相同的口令，则 sel 用于防止散列、表对表或行对行进行比较。

例如:

每张桌子有盐：

Alice 把 framboise 密码放在 Gentiles-fram bois-flat . com 网站和 maleficent-fram bois-flat . com 网站上。

gentleman-fram bois-flat . com 网站生成 sel 458，因此 Alice 的密码为 458framboise。

邪恶网站 fram bois-flat . com 生成 gdf 盐，因此 Alice 的密码将是 gdfframboise。

如果黑客成功捕获了这两个表，则无法比较口令散列，因为它们将不同(因为口令不同)。他不会知道爱丽丝在这两个服务上设置了相同的密码

每一行有一个 sel:

Alice 把 framboise 密码放在 Gentiles-fram bois-flat . com 网站上，Bob 也把 framboise 密码放在同一个网站上。

gentleman-fram bois-flat . com 为 Alice 的密码生成 sel 458，因此 Alice 的密码将为 458framboise。

同一站点为 Bob 的密码生成 SDD sel，因此 Bob 的密码为 sddframboise。

在这种情况下，一个成功地将站点表 framboises 展平的黑客将无法比较 Bob 和 Alice 的哈希。他不会知道其实是同一个密码

然后散列由 sel 和密码组成的字符串。使用安全算法，例如 SHA512。

framboise 密码和 sel 458 的散列结果如下:

hash(sha256，' 458 fram boise ')= ' 527d 88733 ed 03 ce 5ef 2d 12 AE 4279950 ABC 29 DC 427 b14 a 58 ab 2150678 a 7cc 72486 ce 637 b8a 10333 e 80879 F3 f 0 ce 685 fa 6 cbb 5db 8d 79543382 c 21116 f 8 cf '

您已经有一个几乎安全的密码存储。别忘了把盐也储存起来。您可以使用上一个散列重复最后一个步骤来加强散列，而不是使用 sel:

hash(sha256，' 527d 88733 ed 03 ce 5 ef2d 12 AE 4279950 ABC 29 DC 427 b14 a 58 ab 2150678 a 7 cc 72486 ce 637 b8ad 10333 e 80879 F3 f0ce 685 fa 6 cbb 5db 8d 79543382 c 21116 f 8 cf framboise ')= ' E3 a 252 D3 C5 d 638 c 82d 8430 DDC 85 e 9 b5 b 13 f 6508d 690d 97 e 2 C5 a1

其目的是消除黑客已经知道的可能的哈希。他们一定很难找到密码。

存储密码后，当用户尝试重新登录时，系统将重复相同的步骤(使用现有 sel)，并将结果与存储中已有的散列值进行比较。如果它们是一样的，那就是正确的密码

## [](#les-erreurs-%C3%A0-%C3%A9viter)要避免的错误

有时候我们犯了这么愚蠢的错误！下面是一些可以避免的。

更改接受密码的复杂程度时，不要在旧密码字段中设置此阈值。否则，用户将无法再输入旧密码来更改旧密码。仅在新密码字段中输入复杂的密码。

如果您更改了存储密码的方式或复杂性，并且需要用户采取行动，请通过电子邮件通知用户。不要发送单链接密码恢复，用户几个月后可以很好地阅读，攻击者使用它的时间。

当然，切勿通过电子邮件发送用户密码。记住，电子邮件就像明信片:每个人都能阅读。如果您可以将密码传送给使用者，就表示您无法正确储存密码。

当用户创建新密码时，发出重要的错误消息。给出弱、强、强等值，而不是不可理解的熵值。

当然，请确保密码是通过 https 连接发送的。禁止 http 进入您的系统。

要进一步，请创建身份验证字符串。也就是说，除了密码之外，还可以通过智能手机上的令牌进行双重身份验证。