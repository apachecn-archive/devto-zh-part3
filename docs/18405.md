# 视觉回归测试是愚蠢的(但是我们可以修复它)

> 原文:[https://dev . to/klamping/visual-regression-testing-is-blind-3c fn](https://dev.to/klamping/visual-regression-testing-is-stupid-3cfn)

这篇文章的标题来自一个帮助运营一个视觉回归测试网站的人可能看起来很奇怪(他已经就这个主题做了很多演讲)。

但我真的相信。

我马上会解释为什么，但是首先，如果你不熟悉这个术语，先看一下入门。

## [](#what-is-visual-regression-testing)什么是‘视觉回归测试’？

你知道那些“辨别差异”的谜题吗？你需要在两张非常相似的图片中找出五处变化？

<figure>

[![Spot the difference image, with one picture having the mouth of a spaceship a slightly different size](../Images/2c1cef1c9ac67d4bf6073e5e76de9d46.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--Sw1SxWs2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/tm17ofdyjx6vpqs2nquq.png)

<figcaption>Leave a comment if you can spot the single difference</figcaption>

</figure>

测试人员每天都在做这样的事情。

每当 CSS 或 HTML 发生变化时，我们就陷入“找出差异”的游戏中。

但是我们真的不擅长这个。就像，。(魔术师就是这样让他们的魔术发挥作用的)

视觉回归测试旨在通过让计算机为我们检测差异来帮助我们。

您首先存储一个状态良好的页面截图。然后，在一次更新之后，你拍摄一个新的截图，让计算机比较两者。

这两个图像之间的任何差异都会导致测试失败。它真的很擅长这个，以一种非常愚蠢的方式。

## [](#why-its-stupid)为什么这么蠢

基本的图像对比是哑的。

它只是不能理解设计的微妙之处，以及设计如何在不破坏的情况下改变。这导致了大量的误报。

因为网页是变化的。**很多**。

内容一直在更新；添加新功能，删除旧功能。这个设计总是被修改。

甚至不要让我开始所有营销想要修补网站的方式。

如果你正在运行基本的图像比较，你的测试将会失败。**全部。的。时间。**

相信我，我也经历过。糟透了。

这就像试图用地震仪探测地震一样...汽车里的地震仪在一条被冲坏的土路上飞驰。

你会得到很多无用的噪音。

为了解决这个问题，一些库提供了定义一个允许的“差异百分比”的选项。这是一个比较总差异百分比与图像本身大小的数字。

如果低于这个数字，它会说，“嘿，没关系，我们会接受这个改变，因为它毫无意义……”

这是什么样的疯狂？！

我们只是要定义一个任意的，完全主观的，没有现实基础的数字，然后跟着它走？！

就连车里的地震学家都认为这很愚蠢。

## [](#how-to-learn-it-some-good)如何学习它有些好处

所有这些可能看起来很残酷，你可能会认为这是一个失败的事业，但我有一些好消息。

正如一样，我们可以用一些技巧来提高我们的信噪比。

### [](#take-smaller-screenshots)拍摄较小的截图

我推荐的第一个也是最简单的方法是拍摄较小的截图。也就是说，只截取单个组件的截图，而不截取整个网页的截图。

您使用的工具需要支持捕捉页面的各个部分(这通常是通过为特定元素传入 CSS 选择器来完成的)。

通过缩小图片的尺寸，你可以快速识别出失败的地方(“哦，提交按钮的截图”)。

你还可以屏蔽网站上不断变化的部分(例如，第三方的“推荐商品”窗口)。

### [](#test-static-pages)测试静态页面

生成的风格指南对于视觉测试非常有用。它们去除了网站的许多动态特性，代之以可预测和可靠的页面。

像  这样的工具在建立风格指南/模式库方面取得了巨大的进步。当然，你不是在测试实际的网站，但它肯定有助于事业。

孤立地测试您的组件并取得成功，要比尝试一次性测试所有内容并不断失败好得多。

### [](#use-better-algorithms)使用更好的算法

这是“一分钱一分货”的部分。开源工具很好，但是我还没有找到一个能提供付费工具所能提供的东西(尽管我总是乐于接受建议)。

有无数的付费工具，但我将集中讨论我在这里最有经验的两个。

#### [](#percy)珀西

在过去的三年里，Percy 的团队不断改进产品。

他们增加了智能功能，如“屏幕截图稳定”，这有助于消除由于字体渲染和动画造成的误报。

他们还构建了一个光滑的界面，用于在软件开发生命周期中管理截图。

一个友好的界面来管理截图并不是我之前提到过的，但是它是绝对必要的。不进入太多细节很难解释，但是一个好的界面简化了这种测试的复杂性。

的简单演示不能说明同时有多个测试环境和多个代码分支的项目。

当您在真实环境中尝试时，您会很快意识到这些基本工具的功能不足以长期管理(或供广泛人群使用)。

这就是付费工具真正有回报的地方，也是我推荐你去看看的原因。

#### [](#applitools)应用工具

Percy 的一个替代品是 Applitools，它自称是“人工智能驱动的视觉测试和监控”。人工智能部分在他们管理图像比较的方式中发挥作用。

他们的代码智能地理解不同类型的变化，而不是盲目地(heh)比较前后的截图。

拥有一个文本不同但布局相同的组件。您可以将其定义为“布局匹配级别”，这允许不同的文本，只要该区域的一般几何形状是相同的。

如果你不能完全控制网站上显示的文字，这是非常有用的。

和 Percy 一样，他们也为您提供托管的测试结果仪表板，这在任何解决方案中都是必不可少的。

除此之外，他们还做了大量工作来集成像故事板和测试框架这样的工具。

他们在产品上投入了大量的工作，所以你不必这样做。为什么不利用这一点呢？

## [](#not-so-stupid-after-all)终究没那么笨

我在一开始就声明过，我认为视觉回归测试是愚蠢的。我仍然相信。

但不一定非要这样。我写这篇文章是为了检验现实，而不是谴责。

我相信它“蠢”不代表它不能聪明。

正如 web 框架和编程语言随着时间的推移已经有了巨大的改进一样，可视化回归工具也在做同样的事情。

请在你的测试套件中加入可视化回归测试，它非常强大。

但是要知道，基本的功能对于专业使用来说是不够的。

你需要在你的过程中加入一些智能。

尝试一下那些快速入门教程，但是也要付出额外的努力来使测试有效。

当第一次尝试对你的需求来说有点过于坎坷时，不要放弃。

通过简化你的场景来找到平滑这个过程的方法。关注付费解决方案，这些解决方案提供了开源世界尚未提供的功能。

要明白，虽然它可以让测试看起来更容易，但网站测试是，而且永远是，一个需要一点脑力的复杂过程。

*免责声明:我过去为 Applitools 做过有偿工作，但他们不会以任何方式补偿我写这篇文章。*