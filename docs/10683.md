# Pirrigator，第 2 部分。

> 原文:[https://dev.to/neilgall/pirrigator-part-2-mbg](https://dev.to/neilgall/pirrigator-part-2-mbg)

我让无线网络在树莓派上工作。当你深入了解时，我仍然是一个不太熟悉的人，我错误地同时使用了 NetworkManager 和 netctl。放弃后者，学习如何使用`nmcli`来创建一个系统连接，一切都恢复了生机。这些项目都是关于学习的。

有几个 GPIO 板条箱用于防锈。我又一次学到了一些新东西 GPIO 是一种核心的 Linux 东西，而不是树莓 Pi 特有的东西。我将尝试一些，但是我或多或少随机选择了 sysfs-gpio。我现在有一个由铁锈驱动的[闪烁 LED](https://photos.app.goo.gl/yDAea5kKsAPBny969)！

接下来，我想让 I C 工作，并读取温度/湿度/大气压力传感器。这有点复杂，我承认我有时会想为什么我在 Arch 而不是 Raspbian 上做这个，在 Raspbian 上一切都是现成的，但是学习动机再次占了上风。只要我突破自己舒适区的边缘，并取得进步，我就很开心。让 I C 工作的基础知识包含在 Linux Arm wiki 中。我拥有的传感器是 BME280，它有一个相当不错的教程[在这里](https://www.raspberrypi-spy.co.uk/2016/07/using-bme280-i2c-temperature-pressure-sensor-in-python/)，这是用 Python 编写的，但对于确认硬件和接口是否正常工作非常有用。我会及时解决将代码移植到 Rust 的问题。

我还让湿度传感器工作了，至少是在它的数字输出上。我认为简单的湿/干二进制指示有点粗糙，不适合绘制漂亮的图形，所以我打算让模拟输出工作。我可以测量它的电压，干燥时为 3.3V，当传感器完全浸没在水中时，电压下降到 1.5V 左右。然而，Raspberry Pi 没有任何模拟输入，所以我订购了一个 [Adafruit MCP3008](https://www.adafruit.com/product/856) ，它提供 8 个 I C 可读的模拟输入通道。为了打开水阀，我还订购了一些放大 1000 倍的达林顿晶体管，因此我可以用 Pi 的微小 I/O 电流驱动那个大 12V 螺线管。

硬件基础已经很快地整合在一起，我感觉现在真正阻碍我的是舒适地编写 Rust 代码。因此，本周我将把重点转向学习 Rust。我正在研究这本书，很快就会尝试一下。

我开始考虑软件系统设计了。我想保持它的模块化和轻量级(a)这样我就可以删除或关闭那些有问题或不值得的东西，以及(b)这样我就可以在未来添加更多。另外，我想利用 Rust 著名的并发特性，所以我考虑为每个传感器运行一个线程，每个传感器以可配置的时间间隔报告其读数。这些报告都将在单个消费者线程上排队，该线程将记录写入 sqlite 数据库。如果记录的湿度过低，芯冲洗线将定期唤醒并添加一些水。最后，我将定期生成并发布收集到的数据的图表。测试这样的模块化设计应该相当简单。

在优先级列表中的美好区域是某种远程控制和参数调整。我会在 Pi 上放一个摄像头，每天抓拍植物的照片，看看它们怎么样，但这可能只是一个 shell 脚本和 systemd timer，而不是 Rust 中的任何聪明之处。请关注此空间的更新！