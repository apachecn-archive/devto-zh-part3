# 反对考试随机性的理由

> 原文:[https://dev . to/arturmartsinkovskyi/-the-case-against-randomness-in-tests-3fhh](https://dev.to/arturmartsinkovskyi/-the-case-against-randomness-in-tests-3fhh)

[![Accuracy and repeatibility](../Images/a942568b14b67a12e8070d5731b870f5.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--bXysRtZt--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/artur-martsinkovskyi/artur-martsinkovskyi.github.io/master/assets/img/predictability.jpg)

好的测试会扼杀有缺陷的理论；我们仍然活着再次猜测。
——卡尔·波普尔

## [](#preambule)序言

自动化测试是现代软件工程师工作流程中不可或缺的一部分。测试的目的是验证为系统元素和系统整体设置的规范和要求仍然有效。自动化测试在此基础上进行扩展，并允许程序以自主的方式进行测试，包括外部和内部，不仅覆盖被测系统的限制，还包括其内部。自动化测试套件的另一个额外好处是，它们可以在开发人员的机器、构建服务器或任何基础设施上同时运行多次，而不需要在管道中包含真人。随着系统的增长，它大大降低了质量保证成本，涉及的人员也更少，并且让质量工程师能够从事更智能和更涉及业务的任务，将平凡和重复的工作抛在身后。

然而，像任何技术一样，自动化测试需要正确地执行才能有用。必须有一些标准来定义好的测试，并将它们与坏的区分开来。如何检验测试是否有效？实际上，这取决于被测试的程序、它的期望输出、代码的预测变化频率、使用频率、在系统中的位置以及代码的复杂性和功能性。在一般情况下，最有可能被测试的代码是
某个更大系统的单元，与其他单元互连，以或多或少已建立的规范以中等频率使用和改变。这样的测试以相当大的数量编写，覆盖大多数单元和子系统，以确保每个部分都按要求工作。

## [](#accuracy-and-repeatability)准确度和重复性

为了成为好的测试，必须具备两个不同于其他的特征。这些特征是**精确度**和**重复性**。准确性意味着测试的输入值应该是正确的，与真实系统中使用的值没有区别。In 可能不是完全相同的数据，但它的重要结构和特征必须与真实样本完全相同，以便真正测试代码。可重复性意味着幂等性和确定性。如果符合规范，测试应该总是通过，如果不符合规范，测试应该总是失败。不管它们运行多少次，如果代码、测试和基础设施都没有明显的变化，那么套件的结果必须保持不变。这些特征是至关重要的，因为如果没有它们，测试不仅是无用的，而且是危险的。如果测试的可重复性受到损害，测试就变成了危险的安慰剂，这看起来像是生产阶段失败的保险，但实际上，即使代码不能正常工作，它们也可能通过，从而将故障单元泄漏到现实世界中。另一方面，当工程师注意到测试是脆弱的并且没有时间恢复它们时，他开始不信任测试套件并重复运行测试以确保一切正常，或者干脆停止考虑它们的结果，这可能会导致许多问题。如果不满足精度要求，测试就不能验证真实的系统状态，这就给深入研究测试代码的开发人员提供了错误的信心和传递给被测系统单元的数据的不正确信息。

准确性和可重复性都适用于同一个概念——数据。在某些情况下，错误的测试代码可能会损害这些特性，但是这些特性最有可能的问题来源是测试设置中提供的数据。

## [](#real-world-dangers)现实世界的危险

软件工程师倾向于使用大量的伪造工具来为他们的测试输入提供数据夹具。大多数情况下，这些工具从属于某个类别的数据样本数组中放入一个随机值，并用这些值初始化输入数据。此类工具通常制作得不够好，无法为压缩生成的数据提供广泛的接口，有时可能会破坏测试用例
,出现一些无法重复的边缘用例，因为它们是从随机包含有效样本的数组中提取的，从而使测试变得不确定。这种数据生成方式的另一个大问题是，生成的输入的类别不够具体，可能包括在现实生活中不存在的完全不适当的情况。理解生成的数据的参数的唯一方法，但是库的 API 命名是启动它并自己获取样本也是失败的，因为样本可能变化很大。

测试的随机数据生成是一个棘手的概念，使用时需要考虑到它的缺陷和怪癖。为了保持准确性和可重复性，必须在控制下以明确的方式生成数据。通过明确的方式，我的意思是必须为每一类数据提供单独的设置(正确和不正确的电子邮件地址，带或不带撇号和连字符的名称)，这些类型的输入应该在测试中明确声明为有效或无效。

具有这种需求的生成过程可以是简单地将值硬编码在测试主体中的某种常量中，该常量将在测试执行的设置和断言步骤中使用，或者是生成具有期望特征的严格约束的数据集，该数据集在测试本身中是清楚和合理的。这些方法对于为测试中使用的数据提供直接的上下文和具体性是有价值的。如果方法的输入是任何整数，你应该在测试中显示它，如果它是属于某个域的有效电子邮件，那么它也必须是测试设置的一部分，包括它的无效对应物，以测试某个单元将如何处理快乐和不快乐的执行路径。如果系统的某些部分要求输入是唯一的，工程师可以使用序列生成器，该生成器会以受限的方式更改输入以符合要求，但不会更多(如更改电子邮件地址本地部分末尾的数字)。

## [](#conclusion)结论

最好避免测试中不受控制的随机性，因为如果没有正确和一致地选择设置数据，可能会出现准确性和可重复性问题。解决方案可能是在设置和断言阶段使用显式文字值，或者使用更高级的数据生成工具，允许使用一些预定义的严格方案来设置约束和构建数据。在非常需要随机性的情况下，需要捕捉所需数据的结构，以便测试代码并形成测试数据生成引擎，该引擎将形成尽可能接近真实世界的输入。