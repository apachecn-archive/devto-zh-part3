# 让 git 提交消息对吉拉、詹金斯和 scopes 有用

> 原文：<https://dev.to/luchfilip/making-git-commit-messages-useful-with-jira-jenkins-and-scopes-5759>

[![](img/79079dea11927624dda427a5e6251071.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Jtf1wsIv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/xj0ia55pg9pjdwsx7xp2.jpg)

在提交消息中写任何有意义的东西已经使你成为一个了不起的开发人员，并使你领先于大多数人。我见过太多无意义的提交消息，这让我很难找到问题。我读过的一些最著名的是:

*   把它保存在你的分支中是可以的，但是每当创建 PR 时，它必须被清理一下。交互式 rebase 可能真的很有用。
*   `fix crash`、`tweaks`或`more refactoring`:这些人出名有两个原因:发生了很多，而且从来不解释发生了什么变化。
*   在 git 消息中阅读这样的故事比看起来要难一些。它并没有真正告诉我们做了什么，而是关注问题。
*   `.`:没错，就是一个圆点！相信我，我见过这个。我知道这不是出于恶意。如果有人在 PR 创建后添加了一些修复，那么这种提交很容易进入主分支，然后使用 GitHub 的`Merge Request`或`Rebase and Merge`合并 PR。
*   每个公关部门都有这些东西会把事情搞得一团糟。这里的问题是，来自那个分支的两个提交(如`missed import`或`final fixes`)与一个合并拉请求提交一起出现，这使得很难理解它在哪里开始/结束。此外，它并没有提供任何有价值的信息。
*   追踪和阅读更多关于变化的信息确实有所帮助。但是当寻找特定的范围/区域变化时，仍然很难浏览 git 历史中的提交消息。

看到这些问题后，我写下了一些关于如何更好地利用提交信息的指导方针，吉拉和詹金斯也参与其中。

## 提交消息格式

每个提交消息必须遵循特殊的格式，包括票证 ID、范围和主题:

`<ticket-id>(<scope>):<subject>`

提交消息标题的任何一行都不应超过 72 个字符。这使得消息在 GitHub 上的一行中以及在各种 git 工具中完全可见。如果你需要超过 72 个字符，留下一个空行，继续添加更多的细节。

在编写描述时，也要尽量限制在每行 72 个字符，这样它在各种 git 工具中也能正常显示。

**提示:**我是一个 CLI 家伙，但如果你使用的是 **SourceTree** 你可以添加一个 72 个字符的边距行，方法是进入首选项→提交→使用提交消息的固定宽度字体，首选项→提交→在提交消息的字符处显示列指南。

### `ticket-id`

票证 ID 包含与此提交相关的票证编号。

*   如果提交与任何票据都不相关，那么要么创建它，要么跳过写入票据编号。尽管我们强烈建议您选择创建一个。
*   避免每次提交超过一张票(尽管也有例外)。

### `scope`

范围可以是指定提交更改的位置/区域的任何内容。

例如:播放器、mixpanel、gradle、home、feed、settings、ad 等。

*   当变更影响多个范围时，使用`*`。
*   不要写太具体的范围，比如播放器控件、菜单图标等等。也不要像图标，动画，列表等太普通。
*   倾向于只使用一个单词，但是如果你必须使用两个单词，那么使用驼峰式符号
*   不要使用空格

### `subject`

主题包含对变更的简洁描述:

*   必须完成以下短语:**如果应用，此提交将**
*   使用祈使句，现在时态:改变没有改变也没有改变
*   第一个字母不要大写
*   除非非常必要，否则不要大写字母
*   没有点(。)在最后
*   主题开头没有空格
*   尽量避免使用像 ProjectName 或 current platform/framework 这样显而易见的通用词，它们不会向提交消息添加必要的信息。
*   如果变化太多，无法用一条短信概括，请用`git add -p`
*   倾向于不要使用像`fix the player`这样的通用词，它不会给出任何关于什么被改变的信息。具体说明到底是什么解决了问题；比如:`access videoControls instance safely inside viewModel`

#### 主题中的信息

*   描述做出改变的原因。
*   它如何解决这个问题？
*   变化有什么影响？
*   不要假设评审者理解最初的问题是什么。
*   不要假设代码是不言自明/不言自明的。
*   阅读提交消息，看看它是否暗示了改进的代码结构。
*   第一个提交行是最重要的。
*   不要写多行的故事解释为什么某事是必要的，我们有票；所以不要说的太具体。尽量简洁但直截了当。
*   永远不要提到每次提交多张票。例外情况可能是，完全相同的修改适用于多张机票。

### 提交消息示例

*   票证(传送带):传送带不可见时暂停计时器
*   票证(传送带):当滑块可见时向分析报告
*   票(玩家):安全暂停控制器
*   ticket(show):添加缺少的阴影以显示平板电脑的平铺

## 那么，吉拉和詹金斯是如何合作的呢？

*   每当在 GitHub 中创建一个 PR 时，所提到的票证都会在吉拉转换到`PR Ready`
*   在吉拉的票证中，可以看到对当前票证的所有 pr 和提交的引用。
*   每当交付构建时，Jenkins 将基于上次构建提交和当前提交之间的差异创建一个变更日志。对于每次提交，它都会引用吉拉门票和 GitHub 提交。对于开发者、QA 和产品来说，这是一个非常有用的变更日志。
*   票证范围有助于快速浏览提交以找到相关的 bug

## 更上一层楼

有一个很棒的工具叫做 Commitizen，它可以帮助使用通用的 git CLI 界面格式化提交消息。我还没有用过，但是如果有人用过，或者有帮助的话，请告诉我。

问题:你们在项目中遵循什么指导方针？你有多严格地遵守这些？

非常感谢您的反馈。

*谢谢！*

*注意:
我已经阅读了来自不同开源项目的多个指南，所以如果你看到在其他地方提到的任何东西，这意味着我真的很喜欢它。尤其是 JavaScript 提交指南，它有一个非常好的定义结构*

参考资料:

*   [https://chris.beams.io/posts/git-commit/](https://chris.beams.io/posts/git-commit/)
*   [https://github . com/Apache/Griffin/blob/master/contributing . MD](https://github.com/apache/griffin/blob/master/CONTRIBUTING.md)
*   [https://gist.github.com/stephenparish/9941e89d80e2bc58a153](https://gist.github.com/stephenparish/9941e89d80e2bc58a153)